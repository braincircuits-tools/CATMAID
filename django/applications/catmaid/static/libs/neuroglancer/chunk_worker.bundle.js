!function(t){self.webpackChunk=function(e,r){for(var i in r)t[i]=r[i];for(;e.length;)n[e.pop()]=1};var e={},n={0:1};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(t){var e=[];return e.push(Promise.resolve().then(function(){n[t]||importScripts(({1:"draco"}[t]||t)+".bundle.js")})),Promise.all(e)},r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=61)}([function(t,e,n){"use strict";var r={};n.r(r),n.d(r,"create",function(){return c}),n.d(r,"clone",function(){return h}),n.d(r,"copy",function(){return l}),n.d(r,"fromValues",function(){return d}),n.d(r,"set",function(){return f}),n.d(r,"identity",function(){return p}),n.d(r,"transpose",function(){return g}),n.d(r,"invert",function(){return m}),n.d(r,"adjoint",function(){return b}),n.d(r,"determinant",function(){return y}),n.d(r,"multiply",function(){return _}),n.d(r,"translate",function(){return w}),n.d(r,"scale",function(){return v}),n.d(r,"rotate",function(){return I}),n.d(r,"rotateX",function(){return k}),n.d(r,"rotateY",function(){return S}),n.d(r,"rotateZ",function(){return T}),n.d(r,"fromTranslation",function(){return M}),n.d(r,"fromScaling",function(){return E}),n.d(r,"fromRotation",function(){return O}),n.d(r,"fromXRotation",function(){return x}),n.d(r,"fromYRotation",function(){return C}),n.d(r,"fromZRotation",function(){return N}),n.d(r,"fromRotationTranslation",function(){return A}),n.d(r,"fromQuat2",function(){return j}),n.d(r,"getTranslation",function(){return P}),n.d(r,"getScaling",function(){return U}),n.d(r,"getRotation",function(){return D}),n.d(r,"fromRotationTranslationScale",function(){return R}),n.d(r,"fromRotationTranslationScaleOrigin",function(){return F}),n.d(r,"fromQuat",function(){return z}),n.d(r,"frustum",function(){return L}),n.d(r,"perspective",function(){return B}),n.d(r,"perspectiveFromFieldOfView",function(){return $}),n.d(r,"ortho",function(){return V}),n.d(r,"lookAt",function(){return G}),n.d(r,"targetTo",function(){return q}),n.d(r,"str",function(){return Y}),n.d(r,"frob",function(){return Z}),n.d(r,"add",function(){return K}),n.d(r,"subtract",function(){return H}),n.d(r,"multiplyScalar",function(){return W}),n.d(r,"multiplyScalarAndAdd",function(){return J}),n.d(r,"exactEquals",function(){return Q}),n.d(r,"equals",function(){return X}),n.d(r,"mul",function(){return tt}),n.d(r,"sub",function(){return et});var i={};n.r(i),n.d(i,"create",function(){return nt}),n.d(i,"clone",function(){return rt}),n.d(i,"length",function(){return it}),n.d(i,"fromValues",function(){return st}),n.d(i,"copy",function(){return at}),n.d(i,"set",function(){return ot}),n.d(i,"add",function(){return ut}),n.d(i,"subtract",function(){return ct}),n.d(i,"multiply",function(){return ht}),n.d(i,"divide",function(){return lt}),n.d(i,"ceil",function(){return dt}),n.d(i,"floor",function(){return ft}),n.d(i,"min",function(){return pt}),n.d(i,"max",function(){return gt}),n.d(i,"round",function(){return mt}),n.d(i,"scale",function(){return bt}),n.d(i,"scaleAndAdd",function(){return yt}),n.d(i,"distance",function(){return _t}),n.d(i,"squaredDistance",function(){return wt}),n.d(i,"squaredLength",function(){return vt}),n.d(i,"negate",function(){return It}),n.d(i,"inverse",function(){return kt}),n.d(i,"normalize",function(){return St}),n.d(i,"dot",function(){return Tt}),n.d(i,"cross",function(){return Mt}),n.d(i,"lerp",function(){return Et}),n.d(i,"hermite",function(){return Ot}),n.d(i,"bezier",function(){return xt}),n.d(i,"random",function(){return Ct}),n.d(i,"transformMat4",function(){return Nt}),n.d(i,"transformMat3",function(){return At}),n.d(i,"transformQuat",function(){return jt}),n.d(i,"rotateX",function(){return Pt}),n.d(i,"rotateY",function(){return Ut}),n.d(i,"rotateZ",function(){return Dt}),n.d(i,"angle",function(){return Rt}),n.d(i,"zero",function(){return Ft}),n.d(i,"str",function(){return zt}),n.d(i,"exactEquals",function(){return Lt}),n.d(i,"equals",function(){return Bt}),n.d(i,"sub",function(){return Vt}),n.d(i,"mul",function(){return Gt}),n.d(i,"div",function(){return qt}),n.d(i,"dist",function(){return Yt}),n.d(i,"sqrDist",function(){return Zt}),n.d(i,"len",function(){return Kt}),n.d(i,"sqrLen",function(){return Ht}),n.d(i,"forEach",function(){return Wt});var s={};n.r(s),n.d(s,"create",function(){return Xt}),n.d(s,"identity",function(){return te}),n.d(s,"setAxisAngle",function(){return ee}),n.d(s,"getAxisAngle",function(){return ne}),n.d(s,"multiply",function(){return re}),n.d(s,"rotateX",function(){return ie}),n.d(s,"rotateY",function(){return se}),n.d(s,"rotateZ",function(){return ae}),n.d(s,"calculateW",function(){return oe}),n.d(s,"slerp",function(){return ue}),n.d(s,"random",function(){return ce}),n.d(s,"invert",function(){return he}),n.d(s,"conjugate",function(){return le}),n.d(s,"fromMat3",function(){return de}),n.d(s,"fromEuler",function(){return fe}),n.d(s,"str",function(){return pe}),n.d(s,"clone",function(){return Ie}),n.d(s,"fromValues",function(){return ke}),n.d(s,"copy",function(){return Se}),n.d(s,"set",function(){return Te}),n.d(s,"add",function(){return Me}),n.d(s,"mul",function(){return Ee}),n.d(s,"scale",function(){return Oe}),n.d(s,"dot",function(){return xe}),n.d(s,"lerp",function(){return Ce}),n.d(s,"length",function(){return Ne}),n.d(s,"len",function(){return Ae}),n.d(s,"squaredLength",function(){return je}),n.d(s,"sqrLen",function(){return Pe}),n.d(s,"normalize",function(){return Ue}),n.d(s,"exactEquals",function(){return De}),n.d(s,"equals",function(){return Re}),n.d(s,"rotationTo",function(){return Fe}),n.d(s,"sqlerp",function(){return ze}),n.d(s,"setAxes",function(){return Le});var a=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,u=Math.random;Math.PI;function c(){var t=new o(16);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function h(t){var e=new o(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(t,e,n,r,i,s,a,u,c,h,l,d,f,p,g,m){var b=new o(16);return b[0]=t,b[1]=e,b[2]=n,b[3]=r,b[4]=i,b[5]=s,b[6]=a,b[7]=u,b[8]=c,b[9]=h,b[10]=l,b[11]=d,b[12]=f,b[13]=p,b[14]=g,b[15]=m,b}function f(t,e,n,r,i,s,a,o,u,c,h,l,d,f,p,g,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=s,t[5]=a,t[6]=o,t[7]=u,t[8]=c,t[9]=h,t[10]=l,t[11]=d,t[12]=f,t[13]=p,t[14]=g,t[15]=m,t}function p(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function m(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],l=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],b=e[15],y=n*o-r*a,_=n*u-i*a,w=n*c-s*a,v=r*u-i*o,I=r*c-s*o,k=i*c-s*u,S=h*g-l*p,T=h*m-d*p,M=h*b-f*p,E=l*m-d*g,O=l*b-f*g,x=d*b-f*m,C=y*x-_*O+w*E+v*M-I*T+k*S;return C?(C=1/C,t[0]=(o*x-u*O+c*E)*C,t[1]=(i*O-r*x-s*E)*C,t[2]=(g*k-m*I+b*v)*C,t[3]=(d*I-l*k-f*v)*C,t[4]=(u*M-a*x-c*T)*C,t[5]=(n*x-i*M+s*T)*C,t[6]=(m*w-p*k-b*_)*C,t[7]=(h*k-d*w+f*_)*C,t[8]=(a*O-o*M+c*S)*C,t[9]=(r*M-n*O-s*S)*C,t[10]=(p*I-g*w+b*y)*C,t[11]=(l*w-h*I-f*y)*C,t[12]=(o*T-a*E-u*S)*C,t[13]=(n*E-r*T+i*S)*C,t[14]=(g*_-p*v-m*y)*C,t[15]=(h*v-l*_+d*y)*C,t):null}function b(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],l=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],b=e[15];return t[0]=o*(d*b-f*m)-l*(u*b-c*m)+g*(u*f-c*d),t[1]=-(r*(d*b-f*m)-l*(i*b-s*m)+g*(i*f-s*d)),t[2]=r*(u*b-c*m)-o*(i*b-s*m)+g*(i*c-s*u),t[3]=-(r*(u*f-c*d)-o*(i*f-s*d)+l*(i*c-s*u)),t[4]=-(a*(d*b-f*m)-h*(u*b-c*m)+p*(u*f-c*d)),t[5]=n*(d*b-f*m)-h*(i*b-s*m)+p*(i*f-s*d),t[6]=-(n*(u*b-c*m)-a*(i*b-s*m)+p*(i*c-s*u)),t[7]=n*(u*f-c*d)-a*(i*f-s*d)+h*(i*c-s*u),t[8]=a*(l*b-f*g)-h*(o*b-c*g)+p*(o*f-c*l),t[9]=-(n*(l*b-f*g)-h*(r*b-s*g)+p*(r*f-s*l)),t[10]=n*(o*b-c*g)-a*(r*b-s*g)+p*(r*c-s*o),t[11]=-(n*(o*f-c*l)-a*(r*f-s*l)+h*(r*c-s*o)),t[12]=-(a*(l*m-d*g)-h*(o*m-u*g)+p*(o*d-u*l)),t[13]=n*(l*m-d*g)-h*(r*m-i*g)+p*(r*d-i*l),t[14]=-(n*(o*m-u*g)-a*(r*m-i*g)+p*(r*u-i*o)),t[15]=n*(o*d-u*l)-a*(r*d-i*l)+h*(r*u-i*o),t}function y(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],a=t[5],o=t[6],u=t[7],c=t[8],h=t[9],l=t[10],d=t[11],f=t[12],p=t[13],g=t[14],m=t[15];return(e*a-n*s)*(l*m-d*g)-(e*o-r*s)*(h*m-d*p)+(e*u-i*s)*(h*g-l*p)+(n*o-r*a)*(c*m-d*f)-(n*u-i*a)*(c*g-l*f)+(r*u-i*o)*(c*p-h*f)}function _(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],c=e[6],h=e[7],l=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],b=e[14],y=e[15],_=n[0],w=n[1],v=n[2],I=n[3];return t[0]=_*r+w*o+v*l+I*g,t[1]=_*i+w*u+v*d+I*m,t[2]=_*s+w*c+v*f+I*b,t[3]=_*a+w*h+v*p+I*y,_=n[4],w=n[5],v=n[6],I=n[7],t[4]=_*r+w*o+v*l+I*g,t[5]=_*i+w*u+v*d+I*m,t[6]=_*s+w*c+v*f+I*b,t[7]=_*a+w*h+v*p+I*y,_=n[8],w=n[9],v=n[10],I=n[11],t[8]=_*r+w*o+v*l+I*g,t[9]=_*i+w*u+v*d+I*m,t[10]=_*s+w*c+v*f+I*b,t[11]=_*a+w*h+v*p+I*y,_=n[12],w=n[13],v=n[14],I=n[15],t[12]=_*r+w*o+v*l+I*g,t[13]=_*i+w*u+v*d+I*m,t[14]=_*s+w*c+v*f+I*b,t[15]=_*a+w*h+v*p+I*y,t}function w(t,e,n){var r,i,s,a,o,u,c,h,l,d,f,p,g=n[0],m=n[1],b=n[2];return e===t?(t[12]=e[0]*g+e[4]*m+e[8]*b+e[12],t[13]=e[1]*g+e[5]*m+e[9]*b+e[13],t[14]=e[2]*g+e[6]*m+e[10]*b+e[14],t[15]=e[3]*g+e[7]*m+e[11]*b+e[15]):(r=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],c=e[6],h=e[7],l=e[8],d=e[9],f=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=s,t[3]=a,t[4]=o,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=d,t[10]=f,t[11]=p,t[12]=r*g+o*m+l*b+e[12],t[13]=i*g+u*m+d*b+e[13],t[14]=s*g+c*m+f*b+e[14],t[15]=a*g+h*m+p*b+e[15]),t}function v(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function I(t,e,n,r){var i,s,o,u,c,h,l,d,f,p,g,m,b,y,_,w,v,I,k,S,T,M,E,O,x=r[0],C=r[1],N=r[2],A=Math.sqrt(x*x+C*C+N*N);return A<a?null:(x*=A=1/A,C*=A,N*=A,i=Math.sin(n),o=1-(s=Math.cos(n)),u=e[0],c=e[1],h=e[2],l=e[3],d=e[4],f=e[5],p=e[6],g=e[7],m=e[8],b=e[9],y=e[10],_=e[11],w=x*x*o+s,v=C*x*o+N*i,I=N*x*o-C*i,k=x*C*o-N*i,S=C*C*o+s,T=N*C*o+x*i,M=x*N*o+C*i,E=C*N*o-x*i,O=N*N*o+s,t[0]=u*w+d*v+m*I,t[1]=c*w+f*v+b*I,t[2]=h*w+p*v+y*I,t[3]=l*w+g*v+_*I,t[4]=u*k+d*S+m*T,t[5]=c*k+f*S+b*T,t[6]=h*k+p*S+y*T,t[7]=l*k+g*S+_*T,t[8]=u*M+d*E+m*O,t[9]=c*M+f*E+b*O,t[10]=h*M+p*E+y*O,t[11]=l*M+g*E+_*O,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function k(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],a=e[5],o=e[6],u=e[7],c=e[8],h=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=a*i+h*r,t[6]=o*i+l*r,t[7]=u*i+d*r,t[8]=c*i-s*r,t[9]=h*i-a*r,t[10]=l*i-o*r,t[11]=d*i-u*r,t}function S(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],a=e[1],o=e[2],u=e[3],c=e[8],h=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=a*i-h*r,t[2]=o*i-l*r,t[3]=u*i-d*r,t[8]=s*r+c*i,t[9]=a*r+h*i,t[10]=o*r+l*i,t[11]=u*r+d*i,t}function T(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],a=e[1],o=e[2],u=e[3],c=e[4],h=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=a*i+h*r,t[2]=o*i+l*r,t[3]=u*i+d*r,t[4]=c*i-s*r,t[5]=h*i-a*r,t[6]=l*i-o*r,t[7]=d*i-u*r,t}function M(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function E(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function O(t,e,n){var r,i,s,o=n[0],u=n[1],c=n[2],h=Math.sqrt(o*o+u*u+c*c);return h<a?null:(o*=h=1/h,u*=h,c*=h,r=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=u*o*s+c*r,t[2]=c*o*s-u*r,t[3]=0,t[4]=o*u*s-c*r,t[5]=u*u*s+i,t[6]=c*u*s+o*r,t[7]=0,t[8]=o*c*s+u*r,t[9]=u*c*s-o*r,t[10]=c*c*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function x(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=r+r,u=i+i,c=s+s,h=r*o,l=r*u,d=r*c,f=i*u,p=i*c,g=s*c,m=a*o,b=a*u,y=a*c;return t[0]=1-(f+g),t[1]=l+y,t[2]=d-b,t[3]=0,t[4]=l-y,t[5]=1-(h+g),t[6]=p+m,t[7]=0,t[8]=d+b,t[9]=p-m,t[10]=1-(h+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function j(t,e){var n=new o(3),r=-e[0],i=-e[1],s=-e[2],a=e[3],u=e[4],c=e[5],h=e[6],l=e[7],d=r*r+i*i+s*s+a*a;return d>0?(n[0]=2*(u*a+l*r+c*s-h*i)/d,n[1]=2*(c*a+l*i+h*r-u*s)/d,n[2]=2*(h*a+l*s+u*i-c*r)/d):(n[0]=2*(u*a+l*r+c*s-h*i),n[1]=2*(c*a+l*i+h*r-u*s),n[2]=2*(h*a+l*s+u*i-c*r)),A(t,e,n),t}function P(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function U(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],a=e[5],o=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(s*s+a*a+o*o),t[2]=Math.sqrt(u*u+c*c+h*h),t}function D(t,e){var n=e[0]+e[5]+e[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function R(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=e[3],u=i+i,c=s+s,h=a+a,l=i*u,d=i*c,f=i*h,p=s*c,g=s*h,m=a*h,b=o*u,y=o*c,_=o*h,w=r[0],v=r[1],I=r[2];return t[0]=(1-(p+m))*w,t[1]=(d+_)*w,t[2]=(f-y)*w,t[3]=0,t[4]=(d-_)*v,t[5]=(1-(l+m))*v,t[6]=(g+b)*v,t[7]=0,t[8]=(f+y)*I,t[9]=(g-b)*I,t[10]=(1-(l+p))*I,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function F(t,e,n,r,i){var s=e[0],a=e[1],o=e[2],u=e[3],c=s+s,h=a+a,l=o+o,d=s*c,f=s*h,p=s*l,g=a*h,m=a*l,b=o*l,y=u*c,_=u*h,w=u*l,v=r[0],I=r[1],k=r[2],S=i[0],T=i[1],M=i[2],E=(1-(g+b))*v,O=(f+w)*v,x=(p-_)*v,C=(f-w)*I,N=(1-(d+b))*I,A=(m+y)*I,j=(p+_)*k,P=(m-y)*k,U=(1-(d+g))*k;return t[0]=E,t[1]=O,t[2]=x,t[3]=0,t[4]=C,t[5]=N,t[6]=A,t[7]=0,t[8]=j,t[9]=P,t[10]=U,t[11]=0,t[12]=n[0]+S-(E*S+C*T+j*M),t[13]=n[1]+T-(O*S+N*T+P*M),t[14]=n[2]+M-(x*S+A*T+U*M),t[15]=1,t}function z(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n+n,o=r+r,u=i+i,c=n*a,h=r*a,l=r*o,d=i*a,f=i*o,p=i*u,g=s*a,m=s*o,b=s*u;return t[0]=1-l-p,t[1]=h+b,t[2]=d-m,t[3]=0,t[4]=h-b,t[5]=1-c-p,t[6]=f+g,t[7]=0,t[8]=d+m,t[9]=f-g,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e,n,r,i,s,a){var o=1/(n-e),u=1/(i-r),c=1/(s-a);return t[0]=2*s*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*u,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(i+r)*u,t[10]=(a+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*s*2*c,t[15]=0,t}function B(t,e,n,r,i){var s,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function $(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+o),c=2/(i+s);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-o)*u*.5,t[9]=(i-s)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function V(t,e,n,r,i,s,a){var o=1/(e-n),u=1/(r-i),c=1/(s-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*o,t[13]=(i+r)*u,t[14]=(a+s)*c,t[15]=1,t}function G(t,e,n,r){var i,s,o,u,c,h,l,d,f,g,m=e[0],b=e[1],y=e[2],_=r[0],w=r[1],v=r[2],I=n[0],k=n[1],S=n[2];return Math.abs(m-I)<a&&Math.abs(b-k)<a&&Math.abs(y-S)<a?p(t):(l=m-I,d=b-k,f=y-S,i=w*(f*=g=1/Math.sqrt(l*l+d*d+f*f))-v*(d*=g),s=v*(l*=g)-_*f,o=_*d-w*l,(g=Math.sqrt(i*i+s*s+o*o))?(i*=g=1/g,s*=g,o*=g):(i=0,s=0,o=0),u=d*o-f*s,c=f*i-l*o,h=l*s-d*i,(g=Math.sqrt(u*u+c*c+h*h))?(u*=g=1/g,c*=g,h*=g):(u=0,c=0,h=0),t[0]=i,t[1]=u,t[2]=l,t[3]=0,t[4]=s,t[5]=c,t[6]=d,t[7]=0,t[8]=o,t[9]=h,t[10]=f,t[11]=0,t[12]=-(i*m+s*b+o*y),t[13]=-(u*m+c*b+h*y),t[14]=-(l*m+d*b+f*y),t[15]=1,t)}function q(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=r[0],u=r[1],c=r[2],h=i-n[0],l=s-n[1],d=a-n[2],f=h*h+l*l+d*d;f>0&&(h*=f=1/Math.sqrt(f),l*=f,d*=f);var p=u*d-c*l,g=c*h-o*d,m=o*l-u*h;return(f=p*p+g*g+m*m)>0&&(p*=f=1/Math.sqrt(f),g*=f,m*=f),t[0]=p,t[1]=g,t[2]=m,t[3]=0,t[4]=l*m-d*g,t[5]=d*p-h*m,t[6]=h*g-l*p,t[7]=0,t[8]=h,t[9]=l,t[10]=d,t[11]=0,t[12]=i,t[13]=s,t[14]=a,t[15]=1,t}function Y(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Z(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function K(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function H(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function W(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function J(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function X(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],c=t[6],h=t[7],l=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],b=t[14],y=t[15],_=e[0],w=e[1],v=e[2],I=e[3],k=e[4],S=e[5],T=e[6],M=e[7],E=e[8],O=e[9],x=e[10],C=e[11],N=e[12],A=e[13],j=e[14],P=e[15];return Math.abs(n-_)<=a*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(r-w)<=a*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-v)<=a*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-I)<=a*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(o-k)<=a*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(u-S)<=a*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-T)<=a*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-M)<=a*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(l-E)<=a*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(d-O)<=a*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(f-x)<=a*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(p-C)<=a*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-N)<=a*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(m-A)<=a*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(b-j)<=a*Math.max(1,Math.abs(b),Math.abs(j))&&Math.abs(y-P)<=a*Math.max(1,Math.abs(y),Math.abs(P))}var tt=_,et=H;function nt(){var t=new o(3);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function rt(t){var e=new o(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function it(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function st(t,e,n){var r=new o(3);return r[0]=t,r[1]=e,r[2]=n,r}function at(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ot(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function ut(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ct(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ht(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function lt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function dt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function ft(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function pt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function gt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function mt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function bt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function yt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function _t(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}function wt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function vt(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function It(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function kt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function St(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Tt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Mt(t,e,n){var r=e[0],i=e[1],s=e[2],a=n[0],o=n[1],u=n[2];return t[0]=i*u-s*o,t[1]=s*a-r*u,t[2]=r*o-i*a,t}function Et(t,e,n,r){var i=e[0],s=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=a+r*(n[2]-a),t}function Ot(t,e,n,r,i,s){var a=s*s,o=a*(2*s-3)+1,u=a*(s-2)+s,c=a*(s-1),h=a*(3-2*s);return t[0]=e[0]*o+n[0]*u+r[0]*c+i[0]*h,t[1]=e[1]*o+n[1]*u+r[1]*c+i[1]*h,t[2]=e[2]*o+n[2]*u+r[2]*c+i[2]*h,t}function xt(t,e,n,r,i,s){var a=1-s,o=a*a,u=s*s,c=o*a,h=3*s*o,l=3*u*a,d=u*s;return t[0]=e[0]*c+n[0]*h+r[0]*l+i[0]*d,t[1]=e[1]*c+n[1]*h+r[1]*l+i[1]*d,t[2]=e[2]*c+n[2]*h+r[2]*l+i[2]*d,t}function Ct(t,e){e=e||1;var n=2*u()*Math.PI,r=2*u()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function Nt(t,e,n){var r=e[0],i=e[1],s=e[2],a=n[3]*r+n[7]*i+n[11]*s+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/a,t}function At(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function jt(t,e,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=e[0],u=e[1],c=e[2],h=i*c-s*u,l=s*o-r*c,d=r*u-i*o,f=i*d-s*l,p=s*h-r*d,g=r*l-i*h,m=2*a;return h*=m,l*=m,d*=m,f*=2,p*=2,g*=2,t[0]=o+h+f,t[1]=u+l+p,t[2]=c+d+g,t}function Pt(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Ut(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Dt(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Rt(t,e){var n=st(t[0],t[1],t[2]),r=st(e[0],e[1],e[2]);St(n,n),St(r,r);var i=Tt(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Ft(t){return t[0]=0,t[1]=0,t[2]=0,t}function zt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Lt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Bt(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],u=e[2];return Math.abs(n-s)<=a*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=a*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-u)<=a*Math.max(1,Math.abs(i),Math.abs(u))}var $t,Vt=ct,Gt=ht,qt=lt,Yt=_t,Zt=wt,Kt=it,Ht=vt,Wt=($t=nt(),function(t,e,n,r,i,s){var a,o;for(e||(e=3),n||(n=0),o=r?Math.min(r*e+n,t.length):t.length,a=n;a<o;a+=e)$t[0]=t[a],$t[1]=t[a+1],$t[2]=t[a+2],i($t,$t,s),t[a]=$t[0],t[a+1]=$t[1],t[a+2]=$t[2];return t});function Jt(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function Qt(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}!function(){var t,e=(t=new o(4),o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function Xt(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function te(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ee(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function ne(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>a?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function re(t,e,n){var r=e[0],i=e[1],s=e[2],a=e[3],o=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+a*o+i*c-s*u,t[1]=i*h+a*u+s*o-r*c,t[2]=s*h+a*c+r*u-i*o,t[3]=a*h-r*o-i*u-s*c,t}function ie(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*o,t[1]=i*u+s*o,t[2]=s*u-i*o,t[3]=a*u-r*o,t}function se(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),u=Math.cos(n);return t[0]=r*u-s*o,t[1]=i*u+a*o,t[2]=s*u+r*o,t[3]=a*u-i*o,t}function ae(t,e,n){n*=.5;var r=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*o,t[1]=i*u-r*o,t[2]=s*u+a*o,t[3]=a*u-s*o,t}function oe(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function ue(t,e,n,r){var i,s,o,u,c,h=e[0],l=e[1],d=e[2],f=e[3],p=n[0],g=n[1],m=n[2],b=n[3];return(s=h*p+l*g+d*m+f*b)<0&&(s=-s,p=-p,g=-g,m=-m,b=-b),1-s>a?(i=Math.acos(s),o=Math.sin(i),u=Math.sin((1-r)*i)/o,c=Math.sin(r*i)/o):(u=1-r,c=r),t[0]=u*h+c*p,t[1]=u*l+c*g,t[2]=u*d+c*m,t[3]=u*f+c*b,t}function ce(t){var e=u(),n=u(),r=u(),i=Math.sqrt(1-e),s=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=s*Math.sin(2*Math.PI*r),t[3]=s*Math.cos(2*Math.PI*r),t}function he(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n*n+r*r+i*i+s*s,o=a?1/a:0;return t[0]=-n*o,t[1]=-r*o,t[2]=-i*o,t[3]=s*o,t}function le(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function de(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*s+s]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*s+a]-e[3*a+s])*n,t[s]=(e[3*s+i]+e[3*i+s])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function fe(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var s=Math.sin(e),a=Math.cos(e),o=Math.sin(n),u=Math.cos(n),c=Math.sin(r),h=Math.cos(r);return t[0]=s*u*h-a*o*c,t[1]=a*o*h+s*u*c,t[2]=a*u*c-s*o*h,t[3]=a*u*h+s*o*c,t}function pe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var ge,me,be,ye,_e,we,ve,Ie=function(t){var e=new o(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ke=function(t,e,n,r){var i=new o(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i},Se=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Te=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},Me=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Ee=re,Oe=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},xe=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ce=function(t,e,n,r){var i=e[0],s=e[1],a=e[2],o=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=a+r*(n[2]-a),t[3]=o+r*(n[3]-o),t},Ne=Jt,Ae=Ne,je=Qt,Pe=je,Ue=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],a=n*n+r*r+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=s*a,t},De=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Re=function(t,e){var n=t[0],r=t[1],i=t[2],s=t[3],o=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(n-o)<=a*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=a*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=a*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=a*Math.max(1,Math.abs(s),Math.abs(h))},Fe=(ge=nt(),me=st(1,0,0),be=st(0,1,0),function(t,e,n){var r=Tt(e,n);return r<-.999999?(Mt(ge,me,e),Kt(ge)<1e-6&&Mt(ge,be,e),St(ge,ge),ee(t,ge,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Mt(ge,e,n),t[0]=ge[0],t[1]=ge[1],t[2]=ge[2],t[3]=1+r,Ue(t,t))}),ze=(ye=Xt(),_e=Xt(),function(t,e,n,r,i,s){return ue(ye,e,i,s),ue(_e,n,r,s),ue(t,ye,_e,2*s*(1-s)),t}),Le=(we=new o(9),o!=Float32Array&&(we[1]=0,we[2]=0,we[3]=0,we[5]=0,we[6]=0,we[7]=0),we[0]=1,we[4]=1,we[8]=1,ve=we,function(t,e,n,r){return ve[0]=n[0],ve[3]=n[1],ve[6]=n[2],ve[1]=r[0],ve[4]=r[1],ve[7]=r[2],ve[2]=-e[0],ve[5]=-e[1],ve[8]=-e[2],Ue(t,de(t,ve))});n.d(e,"c",function(){return Be}),n.d(e,"e",function(){return $e}),n.d(e,"h",function(){return Ve}),n.d(e,"g",function(){return Ge}),n.d(e,"f",function(){return qe}),n.d(e,"j",function(){return Ye}),n.d(e,"o",function(){return Ze}),n.d(e,"l",function(){return We}),n.d(e,"m",function(){return Je}),n.d(e,"a",function(){return Qe}),n.d(e,"b",function(){return Xe}),n.d(e,"d",function(){return tn}),n.d(e,"i",function(){return r}),n.d(e,"k",function(){return s}),n.d(e,"n",function(){return i});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Be=r.create();const $e=[i.fromValues(1,0,0),i.fromValues(0,1,0),i.fromValues(0,0,1)],Ve=i.fromValues(0,0,0),Ge=i.fromValues(1,1,1),qe=i.fromValues(1/0,1/0,1/0);s.create();function Ye(t){return t[0]*t[1]*t[2]}function Ze(t){return`${t[0]},${t[1]},${t[2]}`}const Ke=1e-4;function He(t,e){let n=Math.abs(t[e]),r=Math.abs(t[e+1]),i=Math.abs(t[e+2]),s=Math.max(n,r,i);n/s<Ke&&(t[e]=0),r/s<Ke&&(t[e+1]=0),i/s<Ke&&(t[e+2]=0)}function We(t){He(t,0),He(t,4),He(t,8)}function Je(t,e,n){let r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[4]*i+n[8]*s,t[1]=n[1]*r+n[5]*i+n[9]*s,t[2]=n[2]*r+n[6]*i+n[10]*s,t}function Qe(t,e){const n=e[0],r=e[1],i=e[2],s=e[4],a=e[5],o=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(s*s+a*a+o*o),t[2]=Math.sqrt(u*u+c*c+h*h),t}function Xe(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],c=e[7],h=e[8],l=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],b=e[15];t[0]=s+n,t[1]=c+a,t[2]=f+h,t[3]=b+p,t[4]=s-n,t[5]=c-a,t[6]=f-h,t[7]=b-p,t[8]=s+r,t[9]=c+o,t[10]=f+l,t[11]=b+g,t[12]=s-r,t[13]=c-o,t[14]=f-l,t[15]=b-g;const y=s+i,_=c+u,w=f+d,v=b+m,I=Math.sqrt(y**2+_**2+w**2);return t[16]=y/I,t[17]=_/I,t[18]=w/I,t[19]=v/I,t[20]=s-i,t[21]=c-u,t[22]=f-d,t[23]=b-m,t}function tn(t,e,n,r,i,s,a){for(let o=0;o<6;++o){const u=a[4*o],c=a[4*o+1],h=a[4*o+2],l=a[4*o+3];if(Math.max(u*t,u*r)+Math.max(c*e,c*i)+Math.max(h*n,h*s)+l<0)return!1}return!0}},function(t,e,n){"use strict";n.d(e,"f",function(){return l}),n.d(e,"e",function(){return f}),n.d(e,"a",function(){return g}),n.d(e,"b",function(){return m}),n.d(e,"d",function(){return b}),n.d(e,"c",function(){return y}),n.d(e,"h",function(){return w}),n.d(e,"g",function(){return v});var r=n(11),i=n(17);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=!("undefined"!=typeof Window&&self instanceof Window),a=!1,o=!1,u="rpc.promise.response",c="rpc.promise.cancel";var h=new Map;function l(t,e){h.set(t,e)}class d extends Error{constructor(t,e){super(e),this.name=t,this.message=e}}function f(t,e){l(t,function(t){let n=t.id;const i=new r.b;let s=e.call(this,t,i);this.set(n,{promise:s,cancellationToken:i}),s.then(({value:t,transfers:e})=>{this.delete(n),this.invoke(u,{id:n,value:t},e)},t=>{this.delete(n),this.invoke(u,{id:n,error:t.message,errorName:t.name})})})}l(c,function(t){let e=t.id;const n=this.get(e);if(void 0!==n){let{cancellationToken:t}=n;t.cancel()}}),l(u,function(t){let e=t.id,{resolve:n,reject:i}=this.get(e);if(this.delete(e),t.hasOwnProperty("value"))n(t.value);else{t.errorName===r.a.name?i(r.a):i(new d(t.errorName,t.error))}});const p=s?-1:0;class g{constructor(t){this.target=t,this.objects=new Map,this.nextId=p,t.onmessage=(t=>{let e=t.data;o&&console.log("Received message",e),h.get(e.functionName).call(this,e)})}get numObjects(){return this.objects.size}set(t,e){this.objects.set(t,e)}delete(t){this.objects.delete(t)}get(t){return this.objects.get(t)}getRef(t){let e=t.id,n=this.get(e);return n.referencedGeneration=t.gen,n.addRef(),n}invoke(t,e,n){e.functionName=t,o&&console.trace("Sending message",e),this.target.postMessage(e,n)}promiseInvoke(t,e,n=r.e,i){return Object(r.d)(n,(n,r,s)=>{const a=e.id=this.newId();this.set(a,{resolve:n,reject:r}),this.invoke(t,e,i),s.add(()=>{this.invoke(c,{id:a})})})}newId(){return s?this.nextId--:this.nextId++}}class m extends i.a{constructor(){super(...arguments),this.rpc=null,this.rpcId=null}initializeSharedObject(t,e=t.newId()){this.rpc=t,this.rpcId=e,this.isOwner=!1,t.set(e,this)}initializeCounterpart(t,e={}){this.initializeSharedObject(t),this.unreferencedGeneration=0,this.referencedGeneration=0,this.isOwner=!0,e.id=this.rpcId,e.type=this.RPC_TYPE_ID,t.invoke("SharedObject.new",e)}dispose(){super.dispose()}addCounterpartRef(){return{id:this.rpcId,gen:++this.referencedGeneration}}refCountReachedZero(){!0===this.isOwner?this.referencedGeneration===this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):super.refCountReachedZero()}ownerDispose(){a&&console.log(`[${s}] #rpc object = ${this.rpc.numObjects}`);let{rpc:t,rpcId:e}=this;super.refCountReachedZero(),t.delete(e),t.invoke("SharedObject.dispose",{id:e})}counterpartRefCountReachedZero(t){this.unreferencedGeneration=t,0===this.refCount&&t===this.referencedGeneration&&this.ownerDispose()}}function b(t,e,n={}){null!=e&&t.initializeSharedObject(e,n.id)}class y extends m{constructor(t,e={}){super(),b(this,t,e)}}l("SharedObject.dispose",function(t){let e=this.get(t.id);if(0!==e.refCount)throw new Error("Attempted to dispose object with non-zero reference count.");a&&console.log(`[${s}] #rpc objects: ${this.numObjects}`),e.disposed(),this.delete(e.rpcId),e.rpcId=null,e.rpc=null}),l("SharedObject.refCountReachedZero",function(t){let e=this.get(t.id),n=t.gen;e.counterpartRefCountReachedZero(n)});const _=new Map;function w(t){return e=>{e.prototype.RPC_TYPE_ID=t}}function v(t){return e=>{if(void 0!==t)e.prototype.RPC_TYPE_ID=t;else if(void 0===(t=e.prototype.RPC_TYPE_ID))throw new Error("RPC_TYPE_ID should have already been defined");_.set(t,e)}}l("SharedObject.new",function(t){let e=t.type;--new(_.get(e))(this,t).refCount})},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r;n.d(e,"g",function(){return r}),n.d(e,"f",function(){return s}),n.d(e,"d",function(){return o}),n.d(e,"e",function(){return u}),n.d(e,"l",function(){return c}),n.d(e,"m",function(){return h}),n.d(e,"k",function(){return l}),n.d(e,"j",function(){return d}),n.d(e,"h",function(){return f}),n.d(e,"b",function(){return p}),n.d(e,"a",function(){return g}),n.d(e,"c",function(){return m}),n.d(e,"i",function(){return b}),function(t){t[t.GPU_MEMORY=0]="GPU_MEMORY",t[t.SYSTEM_MEMORY=1]="SYSTEM_MEMORY",t[t.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER",t[t.DOWNLOADING=3]="DOWNLOADING",t[t.QUEUED=4]="QUEUED",t[t.NEW=5]="NEW",t[t.FAILED=6]="FAILED",t[t.EXPIRED=7]="EXPIRED"}(r||(r={}));const i=8;var s;!function(t){t[t.FIRST_TIER=0]="FIRST_TIER",t[t.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER",t[t.VISIBLE=0]="VISIBLE",t[t.PREFETCH=1]="PREFETCH",t[t.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER",t[t.RECENT=2]="RECENT",t[t.LAST_TIER=2]="LAST_TIER"}(s||(s={}));const a=3;var o,u;!function(t){t[t.totalTime=0]="totalTime",t[t.totalChunks=1]="totalChunks"}(o||(o={})),function(t){t[t.numChunks=0]="numChunks",t[t.systemMemoryBytes=1]="systemMemoryBytes",t[t.gpuMemoryBytes=2]="gpuMemoryBytes"}(u||(u={}));const c=3,h=i*a*c+2;function l(t,e){return t*a+e}function d(t){return i*a*c+t}const f=1e13,p="ChunkQueueManager",g="ChunkManager",m="ChunkSource.invalidate",b="ChunkQueueManager.requestChunkStatistics"},function(t,e,n){"use strict";n.d(e,"b",function(){return o}),n.d(e,"e",function(){return u}),n.d(e,"d",function(){return g}),n.d(e,"a",function(){return m}),n.d(e,"c",function(){return b}),n.d(e,"i",function(){return y}),n.d(e,"l",function(){return _}),n.d(e,"k",function(){return w}),n.d(e,"j",function(){return v}),n.d(e,"h",function(){return I}),n.d(e,"g",function(){return k}),n.d(e,"f",function(){return S}),n.d(e,"m",function(){return T});var r=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i(t){let e=typeof t;if("number"===e||"string"===e){let e=parseFloat(""+t);if(!Number.isNaN(e))return e}throw new Error(`Expected floating-point number, but received: ${JSON.stringify(t)}.`)}function s(t){let e=i(t);if(Number.isFinite(e))return e;throw new Error(`Expected finite floating-point number, but received: ${e}.`)}function a(t){let e=s(t);if(e>0)return e;throw new Error(`Expected positive finite floating-point number, but received: ${e}.`)}function o(t,e){let n=t.length;if(!Array.isArray(e)||e.length!==n)throw new Error("Incompatible sizes");for(let t=0;t<n;++t)if(!Number.isFinite(parseFloat(e[t])))throw new Error("Non-finite value.");for(let r=0;r<n;++r)t[r]=parseFloat(e[r]);return t}function u(t){if("object"==typeof t){if(null===t)return"null";if(Array.isArray(t)){let e="[",n=t.length,r=0;if(r<n)for(e+=u(t[r]);++r<n;)e+=",",e+=u(t[r]);return e+="]"}let e="{",n=Object.keys(t).sort(),r=0,i=n.length;if(r<i){let s=n[r];for(e+=JSON.stringify(s),e+=":",e+=u(t[s]);++r<i;)e+=",",s=n[r],e+=JSON.stringify(s),e+=":",e+=u(t[s])}return e+="}"}return JSON.stringify(t)}const c=/('(?:[^'\\]|(?:\\.))*')/,h=/("(?:[^'\\]|(?:\\.))*")/,l=new RegExp(`${c.source}|${h.source}`),d=(new RegExp(`${h.source}|${c.source}`),/^((?:[^"'\\]|(?:\\[^']))*)("|\\')/);function f(t,e,n,r){if(t.length>=2&&t.charAt(0)===e&&t.charAt(t.length-1)===e){let i=t.substr(1,t.length-2),s=n;for(;i.length>0;){let t=i.match(r);if(null===t){s+=i;break}s+=t[1],t[2]===n?(s+="\\",s+=n):s+=e,i=i.substr(t.index+t[0].length)}return s+=n}return t}function p(t){return f(t,"'",'"',d)}function g(t){return JSON.parse(function(t){let e="";for(;t.length>0;){let n,r,i=t.match(l);if(null===i)n=t,t="",r="";else{n=t.substr(0,i.index),t=t.substr(i.index+i[0].length);let e=i[1];r=void 0!==e?p(e):i[2]}e+=n.replace(/\(/g,"[").replace(/\)/g,"]").replace("True","true").replace("False","false").replace(/,\s*([\}\]])/g,"$1"),e+=r}return e}(t))}function m(t,e){if(!Array.isArray(t))throw new Error(`Expected array, but received: ${JSON.stringify(t)}.`);return t.map(e)}function b(t,e,n){const r=t.length;if(!Array.isArray(e)||e.length!==r)throw new Error(`Expected length ${r} array, but received: ${JSON.stringify(e)}.`);for(let i=0;i<r;++i)t[i]=n(e[i],i);return t}function y(t){if("object"!=typeof t||null==t||Array.isArray(t))throw new Error(`Expected JSON object, but received: ${JSON.stringify(t)}.`);return t}function _(t){if("string"!=typeof t)throw new Error(`Expected string, but received: ${JSON.stringify(t)}.`);return t}function w(t){if(void 0!==t)return _(t)}function v(t,e,n){let r=t.hasOwnProperty(e)?t[e]:void 0;try{return n(r)}catch(t){throw new Error(`Error parsing ${JSON.stringify(e)} property: ${t.message}`)}}function I(t,e){if("string"==typeof t&&null!==t.match(/^[a-zA-Z]/)&&(t=t.toUpperCase(),e.hasOwnProperty(t)))return e[t];throw new Error(`Invalid enum value: ${JSON.stringify(t)}.`)}function k(t){return b(r.n.create(),t,s)}function S(t){return b(r.n.create(),t,a)}function T(t){if(!Array.isArray(t))throw new Error(`Expected array, received: ${JSON.stringify(t)}.`);for(let e of t)if("string"!=typeof e)throw new Error(`Expected string, received: ${JSON.stringify(e)}.`);return t}},function(t,e,n){"use strict";n.d(e,"a",function(){return o});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const r=new Uint32Array(2),i=4294967296;let s=[];for(let t=2;t<=36;++t){let e=Math.floor(32/Math.log2(t)),n=Math.pow(t,e),r=`^[0-${String.fromCharCode("0".charCodeAt(0)+Math.min(9,t-1))}`;t>10&&(r+=`a-${String.fromCharCode("a".charCodeAt(0)+t-11)}`,r+=`A-${String.fromCharCode("A".charCodeAt(0)+t-11)}`),r+=`]{1,${Math.ceil(64/Math.log2(t))}}$`;let i=new RegExp(r);s[t]={lowDigits:e,lowBase:n,pattern:i}}function a(t,e){const n=65535&(t>>>=0),r=t>>>16,i=65535&(e>>>=0),s=e>>>16;let a=(n*i>>>16)+r*i,o=a>>>16,u=(o+=(a=(65535&a)+n*s)>>>16)>>>16;return((65535&(u+=(o=(65535&o)+r*s)>>>16))<<16|65535&o)>>>0}class o{constructor(t=0,e=0){this.low=t,this.high=e}clone(){return new o(this.low,this.high)}assign(t){this.low=t.low,this.high=t.high}toString(t=10){let e=this.low,n=this.high;if(0===n)return e.toString(t);n*=i;let{lowBase:r,lowDigits:a}=s[t],o=n%r;n=Math.floor(n/r),e+=o,n+=Math.floor(e/r);let u=(e%=r).toString(t);return n.toString(t)+"0".repeat(a-u.length)+u}static less(t,e){return t.high<e.high||t.high===e.high&&t.low<e.low}static compare(t,e){return t.high-e.high||t.low-e.low}static equal(t,e){return t.low===e.low&&t.high===e.high}static min(t,e){return o.less(t,e)?t:e}static max(t,e){return o.less(t,e)?e:t}static random(){return crypto.getRandomValues(r),new o(r[0],r[1])}tryParseString(t,e=10){const{lowDigits:n,lowBase:r,pattern:o}=s[e];if(!o.test(t))return!1;if(t.length<=n)return this.low=parseInt(t,e),this.high=0,!0;const u=t.length-n,c=parseInt(t.substr(u),e),h=parseInt(t.substr(0,u),e);let l,d;if(r===i)l=h,d=c;else{const t=Math.imul(h,r)>>>0;l=a(h,r)+(Math.imul(Math.floor(h/i),r)>>>0),(d=c+t)>=i&&(++l,d-=i)}return d>>>0===d&&l>>>0===l&&(this.low=d,this.high=l,!0)}parseString(t,e=10){if(!this.tryParseString(t,e))throw new Error(`Failed to parse string as uint64 value: ${JSON.stringify(t)}.`);return this}static parseString(t,e=10){return(new o).parseString(t,e)}valid(){let{low:t,high:e}=this;return t>>>0===t&&e>>>0===e}toJSON(){return this.toString()}static lshift(t,e,n){const{low:r,high:i}=e;return 0===n?(t.low=r,t.high=i):n<32?(t.low=r<<n,t.high=i<<n|r>>>32-n):(t.low=0,t.high=r<<n-32),t}static rshift(t,e,n){const{low:r,high:i}=e;return 0===n?(t.low=r,t.high=i):n<32?(t.low=r>>>n|i<<32-n,t.high=i>>>n):(t.low=i>>>n-32,t.high=0),t}static or(t,e,n){return t.low=e.low|n.low,t.high=e.high|n.high,t}static xor(t,e,n){return t.low=e.low^n.low,t.high=e.high^n.high,t}static and(t,e,n){return t.low=e.low&n.low,t.high=e.high&n.high,t}static add(t,e,n){let r=e.low+n.low,i=e.high+n.high;const s=r>>>0;return s!==r&&(i+=1),t.low=s,t.high=i>>>0,t}static addUint32(t,e,n){let r=e.low+n,i=e.high;const s=r>>>0;return s!==r&&(i+=1),t.low=s,t.high=i>>>0,t}static decrement(t,e){let{low:n,high:r}=e;return 0===n&&(r-=1),t.low=n-1>>>0,t.high=r>>>0,t}static increment(t,e){let{low:n,high:r}=e;return 4294967295===n&&(r+=1),t.low=n+1>>>0,t.high=r>>>0,t}static subtract(t,e,n){let r=e.low-n.low,i=e.high-n.high;const s=r>>>0;return s!==r&&(i-=1),t.low=s,t.high=i>>>0,t}static multiplyUint32(t,e,n){const{low:r,high:i}=e;return t.low=Math.imul(r,n)>>>0,t.high=Math.imul(i,n)+a(r,n)>>>0,t}static lowMask(t,e){return e<=32?(t.high=0,t.low=4294967295>>>32-e):(t.high=4294967295>>>e-32,t.low=4294967295),t}}o.ZERO=new o(0,0),o.ONE=new o(1,0)},function(t,e,n){"use strict";n.r(e);var r=n(2),i=n(11),s=n(17),a=class{static insertAfter(t,e){let n=t.next0;e.next0=n,e.prev0=t,t.next0=e,n.prev0=e}static insertBefore(t,e){let n=t.prev0;e.prev0=n,e.next0=t,t.prev0=e,n.next0=e}static front(t){let e=t.next0;return e===t?null:e}static back(t){let e=t.prev0;return e===t?null:e}static pop(t){let e=t.next0,n=t.prev0;return e.prev0=n,n.next0=e,t.next0=null,t.prev0=null,t}static*iterator(t){for(let e=t.next0;e!==t;e=e.next0)yield e}static*reverseIterator(t){for(let e=t.prev0;e!==t;e=e.prev0)yield e}static initializeHead(t){t.next0=t.prev0=t}},o=class{static insertAfter(t,e){let n=t.next1;e.next1=n,e.prev1=t,t.next1=e,n.prev1=e}static insertBefore(t,e){let n=t.prev1;e.prev1=n,e.next1=t,t.prev1=e,n.next1=e}static front(t){let e=t.next1;return e===t?null:e}static back(t){let e=t.prev1;return e===t?null:e}static pop(t){let e=t.next1,n=t.prev1;return e.prev1=n,n.next1=e,t.next1=null,t.prev1=null,t}static*iterator(t){for(let e=t.next1;e!==t;e=e.next1)yield e}static*reverseIterator(t){for(let e=t.prev1;e!==t;e=e.prev1)yield e}static initializeHead(t){t.next1=t.prev1=t}},u=n(38);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class c{constructor(t){this.compare=t}meld(t,e){if(null===e)return t;if(null===t)return e;let{compare:n}=this;if(n(e,t)){let n=t;t=e,e=n}var r=t.child0;return e.next0=r,e.prev0=t,null!==r&&(r.prev0=e),t.child0=e,t}combineChildren(t){var e=t.child0;if(null===e)return null;let n=null;for(;;){let t,r,i=e.next0;if(null===i?(t=null,r=e):(t=i.next0,r=this.meld(e,i)),r.next0=n,n=r,null===t)break;e=t}var r=n;for(n=n.next0;null!==n;){let t=n.next0;r=this.meld(r,n),n=t}return r.prev0=null,r.next0=null,r}removeMin(t){var e=this.combineChildren(t);return t.next0=null,t.prev0=null,t.child0=null,e}remove(t,e){if(t===e)return this.removeMin(t);var n=e.prev0,r=e.next0;n.child0===e?n.child0=r:n.next0=r,null!==r&&(r.prev0=n);let i=this.meld(t,this.combineChildren(e));return e.next0=null,e.prev0=null,e.child0=null,i}*entries(t){if(null!==t){let e=t.child0;for(yield t;null!==e;){let t=e.next0;yield*this.entries(e),e=t}}}*removedEntries(t){if(null!==t){let e=t.child0;for(t.child0=null,t.next0=null,t.prev0=null,yield t;null!==e;){let t=e.next0;e.child0=null,e.next0=null,e.prev0=null,yield*this.entries(e),e=t}}}}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h{constructor(t){this.compare=t}meld(t,e){if(null===e)return t;if(null===t)return e;let{compare:n}=this;if(n(e,t)){let n=t;t=e,e=n}var r=t.child1;return e.next1=r,e.prev1=t,null!==r&&(r.prev1=e),t.child1=e,t}combineChildren(t){var e=t.child1;if(null===e)return null;let n=null;for(;;){let t,r,i=e.next1;if(null===i?(t=null,r=e):(t=i.next1,r=this.meld(e,i)),r.next1=n,n=r,null===t)break;e=t}var r=n;for(n=n.next1;null!==n;){let t=n.next1;r=this.meld(r,n),n=t}return r.prev1=null,r.next1=null,r}removeMin(t){var e=this.combineChildren(t);return t.next1=null,t.prev1=null,t.child1=null,e}remove(t,e){if(t===e)return this.removeMin(t);var n=e.prev1,r=e.next1;n.child1===e?n.child1=r:n.next1=r,null!==r&&(r.prev1=n);let i=this.meld(t,this.combineChildren(e));return e.next1=null,e.prev1=null,e.child1=null,i}*entries(t){if(null!==t){let e=t.child1;for(yield t;null!==e;){let t=e.next1;yield*this.entries(e),e=t}}}*removedEntries(t){if(null!==t){let e=t.child1;for(t.child1=null,t.next1=null,t.prev1=null,yield t;null!==e;){let t=e.next1;e.child1=null,e.next1=null,e.prev1=null,yield*this.entries(e),e=t}}}}var l=n(13),d=n(1);n.d(e,"Chunk",function(){return p}),n.d(e,"ChunkSourceBase",function(){return g}),n.d(e,"ChunkSource",function(){return b}),n.d(e,"ChunkQueueManager",function(){return S}),n.d(e,"ChunkManager",function(){return T}),n.d(e,"WithParameters",function(){return M}),n.d(e,"withChunkManager",function(){return E});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var f=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};class p{constructor(){this.child0=null,this.next0=null,this.prev0=null,this.child1=null,this.next1=null,this.prev1=null,this.source=null,this.key=null,this.state_=r.g.NEW,this.error=null,this.priority=0,this.newPriority=0,this.priorityTier=r.f.RECENT,this.newPriorityTier=r.f.RECENT,this.backendOnly=!1,this.isComputational=!1,this.newlyRequestedToFrontend=!1,this.requestedToFrontend=!1,this.downloadCancellationToken=void 0}initialize(t){this.key=t,this.priority=Number.NEGATIVE_INFINITY,this.priorityTier=r.f.RECENT,this.newPriority=Number.NEGATIVE_INFINITY,this.newPriorityTier=r.f.RECENT,this.error=null,this.state=r.g.NEW,this.requestedToFrontend=!1,this.newlyRequestedToFrontend=!1}updatePriorityProperties(){this.priorityTier=this.newPriorityTier,this.priority=this.newPriority,this.newPriorityTier=r.f.RECENT,this.newPriority=Number.NEGATIVE_INFINITY,this.requestedToFrontend=this.newlyRequestedToFrontend}dispose(){this.source=null,this.error=null}get chunkManager(){return this.source.chunkManager}get queueManager(){return this.source.chunkManager.queueManager}downloadFailed(t){this.error=t,this.queueManager.updateChunkState(this,r.g.FAILED)}downloadSucceeded(){this.queueManager.updateChunkState(this,r.g.SYSTEM_MEMORY_WORKER)}freeSystemMemory(){}serialize(t,e){t.id=this.key,t.source=this.source.rpcId,t.new=!0}toString(){return this.key}set state(t){if(t===this.state_)return;const e=this.state_;this.state_=t,this.source.chunkStateChanged(this,e)}get state(){return this.state_}set systemMemoryBytes(t){m(this,-1),this.chunkManager.queueManager.adjustCapacitiesForChunk(this,!1),this.systemMemoryBytes_=t,this.chunkManager.queueManager.adjustCapacitiesForChunk(this,!0),m(this,1),this.chunkManager.queueManager.scheduleUpdate()}get systemMemoryBytes(){return this.systemMemoryBytes_}set gpuMemoryBytes(t){m(this,-1),this.chunkManager.queueManager.adjustCapacitiesForChunk(this,!1),this.gpuMemoryBytes_=t,this.chunkManager.queueManager.adjustCapacitiesForChunk(this,!0),m(this,1),this.chunkManager.queueManager.scheduleUpdate()}get gpuMemoryBytes(){return this.gpuMemoryBytes_}registerListener(t){return!!this.source&&this.source.registerChunkListener(this.key,t)}unregisterListener(t){return!!this.source&&this.source.unregisterChunkListener(this.key,t)}static priorityLess(t,e){return t.priority<e.priority}static priorityGreater(t,e){return t.priority>e.priority}}class g extends d.b{constructor(t){super(),this.chunkManager=t,this.listeners_=new Map,this.chunks=new Map,this.freeChunks=new Array,this.statistics=new Float64Array(r.m),this.sourceQueueLevel=0,t.queueManager.sources.add(this)}disposed(){this.chunkManager.queueManager.sources.delete(this),super.disposed()}getNewChunk_(t){let e=this.freeChunks,n=e.length;if(n>0){let t=e[n-1];return e.length=n-1,t.source=this,t}let r=new t;return r.source=this,r}addChunk(t){let{chunks:e}=this;0===e.size&&this.addRef(),e.set(t.key,t),m(t,1)}removeChunk(t){let{chunks:e,freeChunks:n}=this;e.delete(t.key),t.dispose(),n[n.length]=t,0===e.size&&this.dispose()}registerChunkListener(t,e){return this.listeners_.has(t)?this.listeners_.get(t).push(e):this.listeners_.set(t,[e]),!0}unregisterChunkListener(t,e){if(!this.listeners_.has(t))return!1;const n=this.listeners_.get(t),r=n.indexOf(e);return!(r<0)&&(n.splice(r,1),0===n.length&&this.listeners_.delete(t),!0)}chunkStateChanged(t,e){if(t.key&&this.listeners_.has(t.key))for(const n of[...this.listeners_.get(t.key)])n.stateChanged(t,e)}}function m(t,e){const{statistics:n}=t.source,{systemMemoryBytes:i,gpuMemoryBytes:s}=t,a=Object(r.k)(t.state,t.priorityTier);n[a*r.l+r.e.numChunks]+=e,n[a*r.l+r.e.systemMemoryBytes]+=e*i,n[a*r.l+r.e.gpuMemoryBytes]+=e*s}class b extends g{constructor(t,e){super(t.get(e.chunkManager)),Object(d.d)(this,t,e)}}function y(t){const e=t.downloadCancellationToken=new i.b,n=Date.now();t.source.download(t,e).then(()=>{if(t.downloadCancellationToken===e){t.downloadCancellationToken=void 0;const e=Date.now(),{statistics:i}=t.source;i[Object(r.j)(r.d.totalTime)]+=e-n,++i[Object(r.j)(r.d.totalChunks)],t.downloadSucceeded()}},n=>{t.downloadCancellationToken===e&&(t.downloadCancellationToken=void 0,t.downloadFailed(n),console.log(`Error retrieving chunk ${t}: ${n}`))})}function _(t){const e=t.downloadCancellationToken;t.downloadCancellationToken=void 0,e.cancel()}class w{constructor(t,e){this.heapOperations=t,this.linkedListOperations=e,this.heapRoots=[null,null],this.recentHead=new p,e.initializeHead(this.recentHead)}add(t){let e=t.priorityTier;if(e===r.f.RECENT)this.linkedListOperations.insertAfter(this.recentHead,t);else{let{heapRoots:n}=this;n[e]=this.heapOperations.meld(n[e],t)}}*candidates(){if(this.heapOperations.compare===p.priorityLess){let{linkedListOperations:t,recentHead:e}=this;for(;;){let n=t.back(e);if(null==n)break;yield n}let{heapRoots:n}=this;for(let t=r.f.LAST_ORDERED_TIER;t>=r.f.FIRST_ORDERED_TIER;--t)for(;;){let e=n[t];if(null==e)break;yield e}}else{let t=this.heapRoots;for(let e=r.f.FIRST_ORDERED_TIER;e<=r.f.LAST_ORDERED_TIER;++e)for(;;){let n=t[e];if(null==n)break;yield n}let{linkedListOperations:e,recentHead:n}=this;for(;;){let t=e.front(n);if(null==t)break;yield t}}}delete(t){let e=t.priorityTier;if(e===r.f.RECENT)this.linkedListOperations.pop(t);else{let n=this.heapRoots;n[e]=this.heapOperations.remove(n[e],t)}}}function v(t){return new w(new h(t),o)}function I(t,e,n,r,i,s){for(;e.availableItems<1||e.availableSize<t;){let t=i.next().value;if(void 0===t)return!1;{let e=t.priorityTier;if(e<n||e===n&&t.priority>=r)return!1;s(t)}}return!0}class k extends s.a{constructor(t,e){super(),this.itemLimit=t,this.sizeLimit=e,this.currentSize=0,this.currentItems=0,this.capacityChanged=new l.a,this.registerDisposer(t.changed.add(this.capacityChanged.dispatch)),this.registerDisposer(e.changed.add(this.capacityChanged.dispatch))}adjust(t,e){this.currentItems-=t,this.currentSize-=e}get availableSize(){return this.sizeLimit.value-this.currentSize}get availableItems(){return this.itemLimit.value-this.currentItems}}let S=class extends d.c{constructor(t,e){var n;super(t,e),this.sources=new Set,this.queuedDownloadPromotionQueue=[v(p.priorityGreater),v(p.priorityGreater)],this.queuedComputePromotionQueue=v(p.priorityGreater),this.downloadEvictionQueue=[v(p.priorityLess),v(p.priorityLess)],this.computeEvictionQueue=v(p.priorityLess),this.systemMemoryEvictionQueue=(n=p.priorityLess,new w(new c(n),a)),this.gpuMemoryPromotionQueue=v(p.priorityGreater),this.gpuMemoryEvictionQueue=v(p.priorityLess),this.updatePending=null,this.numQueued=0,this.numFailed=0;const r=e=>{const n=this.registerDisposer(new k(t.get(e.itemLimit),t.get(e.sizeLimit)));return n.capacityChanged.add(()=>this.scheduleUpdate()),n};this.gpuMemoryCapacity=r(e.gpuMemoryCapacity),this.systemMemoryCapacity=r(e.systemMemoryCapacity),this.downloadCapacity=[r(e.downloadCapacity),r(e.downloadCapacity)],this.computeCapacity=r(e.computeCapacity)}scheduleUpdate(){null===this.updatePending&&(this.updatePending=setTimeout(this.process.bind(this),0))}*chunkQueuesForChunk(t){switch(t.state){case r.g.QUEUED:t.isComputational?yield this.queuedComputePromotionQueue:yield this.queuedDownloadPromotionQueue[t.source.sourceQueueLevel];break;case r.g.DOWNLOADING:t.isComputational?yield this.computeEvictionQueue:(yield this.downloadEvictionQueue[t.source.sourceQueueLevel],yield this.systemMemoryEvictionQueue);break;case r.g.SYSTEM_MEMORY_WORKER:case r.g.SYSTEM_MEMORY:yield this.systemMemoryEvictionQueue,t.priorityTier!==r.f.RECENT&&!t.backendOnly&&t.requestedToFrontend&&(yield this.gpuMemoryPromotionQueue);break;case r.g.GPU_MEMORY:yield this.systemMemoryEvictionQueue,yield this.gpuMemoryEvictionQueue}}adjustCapacitiesForChunk(t,e){let n=e?-1:1;switch(t.state){case r.g.FAILED:this.numFailed-=n;break;case r.g.QUEUED:this.numQueued-=n;break;case r.g.DOWNLOADING:(t.isComputational?this.computeCapacity:this.downloadCapacity[t.source.sourceQueueLevel]).adjust(n,n*t.systemMemoryBytes),this.systemMemoryCapacity.adjust(n,n*t.systemMemoryBytes);break;case r.g.SYSTEM_MEMORY:case r.g.SYSTEM_MEMORY_WORKER:this.systemMemoryCapacity.adjust(n,n*t.systemMemoryBytes);break;case r.g.GPU_MEMORY:this.systemMemoryCapacity.adjust(n,n*t.systemMemoryBytes),this.gpuMemoryCapacity.adjust(n,n*t.gpuMemoryBytes)}}removeChunkFromQueues_(t){m(t,-1);for(let e of this.chunkQueuesForChunk(t))e.delete(t)}addChunkToQueues_(t){if(t.state===r.g.QUEUED&&t.priorityTier===r.f.RECENT){let{source:e}=t;return e.removeChunk(t),this.adjustCapacitiesForChunk(t,!1),!1}m(t,1);for(let e of this.chunkQueuesForChunk(t))e.add(t);return!0}performChunkPriorityUpdate(t){if(t.priorityTier===t.newPriorityTier&&t.priority===t.newPriority)return t.newPriorityTier=r.f.RECENT,void(t.newPriority=Number.NEGATIVE_INFINITY);this.removeChunkFromQueues_(t),t.updatePriorityProperties(),t.state===r.g.NEW&&(t.state=r.g.QUEUED,this.adjustCapacitiesForChunk(t,!0)),this.addChunkToQueues_(t)}updateChunkState(t,e){e!==t.state&&(this.adjustCapacitiesForChunk(t,!1),this.removeChunkFromQueues_(t),t.state=e,this.adjustCapacitiesForChunk(t,!0),this.addChunkToQueues_(t),this.scheduleUpdate())}processGPUPromotions_(){let t=this;function e(e){t.freeChunkGPUMemory(e),e.source.chunkManager.queueManager.updateChunkState(e,r.g.SYSTEM_MEMORY)}let n=this.gpuMemoryPromotionQueue.candidates(),i=this.gpuMemoryEvictionQueue.candidates(),s=this.gpuMemoryCapacity;for(;;){let t=n.next().value;if(void 0===t)break;{let n=t.priorityTier,a=t.priority;if(!I(t.gpuMemoryBytes,s,n,a,i,e))break;this.copyChunkToGPU(t),this.updateChunkState(t,r.g.GPU_MEMORY)}}}freeChunkGPUMemory(t){this.rpc.invoke("Chunk.update",{id:t.key,state:r.g.SYSTEM_MEMORY,source:t.source.rpcId})}freeChunkSystemMemory(t){t.state===r.g.SYSTEM_MEMORY_WORKER?t.freeSystemMemory():this.rpc.invoke("Chunk.update",{id:t.key,state:r.g.EXPIRED,source:t.source.rpcId})}retrieveChunkData(t){return this.rpc.promiseInvoke("Chunk.retrieve",{key:t.key,source:t.source.rpcId})}copyChunkToGPU(t){let e=this.rpc;if(t.state===r.g.SYSTEM_MEMORY)e.invoke("Chunk.update",{id:t.key,source:t.source.rpcId,state:r.g.GPU_MEMORY});else{let n={},i=[];t.serialize(n,i),n.state=r.g.GPU_MEMORY,e.invoke("Chunk.update",n,i)}}processQueuePromotions_(){let t=this;const e=e=>{switch(e.state){case r.g.DOWNLOADING:_(e);break;case r.g.GPU_MEMORY:t.freeChunkGPUMemory(e);case r.g.SYSTEM_MEMORY_WORKER:case r.g.SYSTEM_MEMORY:t.freeChunkSystemMemory(e)}this.updateChunkState(e,r.g.QUEUED)},n=(t,n,i)=>{let s=this.systemMemoryEvictionQueue.candidates(),a=this.systemMemoryCapacity;for(;;){let o=t.next();if(o.done)return;let u=o.value;const c=0;let h=u.priorityTier,l=u.priority;if(!I(c,i,h,l,n,e))return;if(!I(c,a,h,l,s,e))return;this.updateChunkState(u,r.g.DOWNLOADING),y(u)}};for(let t=0;t<2;++t)n(this.queuedDownloadPromotionQueue[t].candidates(),this.downloadEvictionQueue[t].candidates(),this.downloadCapacity[t]);n(this.queuedComputePromotionQueue.candidates(),this.computeEvictionQueue.candidates(),this.computeCapacity)}process(){this.updatePending&&(this.updatePending=null,this.processGPUPromotions_(),this.processQueuePromotions_(),this.logStatistics())}logStatistics(){0}invalidateSourceCache(t){for(const e of t.chunks.values()){switch(e.state){case r.g.DOWNLOADING:_(e);break;case r.g.SYSTEM_MEMORY_WORKER:e.freeSystemMemory()}this.updateChunkState(e,r.g.QUEUED)}this.rpc.invoke("Chunk.update",{source:t.rpcId}),this.scheduleUpdate()}};S=f([Object(d.g)(r.b)],S);let T=class extends d.c{constructor(t,e){super(t,e),this.existingTierChunks=[],this.newTierChunks=[],this.updatePending=null,this.recomputeChunkPriorities=new l.a,this.recomputeChunkPrioritiesLate=new l.a,this.memoize=new u.a,this.queueManager=t.get(e.chunkQueueManager).addRef();for(let t=r.f.FIRST_TIER;t<=r.f.LAST_TIER;++t)t!==r.f.RECENT&&(this.existingTierChunks[t]=[])}scheduleUpdateChunkPriorities(){null===this.updatePending&&(this.updatePending=setTimeout(this.recomputeChunkPriorities_.bind(this),0))}recomputeChunkPriorities_(){this.updatePending=null,this.recomputeChunkPriorities.dispatch(),this.recomputeChunkPrioritiesLate.dispatch(),this.updateQueueState([r.f.VISIBLE])}requestChunk(t,e,n,i=!0){if(e===r.f.RECENT)throw new Error("Not going to request a chunk with the RECENT tier");t.newlyRequestedToFrontend=t.newlyRequestedToFrontend||i,t.newPriorityTier===r.f.RECENT&&this.newTierChunks.push(t);const s=t.newPriorityTier;(e<s||e===s&&n>t.newPriority)&&(t.newPriorityTier=e,t.newPriority=n)}updateQueueState(t){let e=this.existingTierChunks,n=this.queueManager;for(let i of t){let t=e[i];for(let e of t)e.newPriorityTier===r.f.RECENT&&n.performChunkPriorityUpdate(e);t.length=0}let i=this.newTierChunks;for(let t of i)n.performChunkPriorityUpdate(t),e[t.priorityTier].push(t);i.length=0,this.queueManager.scheduleUpdate()}};function M(t,e){let n=class extends t{constructor(...t){super(...t);const e=t[1];this.parameters=e.parameters}};return n=f([Object(d.h)(e.RPC_ID)],n)}function E(t){return class extends t{constructor(...t){super(...t);const e=t[0],n=t[1];this.chunkManager=e.get(n.chunkManager)}}}T=f([Object(d.g)(r.a)],T),Object(d.f)(r.c,function(t){const e=this.get(t.id);e.chunkManager.queueManager.invalidateSourceCache(e)}),Object(d.e)(r.i,function(t){const e=this.get(t.queue),n=new Map;for(const t of e.sources)n.set(t.rpcId,t.statistics);return Promise.resolve({value:n})})},function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"d",function(){return o}),n.d(e,"e",function(){return u}),n.d(e,"b",function(){return c}),n.d(e,"c",function(){return l});var r=n(11),i=n(4);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s extends Error{constructor(t,e,n){let r=`Fetching ${JSON.stringify(t)} resulted in HTTP error ${e}`;n&&(r+=`: ${n}`),super(r+="."),this.name="HttpError",this.message=r,this.url=t,this.status=e,this.statusText=n}static fromResponse(t){return new s(t.url,t.status,t.statusText)}}async function a(t,e){let n;try{n=await fetch(t,e)}catch(t){if(t instanceof TypeError)throw new s("",0,"");throw t}if(!n.ok)throw s.fromResponse(n);return n}function o(t){return t.arrayBuffer()}function u(t){return t.json()}async function c(t,e,n,i=r.e){if(i===r.e){const r=await a(t,e);return await n(r)}const s=new AbortController,o=i.add(()=>s.abort());try{const r=await a(t,e);return await n(r)}finally{o()}}const h=new i.a;function l(t,e){let n;return"number"==typeof e?n=`${e-1}`:(i.a.decrement(h,e),n=h.toString()),{Range:`bytes=${t}-${n}`}}},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r;n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"c",function(){return o}),n.d(e,"d",function(){return u}),function(t){t[t.LITTLE=0]="LITTLE",t[t.BIG=1]="BIG"}(r||(r={}));const i=function(){const t=Uint16Array.of(4386);return 17===new Uint8Array(t.buffer)[0]?r.BIG:r.LITTLE}();function s(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(let t=0,n=e.length;t<n;t+=2){let n=e[t];e[t]=e[t+1],e[t+1]=n}}function a(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(let t=0,n=e.length;t<n;t+=4){let n=e[t];e[t]=e[t+3],e[t+3]=n,n=e[t+1],e[t+1]=e[t+2],e[t+2]=n}}function o(t,e,n=i){e!==n&&s(t)}function u(t,e,n=i){e!==n&&a(t)}},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var r;n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i}),function(t){t[t.UINT8=0]="UINT8",t[t.UINT16=1]="UINT16",t[t.UINT32=2]="UINT32",t[t.UINT64=3]="UINT64",t[t.FLOAT32=4]="FLOAT32"}(r||(r={}));const i=[];i[r.UINT8]=1,i[r.UINT16]=2,i[r.UINT32]=4,i[r.UINT64]=8,i[r.FLOAT32]=4},function(t,e,n){"use strict";var r=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i{constructor(t,e=r.c){this.size=r.n.clone(t),this.transform=r.i.clone(e),this.invTransform=r.i.invert(r.i.create(),e)}toObject(t){t.size=this.size,t.transform=this.transform}static get(t,e=r.c){let n=i.cache;const s=JSON.stringify([Array.from(t),Array.from(e)]);let a=n.get(s);return void 0===a&&(a=new i(t,e),n.set(s,a)),a}static fromObject(t){return i.get(t.size,t.transform)}localSpatialToGlobal(t,e){return r.n.transformMat4(t,e,this.transform)}globalToLocalSpatial(t,e){return r.n.transformMat4(t,e,this.invTransform)}globalToLocalGrid(t,e){return this.globalToLocalSpatial(t,e),r.n.divide(t,t,this.size),t}localSpatialVectorToGlobal(t,e){return Object(r.m)(t,e,this.transform)}globalToLocalSpatialVector(t,e){return Object(r.m)(t,e,this.invTransform)}assignLocalSpatialToGlobalMat4(t){return r.i.copy(t,this.transform)}}i.cache=new Map;var s=n(8),a=n(1);n.d(e,"h",function(){return m}),n.d(e,"l",function(){return y}),n.d(e,"k",function(){return v}),n.d(e,"j",function(){return I}),n.d(e,"i",function(){return k}),n.d(e,"f",function(){return S}),n.d(e,"d",function(){return T}),n.d(e,"b",function(){return M}),n.d(e,"c",function(){return E}),n.d(e,"g",function(){return O}),n.d(e,"e",function(){return x}),n.d(e,"a",function(){return s.b});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=!1,u=!1,c=r.n.create();function h(t,e){const n=e.size,r=e.globalToLocalSpatialVector(c,t);let i=0,s=0,a=1;for(let t=0;t<3;++t){const e=n[t];a*=e;const o=e*r[t];i=Math.min(i,o),s=Math.max(s,o)}return a/(s-i)}var l;function d(t,e,n,r){let i=l.FULLY_INSIDE;for(let c=0;c<3;++c){let h=(s=t[c],a=e[c],o=n[c],u=r[c],s>=u||a<=o?l.FULLY_OUTSIDE:s>=o&&a<=u?l.FULLY_INSIDE:l.PARTIALLY_INSIDE);switch(h){case l.FULLY_OUTSIDE:return h;case l.PARTIALLY_INSIDE:i=h}}var s,a,o,u;return i}function f(t){const{transform:e}=t;let{transformedSources:n}=t;const s=e.changed.count;return s!==t.transformedSourcesGeneration&&(t.transformedSourcesGeneration=s,n=r.i.equals(e.transform,r.c)?t.sources.map(t=>t.map(t=>({source:t,chunkLayout:t.spec.chunkLayout,voxelSize:t.spec.voxelSize}))):t.sources.map(t=>t.map(t=>{const n=t.spec.chunkLayout,s=i.get(n.size,v(n.transform,e));return{chunkLayout:s,source:t,voxelSize:s.localSpatialVectorToGlobal(r.n.create(),t.spec.voxelSize)}})),t.transformedSources=n),n}function p(t,e){let n=e.length,r=0;if(u&&console.log(e),n>1){let i=0;for(let s=0;s<n;++s){let n=e[s];const{chunkLayout:a}=n;let o=h(t,a);u&&console.log(`zAxis = ${t}, chunksize = ${a.size}, sliceArea = ${o}`),o>i&&(i=o,r=s)}}return e[r]}!function(t){t[t.FULLY_OUTSIDE=0]="FULLY_OUTSIDE",t[t.FULLY_INSIDE=1]="FULLY_INSIDE",t[t.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"}(l||(l={}));const g=[r.n.create(),r.n.create(),r.n.create(),r.n.create()];class m extends a.b{constructor(){super(),this.width=-1,this.height=-1,this.hasViewportToData=!1,this.hasValidViewport=!1,this.viewportToData=r.i.create(),this.viewportAxes=[r.n.create(),r.n.create(),r.n.create()],this.previousViewportAxes=[r.n.create(),r.n.create()],this.centerDataPosition=r.n.create(),this.viewportPlaneDistanceToOrigin=0,this.visibleChunkLayouts=new Map,this.visibleLayers=new Map,this.visibleSourcesStale=!0,this.pixelSize=0,r.i.identity(this.viewportToData)}onViewportChanged(){}maybeSetHasValidViewport(){!this.hasValidViewport&&-1!==this.width&&-1!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport()),this.hasValidViewport&&this.onViewportChanged()}onHasValidViewport(){}setViewportSize(t,e){return(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.maybeSetHasValidViewport(),!0)}setViewportToDataMatrix(t){if(this.hasViewportToData&&r.i.equals(this.viewportToData,t))return!1;this.hasViewportToData=!0;let{viewportToData:e}=this;r.i.copy(e,t),Object(r.l)(e),r.n.transformMat4(this.centerDataPosition,r.h,t);let n=0,i=this.viewportAxes,s=this.previousViewportAxes;for(var a=0;a<3;++a){let t=i[a];Object(r.m)(t,r.e[a],e),0===a&&(n=r.n.length(t)),r.n.normalize(t,t)}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var o,u;return this.viewportAxes=i,this.previousViewportAxes=s,o=n,u=this.pixelSize,(!(o===u||Math.abs(o-u)/Math.min(Math.abs(o),Math.abs(u))<1e-6)||r.n.dot(i[0],s[0])<.95||r.n.dot(i[1],s[1])<.95)&&(r.n.copy(s[0],i[0]),r.n.copy(s[1],i[1]),this.visibleSourcesStale=!0,this.pixelSize=n),this.viewportPlaneDistanceToOrigin=r.n.dot(this.centerDataPosition,this.viewportAxes[2]),this.onViewportToDataMatrixChanged(),this.maybeSetHasValidViewport(),!0}onViewportToDataMatrixChanged(){}updateVisibleSources(){if(!this.visibleSourcesStale)return;this.visibleSourcesStale=!1;let t=1.1*this.pixelSize,e=this.visibleChunkLayouts;const n=this.viewportAxes[2];let r=this.visibleLayers;e.clear();for(let[i,s]of r){s.length=0;let r,a=f(i),o=a.length,u=a[0][0].voxelSize;const c=i.renderScaleTarget.value,h=e=>{const n=t*c;for(let t=0;t<3;++t){const r=e[t];if(r>n&&r>1.01*u[t])return!0}return!1},l=(e,n)=>{const r=t*c;for(let t=0;t<3;++t){const i=e[t],s=n[t];if(Math.abs(r-i)<Math.abs(r-s)&&i<1.01*s)return!0}return!1},d=(t,n)=>{const{source:r,chunkLayout:i}=t;s[s.length++]=t;let a=e.get(i);void 0===a&&(a=new Map,e.set(i,a)),a.set(r,n)};let g;for(r=o-1;;){const t=p(n,a[r]);if(void 0!==g&&!l(t.voxelSize,g))break;if(d(t,r),0===r||!h(t.voxelSize))break;g=t.voxelSize,--r}s.reverse()}}computeVisibleChunks(t,e){this.updateVisibleSources();const n=g;let{width:i,height:s,viewportToData:a}=this;for(let t=0;t<3;++t)n[0][t]=-r.e[0][t]*i/2-r.e[1][t]*s/2,n[1][t]=-r.e[0][t]*i/2+r.e[1][t]*s/2,n[2][t]=r.e[0][t]*i/2-r.e[1][t]*s/2,n[3][t]=r.e[0][t]*i/2+r.e[1][t]*s/2;for(let t=0;t<4;++t)r.n.transformMat4(n[t],n[t],a);var u=r.n.create(),h=r.n.create();let f=r.n.create(),p=r.n.create();var m=r.n.create(),b=r.n.create();let y=new Array,_=new Array;this.visibleChunkLayouts.forEach((i,s)=>{let a=t(s);!function(t,e,n){for(let n=0;n<3;++n)t[n]=Number.POSITIVE_INFINITY,e[n]=Number.NEGATIVE_INFINITY;for(let r of n){let{spec:n}=r,{lowerChunkBound:i,upperChunkBound:s}=n;for(let n=0;n<3;++n)t[n]=Math.min(t[n],i[n]),e[n]=Math.max(e[n],s[n])}}(f,p,i.keys()),o&&console.log("Initial sources chunk bounds: "+`${r.n.str(f)}, ${r.n.str(p)}`),r.n.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r.n.set(h,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s.globalToLocalSpatialVector(b,this.viewportAxes[2]);for(let t=0;t<3;++t)m[t]=b[t]>0?1:0;const g=r.n.dot(s.globalToLocalGrid(c,this.centerDataPosition),b);for(let t=0;t<4;++t){const e=s.globalToLocalGrid(c,n[t]);for(let t=0;t<3;++t)u[t]=Math.min(u[t],Math.floor(e[t])),h[t]=Math.max(h[t],Math.floor(e[t])+1)}r.n.max(u,u,f),r.n.min(h,h,p),_.length=0,y.length=0;for(let t of i.keys()){let e=t.spec,n=d(u,h,e.lowerChunkBound,e.upperChunkBound);switch(o&&console.log(`Comparing source bounds lowerBound=${r.n.str(u)}, `+`upperBound=${r.n.str(h)}, `+`lowerChunkBound=${r.n.str(e.lowerChunkBound)}, `+`upperChunkBound=${r.n.str(e.upperChunkBound)}, `+`got ${l[n]}`,e,t),n){case l.FULLY_INSIDE:_.push(t);break;case l.PARTIALLY_INSIDE:y.push(t)}}let w=y.length;!function t(n){if(o&&console.log(`chunk bounds: ${u} ${h} `+`fullyVisible: ${_} partiallyVisible: `+`${y.slice(0,w)}`),0===_.length&&0===w)return void(o&&console.log("  no visible sources"));o&&console.log(`Check bounds: [ ${r.n.str(u)}, ${r.n.str(h)} ]`);var i,c,f,p=1;for(let t=0;t<3;++t)p*=Math.max(0,h[t]-u[t]);if(0===p)return void(o&&console.log("  volume == 0"));if(!function(){var t=0,e=0;for(let n=0;n<3;++n){let r=b[n],i=u[n],s=h[n]-i,a=m[n]*s;t+=r*(i+a),e+=r*(i+s-a)}return o&&(console.log(`    planeNormal = ${b}`),console.log("    {positive,negative}VertexDistanceToOrigin: ",t,e,g),console.log("    intersectsPlane:",e,g,t)),!(t<g)&&e<=g}())return void(o&&console.log("  doesn't intersect plane"));if(o&&console.log("Within bounds: ["+r.n.str(u)+", "+r.n.str(h)+"]"),1===p)return void e(s,a,u,_);for(;i=u[n],1==(f=(c=h[n])-i);)n=(n+1)%3;let v=i+Math.floor(.5*f),I=(n+1)%3,k=_.length;h[n]=v;let S=w;function T(){w=
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n,r){for(;e<n;){let i=t[e];r(i)?++e:(--n,t[e]=t[n],t[n]=i)}return n}(y,0,S,t=>{let e=t.spec;switch(d(u,h,e.lowerChunkBound,e.upperChunkBound)){case l.PARTIALLY_INSIDE:return!0;case l.FULLY_INSIDE:_.push(t);default:return!1}})}T(),t(I),_.length=k,w=S,h[n]=c,u[n]=v,T(),t(I),u[n]=i,_.length=k,w=S}(0)})}}const b=18;function y(t){let{voxelSize:e,lowerVoxelBound:n=r.h,upperVoxelBound:i,maxVoxelsPerChunkLog2:s=b,transform:a=r.c,maxBlockSize:o=r.f}=t,u=Object(r.a)(r.n.create(),a);e=r.n.multiply(u,u,e);let c,h=r.n.fromValues(1,1,1);if(void 0===i)c=o;else{c=r.n.create();for(let t=0;t<3;++t)c[t]=Math.pow(2,Math.floor(Math.log2(i[t]-n[t])));r.n.min(c,c,o)}function l(){let t=1/0,n=-1;for(let r=0;r<3;++r){if(h[r]>=c[r])continue;let i=h[r]*e[r];i<t&&(t=i,n=r)}return n}for(let t=0;t<s;++t){let t=l();if(-1===t)break;h[t]*=2}return h}function _(t){let{lowerVoxelBound:e=r.h,upperVoxelBound:n=r.f,flatDimension:i,voxelSize:s,maxVoxelsPerChunkLog2:a,transform:o}=t;return r.n.subtract(c,n,e),c[i]=1,y({voxelSize:s,upperVoxelBound:c,maxVoxelsPerChunkLog2:a,transform:o})}var w;function v(t,e){let n=e.transform;return void 0===n?void 0===t?r.c:t:void 0===t?n:r.i.multiply(r.i.create(),n,t)}function I(t){if(void 0!==t.chunkDataSizes)return t.chunkDataSizes;const{chunkLayoutPreference:e=w.ISOTROPIC}=t;switch(e){case w.ISOTROPIC:return[y(t)];case w.FLAT:let n=function(t){let e=new Array;for(let n=0;n<3;++n)e[n]=_({flatDimension:n,voxelSize:t.voxelSize,lowerVoxelBound:t.lowerVoxelBound,upperVoxelBound:t.upperVoxelBound,maxVoxelsPerChunkLog2:t.maxVoxelsPerChunkLog2,transform:t.transform});return e}(t);return n.push(y(t)),n}throw new Error(`Invalid chunk layout preference: ${e}.`)}!function(t){t[t.ISOTROPIC=0]="ISOTROPIC",t[t.FLAT=1]="FLAT"}(w||(w={}));class k{constructor(t){let{chunkSize:e,voxelSize:n,transform:s,lowerChunkBound:a=r.h,upperChunkBound:o}=t;this.voxelSize=n,this.chunkLayout=i.get(e,s),this.lowerChunkBound=a,this.upperChunkBound=o}toObject(){return{transform:this.chunkLayout.transform,chunkSize:this.chunkLayout.size,voxelSize:this.voxelSize,lowerChunkBound:this.lowerChunkBound,upperChunkBound:this.upperChunkBound}}}const S="SliceView",T="sliceview/RenderLayer",M="SliceView.addVisibleLayer",E="SliceView.removeVisibleLayer",O="SliceView.updateView",x="SliceView.updateTransform"},function(t,e,n){"use strict";var r=n(5),i=n(2),s=n(27),a=n(0),o=n(24);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function u(t,e,n,r,i,s,o){const{octree:u,lodScales:c,chunkGridSpatialOrigin:h,chunkShape:l}=t,d=c.length-1,f=e[0],p=e[4],g=e[8],m=e[1],b=e[5],y=e[9],_=e[3],w=e[7],v=e[11],I=e[15],k=_>0?0:1,S=w>0?0:1,T=v>0?0:1,M=n[16],E=n[17],O=n[18],x=n[19];function C(t,e,n){return _*t+w*e+v*n+I}const N=C(-x*M,-x*E,-x*O),A=t.clipLowerBound[0],j=t.clipLowerBound[1],P=t.clipLowerBound[2],U=t.clipUpperBound[0],D=t.clipUpperBound[1],R=t.clipUpperBound[2],F=Math.sqrt((f*i)**2+(m*s)**2),z=Math.sqrt((p*i)**2+(b*s)**2),L=Math.sqrt((g*i)**2+(y*s)**2),B=Math.max(F,z,L);!function t(e,i,s){const d=1<<e,f=5*i,p=u[f],g=u[f+1],m=u[f+2],b=u[f+3],y=u[f+4];let _=p*d*l[0]+h[0],w=g*d*l[1]+h[1],v=m*d*l[2]+h[2],I=_+d*l[0],M=w+d*l[1],E=v+d*l[2];if(_=Math.max(_,A),w=Math.max(w,j),v=Math.max(v,P),I=Math.min(I,U),M=Math.min(M,D),E=Math.min(E,R),Object(a.d)(_,w,v,I,M,E,n)){const n=Math.max(N,function(t,e,n,r,i,s){return C(t+k*(r-t),e+S*(i-e),n+T*(s-n))}(_,w,v,I,M,E))/B;if(0===s||n*r<s){const a=c[e];if(0!==a&&o(e,i,a/n,y>>>31),e>0&&(0===a||n*r<a)){const n=0===a?s:a,r=(2147483647&y)>>>0;for(let i=b;i<r;++i)t(e-1,i,n)}}}}(d,u.length/5-1,0)}var c=n(36);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h=!1;let l=0;function d(t,e,n,r,i,s){const a=e-1>>>0;let o=(i&a)>>>0;for(let e=0;;++e){const i=t[o];if(i===r)return t[o]=n,n;if(s(i))return i;++l,o=(o+e+1&a)>>>0}}const f=1053042;function p(t){return f>>>3*t&7}function g(t){return 3*(t>>>2)}function m(t){return 3&t}function b(t){return t>>>1}function y(t){return 1+(t+1>>>1)}function _(t){return 2-t}function w(t,e,n){const r=e.length/3,i=n.length;t.fill(4294967295),n.fill(4294967295);for(let o=0;o<r;++o){const r=3*o;for(let u=0;u<3;++u){const h=e[r+b(u)],l=e[r+y(u)],f=o<<2|u,p=d(n,i,f,4294967295,(s=h,a=l,Object(c.a)(Object(c.a)(0,s),a)),t=>{const n=g(t),r=m(t),i=e[n+b(r)],s=e[n+y(r)];return h===i&&l===s});if(p!==f){t[g(p)+m(p)]=f,t[r+u]=p}}}var s,a;return t}function v(t,e,n,r){const i=-1>>>32-8*n.BYTES_PER_ELEMENT,s=t.length/3;t:for(let a=0;a<s;++a){let s=3*a;if(t[s]!==i){for(let a=0;a<3;++a){let o=e[s+a];if(4294967295===o)continue;let u=g(o);if(t[u]===i)continue;let c=m(o);n[r++]=t[s+_(a)],n[r++]=t[s+b(a)],n[r++]=t[s+y(a)];let h=c;for(;;){if(t[s]=i,s=u,n[r++]=t[s+_(3&h)],4294967295===(o=e[s+(3&(h=p(h)))])||t[u=g(o)]===i){n[r++]=i,t[s]=i;continue t}h=m(o)|4&h}}n[r++]=t[s],n[r++]=t[s+1],n[r++]=t[s+2],t[s]=i,n[r++]=i}}return r}function I(t,e){if(0===t.length)return t;l=0,void 0===e&&(e=Uint32Array.of(0,t.length));let n=0,r=0,i=0,s=0,a=0;const o=function(t){let e=0;for(let n=0,r=t.length;n<r;n+=3){let r,i=t[n],s=t[n+1],a=t[n+2];i>s&&(r=i,i=s,s=r),s>a&&(r=s,s=a,a=r),i>s&&(r=i,i=s,s=r),t[n]=i,t[n+1]=s,t[n+2]=a,a>e&&(e=a)}return e}(t),u=t.length/3*4,c=o>=65535?new Uint32Array(u):new Uint16Array(u);let d=0,f=0;const p=e.length-1;for(let t=0;t<p;++t)f=Math.max(f,e[t+1]-e[t]);const g=new Uint32Array(f),m=new Uint32Array(function(t){const e=t;return 4*2**Math.ceil(Math.log2(e))}(f));let b=e[0];for(let o=0;o<p;++o){e[o]=d;const u=e[o+1],l=t.subarray(b,u);h&&(i=Date.now()),w(g,l,m),h&&(s=Date.now()),d=v(l,g,c,d),h&&(n+=s-i,r+=(a=Date.now())-s),b=u}--d,e[p]=d;const y=new c.constructor(d);return y.set(c.subarray(0,d)),h&&console.log(`reduced from ${t.byteLength}(${t.BYTES_PER_ELEMENT}) -> ${y.byteLength}(${y.BYTES_PER_ELEMENT}): adj=${n}, emit=${r}, ${l}/${t.length} collisions`),y}var k=n(37),S=n(21),T=n(20),M=n(7),E=n(3),O=n(4),x=n(12),C=n(1);n.d(e,"g",function(){return R}),n.d(e,"f",function(){return F}),n.d(e,"i",function(){return B}),n.d(e,"h",function(){return $}),n.d(e,"a",function(){return V}),n.d(e,"b",function(){return K}),n.d(e,"c",function(){return Q}),n.d(e,"d",function(){return X}),n.d(e,"j",function(){return tt}),n.d(e,"e",function(){return et});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var N=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const A=!1;class j extends r.Chunk{constructor(){super(),this.objectId=new O.a}initializeManifestChunk(t,e){super.initialize(t),this.objectId.assign(e)}freeSystemMemory(){this.fragmentIds=null}serialize(t,e){super.serialize(t,e),t.fragmentIds=this.fragmentIds}downloadSucceeded(){this.systemMemoryBytes=100,this.gpuMemoryBytes=0,super.downloadSucceeded(),this.priorityTier<i.f.RECENT&&this.source.chunkManager.scheduleUpdateChunkPriorities()}toString(){return this.objectId.toString()}}function P(t,e,n){const{vertexPositions:r,indices:i,vertexNormals:s,strips:a}=t;e.vertexPositions=r,e.indices=i,e.strips=a,e.vertexNormals=s;let o=r.buffer;n.push(o);let u=i.buffer;u!==o&&n.push(u),n.push(s.buffer)}function U(t){let{vertexPositions:e,indices:n,vertexNormals:r}=t;return e.byteLength+n.byteLength+r.byteLength}class D extends r.Chunk{constructor(){super(),this.manifestChunk=null,this.fragmentId=null,this.meshData=null}initializeFragmentChunk(t,e,n){super.initialize(t),this.manifestChunk=e,this.fragmentId=n}freeSystemMemory(){this.manifestChunk=null,this.meshData=null,this.fragmentId=null}serialize(t,e){super.serialize(t,e),P(this.meshData,t,e),this.meshData=null}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=U(this.meshData),super.downloadSucceeded()}}function R(t,e,n){Object(E.i)(e),t.fragmentIds=Object(E.j)(e,n,E.m)}function F(t,e){const n=a.n.create(),r=a.n.create(),i=a.n.create();let s=new Float32Array(t.length),o=e.length;for(let u=0;u<o;u+=3){let o=3*e[u],c=3*e[u+1],h=3*e[u+2];for(let e=0;e<3;++e)r[e]=t[c+e]-t[o+e],i[e]=t[h+e]-t[c+e];a.n.cross(n,r,i),a.n.normalize(n,n);for(let t=0;t<3;++t){let r=3*e[u+t];for(let t=0;t<3;++t)s[r+t]+=n[t]}}let u=s.length;for(let t=0;t<u;t+=3){let e=s.subarray(t,t+3);a.n.normalize(e,e)}return s}function z(t){return Math.min(Math.max(-127,127*t+.5),127)>>>0}function L(t){return t<0?-1:1}function B(t,e,n,r,i,s,a){let o,u=new Float32Array(e,r,3*i);Object(M.d)(u,n),void 0===s&&(s=r+12*i),void 0!==a&&(o=a*t);let c=void 0===o?new Uint32Array(e,s):new Uint32Array(e,s,o);if(c.length%t!=0)throw new Error(`Number of indices is not a multiple of ${t}: ${c.length}.`);return Object(M.d)(c,n),{vertexPositions:u,indices:c}}function $(t,e,n,r,i,s){return B(3,t,e,n,r,i,s)}class V extends r.ChunkSource{constructor(t,e){super(t,e),(this.fragmentSource=this.registerDisposer(t.getRef(e.fragmentSource))).meshSource=this}getChunk(t){const e=Object(S.b)(t);let n=this.chunks.get(e);return void 0===n&&((n=this.getNewChunk_(j)).initializeManifestChunk(e,t),this.addChunk(n)),n}getFragmentChunk(t,e){let n=`${t.key}/${e}`,r=this.fragmentSource,i=r.chunks.get(n);return void 0===i&&((i=r.getNewChunk_(D)).initializeFragmentChunk(n,t,e),r.addChunk(i)),i}}let G=class extends r.ChunkSource{constructor(){super(...arguments),this.meshSource=null}download(t,e){return this.meshSource.downloadFragment(t,e)}};G=N([Object(C.g)(s.a)],G);let q=class extends k.a{constructor(t,e){super(t,e),this.viewStates=new T.a,this.viewStatesDisposers=new Map,this.source=this.registerDisposer(t.getRef(e.source)),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>{this.updateChunkPriorities()}));const n=()=>{this.chunkManager.scheduleUpdateChunkPriorities()};this.registerDisposer(this.viewStates.changed.add(()=>{const{viewStatesDisposers:t}=this,{viewStates:e}=this;for(const[n,r]of t)e.has(n)||r();for(const r of e)t.has(r)||(r.viewport.changed.add(n),r.visibility.changed.add(n),t.set(r,()=>{r.viewport.changed.remove(n),r.visibility.changed.remove(n)}))})),this.registerDisposer(()=>{for(const t of this.viewStatesDisposers.values())t()})}updateChunkPriorities(){const t=this.visibility.value;if(t===Number.NEGATIVE_INFINITY)return;const e=Object(x.b)(t),n=Object(x.a)(t),{source:r,chunkManager:s}=this;Object(S.a)(this,t=>{let a=r.getChunk(t);s.requestChunk(a,e,n+100);const o=a.state;if(o===i.g.SYSTEM_MEMORY_WORKER||o===i.g.SYSTEM_MEMORY||o===i.g.GPU_MEMORY)for(let t of a.fragmentIds){let i=r.getFragmentChunk(a,t);s.requestChunk(i,e,n+50)}})}};q=N([Object(C.g)(s.b)],q);class Y extends r.Chunk{constructor(){super(),this.objectId=new O.a}initializeManifestChunk(t,e){super.initialize(t),this.objectId.assign(e)}freeSystemMemory(){this.manifest=void 0}serialize(t,e){super.serialize(t,e),t.manifest=this.manifest}downloadSucceeded(){this.systemMemoryBytes=this.manifest.octree.byteLength,this.gpuMemoryBytes=0,super.downloadSucceeded(),this.priorityTier<i.f.RECENT&&this.source.chunkManager.scheduleUpdateChunkPriorities()}toString(){return this.objectId.toString()}}class Z extends r.Chunk{constructor(){super(),this.subChunkOffsets=null,this.meshData=null,this.lod=0,this.chunkIndex=0,this.manifestChunk=null}freeSystemMemory(){this.meshData=this.subChunkOffsets=null}serialize(t,e){super.serialize(t,e),P(this.meshData,t,e);const{subChunkOffsets:n}=this;t.subChunkOffsets=n,e.push(n.buffer),this.meshData=this.subChunkOffsets=null}downloadSucceeded(){const{subChunkOffsets:t}=this;this.systemMemoryBytes=this.gpuMemoryBytes=U(this.meshData),this.systemMemoryBytes+=t.byteLength,super.downloadSucceeded()}}class K extends r.ChunkSource{constructor(t,e){super(t,e);let n=this.fragmentSource=this.registerDisposer(t.getRef(e.fragmentSource));this.format=e.format,n.meshSource=this}getChunk(t){const e=Object(S.b)(t);let n=this.chunks.get(e);return void 0===n&&((n=this.getNewChunk_(Y)).initializeManifestChunk(e,t),this.addChunk(n)),n}getFragmentChunk(t,e,n){let r=`${t.key}/${e}:${n}`,i=this.fragmentSource,s=i.chunks.get(r);return void 0===s&&((s=i.getNewChunk_(Z)).initialize(r),s.lod=e,s.chunkIndex=n,s.manifestChunk=t,i.addChunk(s)),s}}let H=class extends r.ChunkSource{constructor(){super(...arguments),this.meshSource=null}download(t,e){return this.meshSource.downloadFragment(t,e)}};H=N([Object(C.g)(s.c)],H);let W=class extends k.a{constructor(t,e){super(t,e),this.viewStates=new T.a,this.viewStatesDisposers=new Map,this.source=this.registerDisposer(t.getRef(e.source)),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>{this.updateChunkPriorities()}));const n=()=>{this.chunkManager.scheduleUpdateChunkPriorities()};this.registerDisposer(this.viewStates.changed.add(()=>{const{viewStatesDisposers:t}=this,{viewStates:e}=this;for(const[n,r]of t)e.has(n)||r();for(const r of e)t.has(r)||(r.viewport.changed.add(n),r.visibility.changed.add(n),t.set(r,()=>{r.viewport.changed.remove(n),r.visibility.changed.remove(n)}))})),this.registerDisposer(()=>{for(const t of this.viewStatesDisposers.values())t()})}updateChunkPriorities(){const t=this.visibility.value;if(t===Number.NEGATIVE_INFINITY)return;const e=new Array;{const n=Object(x.b)(t),r=Object(x.a)(t),{source:s,chunkManager:a}=this;Object(S.a)(this,t=>{const o=s.getChunk(t);a.requestChunk(o,n,r+100);const u=o.state;u!==i.g.SYSTEM_MEMORY_WORKER&&u!==i.g.SYSTEM_MEMORY&&u!==i.g.GPU_MEMORY||e.push(o)})}if(0===e.length)return;const{source:n,chunkManager:r}=this;for(const t of this.viewStates){const i=t.visibility.value;if(i===Number.NEGATIVE_INFINITY)continue;const s=Object(x.b)(i),o=Object(x.a)(i),c=t.viewport.value,h=a.i.create();a.i.multiply(h,c.viewProjectionMat,a.i.multiply(h,this.objectToDataTransform.value,n.format.transform));const l=Object(a.b)(new Float32Array(24),h),d=this.renderScaleTarget.value;for(const t of e){const e=t.manifest.lodScales.length-1;u(t.manifest,h,l,d,c.width,c.height,(i,a,u,c)=>{if(c)return;let h=n.getFragmentChunk(t,i,a);r.requestChunk(h,s,o+50-e+i)})}}}};function J(t,e){const n=F(t.vertexPositions,t.indices),r=new Uint8Array(n.length/3*2);let i,a,o;if(function(t,e){const n=e.length;let r=0;for(let i=0;i<n;i+=3){const n=e[i],s=e[i+1],a=e[i+2],o=1/(Math.abs(n)+Math.abs(s)+Math.abs(a));a<0?(t[r]=z((1-Math.abs(s*o))*L(n)),t[r+1]=z((1-Math.abs(n*o))*L(s))):(t[r]=z(n*o),t[r+1]=z(s*o)),r+=2}}(r,n),A?(i=I(t.indices,t.subChunkOffsets),a=!0):(4===t.indices.BYTES_PER_ELEMENT&&t.vertexPositions.length/3<65535?(i=new Uint16Array(t.indices.length)).set(t.indices):i=t.indices,a=!1),e===s.e.uint10){const e=t.vertexPositions,n=e.length/3;o=new Uint32Array(n);for(let t=0,r=0;r<n;t+=3,++r)o[r]=1023&e[t]|(1023&e[t+1])<<10|(1023&e[t+2])<<20}else if(e===s.e.uint16){const e=t.vertexPositions;2===e.BYTES_PER_ELEMENT?o=e:(o=new Uint16Array(e.length)).set(e)}else o=t.vertexPositions;return{vertexPositions:o,vertexNormals:r,indices:i,strips:a}}function Q(t,e,n=s.e.float32){t.meshData=J(e,n)}function X(t,e,n){t.meshData=J(e,n),t.subChunkOffsets=e.subChunkOffsets}function tt(t,e,n){let r=n;for(let n=0;n<3;++n)t[5*r+n]=t[5*e+n]>>>1;t[5*r+3]=e;for(let i=e+1;i<n;++i){const e=t[5*i]>>>1,n=t[5*i+1]>>>1,s=t[5*i+2]>>>1;e===t[5*r]&&n===t[5*r+1]&&s===t[5*r+2]||(t[5*r+4]=i,t[5*++r]=e,t[5*r+1]=n,t[5*r+2]=s,t[5*r+3]=i)}return t[5*r+4]=n,++r}function et(t,e,n,r){let i=e;for(let e=n;e<r;++e){const r=t[5*e],s=t[5*e+1],a=t[5*e+2];for(;i<n;){const e=t[5*i]>>>1,n=t[5*i+1]>>>1,u=t[5*i+2]>>>1;if(!Object(o.d)(e,n,u,r,s,a))break;++i}for(t[5*e+3]=i;i<n;){const e=t[5*i]>>>1,n=t[5*i+1]>>>1,o=t[5*i+2]>>>1;if(e!=r||n!=s||o!=a)break;++i}t[5*e+4]+=i}}W=N([Object(C.g)(s.d)],W)},function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"e",function(){return s}),n.d(e,"b",function(){return a}),n.d(e,"c",function(){return o}),n.d(e,"d",function(){return u});const r=new
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class{constructor(){this.name="CancellationError",this.message="CANCELED"}toString(){return"CANCELED"}};const i=()=>{},s={isCanceled:!1,add:()=>i,remove:i};class a{cancel(){const{handlers:t}=this;if(null!==t&&(this.handlers=null,void 0!==t))for(let e of t)e()}get isCanceled(){return null===this.handlers}add(t){let{handlers:e}=this;return null===e?(t(),i):(void 0===e&&(e=this.handlers=new Set),e.add(t),()=>{this.remove(t)})}remove(t){const{handlers:e}=this;null!=e&&e.delete(t)}}class o extends a{constructor(){super(...arguments),this.consumers=new Set}addConsumer(t=s){const{consumers:e}=this;e.has(t)||t.isCanceled||(e.add(t),t.add(()=>{e.delete(t),0===e.size&&this.cancel()}))}}function u(t,e){return new Promise((n,r)=>{if(t===s)return void e(n,r,s);const i=new a,o=t.add(()=>{i.cancel()});e(t=>{o(),n(t)},t=>{o(),r(t)},i)})}},function(t,e,n){"use strict";var r,i=n(20),s=n(1);let a=r=class extends s.c{constructor(t,e={}){super(t,e),this.updatingValue_=!1,void 0!==t&&(this.base=new i.b(e.value),this.setupChangedHandler())}initializeCounterpart(t,e={}){e.value=this.value,super.initializeCounterpart(t,e)}setupChangedHandler(){this.registerDisposer(this.base.changed.add(()=>{if(this.updatingValue_)this.updatingValue_=!1;else{const{rpc:t}=this;null!==t&&t.invoke("SharedWatchableValue.changed",{id:this.rpcId,value:this.value})}}))}static makeFromExisting(t,e){let n=new r;return n.base=e,n.setupChangedHandler(),n.initializeCounterpart(t),n}static make(t,e){return r.makeFromExisting(t,new i.b(e))}get value(){return this.base.value}set value(t){this.base.value=t}get changed(){return this.base.changed}};a=r=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(s.g)("SharedWatchableValue")],a),Object(s.f)("SharedWatchableValue.changed",function(t){const e=this.get(t.id);e.updatingValue_=!0,e.base.value=t.value,e.updatingValue_=!1});var o=n(2);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function u(t){return class extends t{constructor(...t){super(...t);const e=t[0],n=t[1];this.visibility=e.get(n.visibility),this.registerDisposer(this.visibility.changed.add(()=>this.chunkManager.scheduleUpdateChunkPriorities()))}}}function c(t){return t===Number.POSITIVE_INFINITY?o.f.VISIBLE:o.f.PREFETCH}function h(t){return t===Number.POSITIVE_INFINITY?0:t*o.h}n.d(e,"c",function(){return u}),n.d(e,"b",function(){return c}),n.d(e,"a",function(){return h})},function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class r{constructor(){this.handlers=new Set,this.count=0;const t=this;this.dispatch=function(){++t.count,t.handlers.forEach(t=>{t.apply(this,arguments)})}}add(t){return this.handlers.add(t),()=>this.remove(t)}remove(t){return this.handlers.delete(t)}dispose(){this.handlers=void 0}}class i extends r{}},function(t,e,n){"use strict";n.d(e,"c",function(){return s}),n.d(e,"b",function(){return o});var r=n(9),i=n(8);n.d(e,"a",function(){return i.b});var s,a=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.IMAGE=1]="IMAGE",t[t.SEGMENTATION=2]="SEGMENTATION"}(s||(s={}));class o extends r.i{constructor(t){let{lowerVoxelBound:e=a.h,upperVoxelBound:n,chunkDataSize:r,voxelSize:s,transform:o,baseVoxelOffset:u=a.h}=t,{lowerClipBound:c=a.n.multiply(a.n.create(),s,e),upperClipBound:h=a.n.multiply(a.n.create(),s,n)}=t;const l=a.n.multiply(a.n.create(),r,s);let d=a.n.create(),f=a.n.create();for(let t=0;t<3;++t)d[t]=Math.floor(e[t]/r[t]),f[t]=Math.floor((n[t]-1)/r[t]+1);super({voxelSize:s,transform:o,lowerChunkBound:d,upperChunkBound:f,chunkSize:l}),this.baseVoxelOffset=u,this.lowerClipBound=c,this.upperClipBound=h,this.lowerVoxelBound=e,this.upperVoxelBound=n,this.chunkDataSize=r;let p=this.dataType=t.dataType,g=this.numChannels=t.numChannels;this.chunkBytes=Object(a.j)(r)*i.a[p]*g,this.compressedSegmentationBlockSize=t.compressedSegmentationBlockSize}static make(t){return new o(Object.assign({},t,{transform:Object(r.k)(t.transform,t.volumeSourceOptions)}))}static fromObject(t){return new o(t)}toObject(){return Object.assign({},super.toObject(),{numChannels:this.numChannels,chunkDataSize:this.chunkDataSize,dataType:this.dataType,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset,compressedSegmentationBlockSize:this.compressedSegmentationBlockSize})}static withDefaultCompression(t){let{compressedSegmentationBlockSize:e,dataType:n,voxelSize:u,transform:c,lowerVoxelBound:h,upperVoxelBound:l}=t;return c=Object(r.k)(c,t.volumeSourceOptions),void 0!==e||t.volumeType!==s.SEGMENTATION||n!==i.b.UINT32&&n!==i.b.UINT64||(e=Object(r.l)({voxelSize:u,transform:c,lowerVoxelBound:h,upperVoxelBound:l,maxVoxelsPerChunkLog2:9,maxBlockSize:a.n.min(a.n.create(),t.chunkDataSize,t.maxCompressedSegmentationBlockSize||a.f)})),new o(Object.assign({},t,{compressedSegmentationBlockSize:e,transform:c}))}static getDefaults(t){const e=Object.assign({},t,{transform:Object(r.k)(t.transform,t.volumeSourceOptions)});let{chunkDataSizes:n=Object(r.j)(e)}=t;return n.map(e=>o.withDefaultCompression(Object.assign({},t,{chunkDataSize:e})))}}},function(t,e,n){"use strict";n.d(e,"a",function(){return h});var r=n(11);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=[],s=new Map,a=new Map,o=Math.min(12,navigator.hardwareConcurrency);let u=0;function c(){const t=new Worker("async_computation.bundle.js");return t.onmessage=(e=>{const{id:n,value:r,error:o}=e.data;!function(t){for(const[e,n]of s)return s.delete(e),void t.postMessage(n.msg,n.transfer);i.push(t)}(t);const u=a.get(n);a.delete(n),void 0!==u&&(u.cleanup(),void 0!==o?u.reject(new Error(o)):u.resolve(r))}),t}function h(t,e,n,...h){if(e.isCanceled)return Promise.reject(r.a);const l=u++,d={t:t.id,id:l,args:h},f=e.add(()=>{s.delete(l),a.delete(l)}),p=new Promise((t,e)=>{a.set(l,{resolve:t,reject:e,cleanup:f})});return 0!==i.length?i.pop().postMessage(d,n):a.size<o?c().postMessage(d,n):s.set(l,{msg:d,transfer:n}),p}},function(t,e,n){"use strict";n.d(e,"a",function(){return u}),n.d(e,"b",function(){return c});var r=n(26),i=n(14),s=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const a=s.n.create(),o=s.n.create();class u extends r.SliceViewChunk{constructor(){super(),this.source=null}initializeVolumeChunk(t,e){super.initializeVolumeChunk(t,e),this.chunkDataSize=null;let n=this.source;this.systemMemoryBytes=n.spec.chunkBytes,this.gpuMemoryBytes=n.spec.chunkBytes,this.data=null}serialize(t,e){super.serialize(t,e);let n=this.chunkDataSize;n!==this.source.spec.chunkDataSize&&(t.chunkDataSize=n);let r=t.data=this.data;e.push(r.buffer),this.data=null}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=this.data.byteLength,super.downloadSucceeded()}freeSystemMemory(){this.data=null}}class c extends r.SliceViewChunkSource{constructor(t,e){super(t,e),this.spec=i.b.fromObject(e.spec)}computeChunkBounds(t){let{spec:e}=this,{upperVoxelBound:n}=e,r=e.chunkDataSize,i=a,u=s.n.multiply(o,t.chunkGridPosition,r),c=!1;for(let t=0;t<3;++t){let e=Math.min(n[t],u[t]+r[t]);(i[t]=e-u[t])!==r[t]&&(c=!0)}return s.n.add(u,u,this.spec.baseVoxelOffset),t.chunkDataSize=c?s.n.clone(i):r,u}}c.prototype.chunkConstructor=u},function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i});class r{constructor(){this.refCount=1}addRef(){return++this.refCount,this}dispose(){0==--this.refCount&&this.refCountReachedZero()}refCountReachedZero(){this.disposed();let{disposers:t}=this;void 0!==t&&(!function(t){for(let n=t.length;n>0;--n)"object"==typeof(e=t[n-1])?e.dispose():e();
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var e}(t),this.disposers=void 0),this.wasDisposed=!0}disposed(){}registerDisposer(t){let{disposers:e}=this;return null==e?this.disposers=[t]:e.push(t),t}unregisterDisposer(t){let{disposers:e}=this;if(null!=e){let n=e.indexOf(t);-1!==n&&e.splice(n,1)}return t}registerEventListener(t,e,n,r){this.registerDisposer(function(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}(t,e,n,r))}registerCancellable(t){return this.registerDisposer(()=>{t.cancel()}),t}}class i extends r{constructor(t){super(),this.value=t}}},function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s}),n.d(e,"c",function(){return a});var r=n(8);
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i{}i.RPC_ID="computed/ComputedVolumeChunkSourceParameters";class s{}function a(t,e){switch(e){case r.b.UINT8:return new Uint8Array(t);case r.b.UINT16:return new Uint16Array(t);case r.b.UINT32:case r.b.UINT64:return new Uint32Array(t);case r.b.FLOAT32:return new Float32Array(t)}}},function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return h}),n.d(e,"c",function(){return l});n(17),n(0);var r,i=n(3),s=(n(39),n(13),n(4));!function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.AXIS_ALIGNED_BOUNDING_BOX=2]="AXIS_ALIGNED_BOUNDING_BOX",t[t.ELLIPSOID=3]="ELLIPSOID"}(r||(r={}));const a=[r.POINT,r.LINE,r.AXIS_ALIGNED_BOUNDING_BOX,r.ELLIPSOID],o=new Map;function u(t){return o.get(t)}o.set(r.LINE,{icon:"ꕹ",description:"Line",toJSON:t=>({pointA:Array.from(t.pointA),pointB:Array.from(t.pointB)}),restoreState:(t,e)=>{t.pointA=Object(i.j)(e,"pointA",i.g),t.pointB=Object(i.j)(e,"pointB",i.g)},serializedBytes:24,serializer:(t,e,n)=>{const r=new Float32Array(t,e,6*n);return(t,e)=>{const{pointA:n,pointB:i}=t,s=6*e;r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=i[0],r[s+4]=i[1],r[s+5]=i[2]}}}),o.set(r.POINT,{icon:"⚬",description:"Point",toJSON:t=>({point:Array.from(t.point)}),restoreState:(t,e)=>{t.point=Object(i.j)(e,"point",i.g)},serializedBytes:12,serializer:(t,e,n)=>{const r=new Float32Array(t,e,3*n);return(t,e)=>{const{point:n}=t,i=3*e;r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2]}}}),o.set(r.AXIS_ALIGNED_BOUNDING_BOX,{icon:"❑",description:"Bounding Box",toJSON:t=>({pointA:Array.from(t.pointA),pointB:Array.from(t.pointB)}),restoreState:(t,e)=>{t.pointA=Object(i.j)(e,"pointA",i.g),t.pointB=Object(i.j)(e,"pointB",i.g)},serializedBytes:24,serializer:(t,e,n)=>{const r=new Float32Array(t,e,6*n);return(t,e)=>{const{pointA:n,pointB:i}=t,s=6*e;r[s]=Math.min(n[0],i[0]),r[s+1]=Math.min(n[1],i[1]),r[s+2]=Math.min(n[2],i[2]),r[s+3]=Math.max(n[0],i[0]),r[s+4]=Math.max(n[1],i[1]),r[s+5]=Math.max(n[2],i[2])}}}),o.set(r.ELLIPSOID,{icon:"◎",description:"Ellipsoid",toJSON:t=>({center:Array.from(t.center),radii:Array.from(t.radii)}),restoreState:(t,e)=>{t.center=Object(i.j)(e,"center",i.g),t.radii=Object(i.j)(e,"radii",i.f)},serializedBytes:24,serializer:(t,e,n)=>{const r=new Float32Array(t,e,6*n);return(t,e)=>{const{center:n,radii:i}=t,s=6*e;r.set(n,s),r.set(i,s+3)}}});function c(t,e){return t.id<e.id?-1:t.id===e.id?0:1}class h{constructor(){this.annotations=[[],[],[],[]]}add(t){this.annotations[t.type].push(t)}serialize(){return function(t){let e=0;const n=[],r=[];let i=0,s=0;for(const o of a){n[o]=e,r[o]=s;const a=t[o];let h=0;for(const t of a){const{segments:e}=t;void 0!==e&&(h+=e.length)}s+=a.length,i+=h,a.sort(c);const l=a.length;e+=u(o).serializedBytes*l}const o=new Uint32Array(s+1),h=new Uint32Array(2*i),l=[],d=new ArrayBuffer(e);let f=0,p=0;for(const e of a){const r=t[e];l[e]=r.map(t=>t.id);const i=r.length,s=u(e).serializer(d,n[e],i);r.forEach((t,e)=>{s(t,e),o[p++]=f;const{segments:n}=t;if(void 0!==n)for(const t of n)h[2*f]=t.low,h[2*f+1]=t.high,++f})}return{data:new Uint8Array(d),typeToIds:l,typeToOffset:n,segmentListIndex:o,segmentList:h}}(this.annotations)}}function l(t){if(null==t)return t;const e=t.segments;return void 0!==e&&(t.segments=e.map(t=>new s.a(t.low,t.high))),t}},function(t,e,n){"use strict";n.d(e,"b",function(){return o}),n.d(e,"a",function(){return u}),n.d(e,"c",function(){return c});var r=n(56),i=n.n(r),s=n(17),a=n(13);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{constructor(t){this.value_=t,this.changed=new a.a}get value(){return this.value_}set value(t){t!==this.value_&&(this.value_=t,this.changed.dispatch())}}class u{constructor(t){this.changed=new a.a,this.values=void 0===t?new Set:new Set(t)}add(t){const{values:e}=this;return e.has(t)||(e.add(t),this.changed.dispatch()),this}delete(t){const{values:e}=this;return!!e.delete(t)&&(this.changed.dispatch(),!0)}has(t){return this.values.has(t)}get size(){return this.values.size}[Symbol.iterator](){return this.values[Symbol.iterator]()}clear(){const{values:t}=this;t.size>0&&(t.clear(),this.changed.dispatch())}}function c(t,e){let n,r;function a(){n=t.value,r=new s.a,e(r,n)}const o=i()(()=>{t.value!==n&&(r.dispose(),a())},0),u=t.changed.add(o);return a(),()=>{o.cancel(),u(),r.dispose()}}},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function r(t){return`${t.low},${t.high}`}function i(t,e){let{visibleSegments:n,segmentEquivalences:r}=t;for(let t of n)if(r.disjointSets.isMinElement(t))for(let n of r.setElements(t))e(n,t)}n.d(e,"b",function(){return r}),n.d(e,"a",function(){return i})},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function r(t){return{id:t}}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(35),i=n(8),s=n(7),a=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function o(t,e,n,o=s.a,u=0,c=n.byteLength){let h,{spec:l}=t.source,{dataType:d}=l,f=Object(a.j)(t.chunkDataSize),p=i.a[d],g=f*p*l.numChannels;if(g!==c)throw new Error(`Raw-format chunk is ${c} bytes, `+`but ${f} * ${p} = ${g} bytes are expected.`);switch(d){case i.b.UINT8:h=new Uint8Array(n,u,c);break;case i.b.UINT16:h=new Uint16Array(n,u,c/2),Object(s.c)(h,o);break;case i.b.UINT32:case i.b.UINT64:h=new Uint32Array(n,u,c/4),Object(s.d)(h,o);break;case i.b.FLOAT32:h=new Float32Array(n,u,c/4),Object(s.d)(h,o);break;default:throw new Error(`Unexpected data type: ${d}.`)}await Object(r.a)(t,e,h)}},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function r(t,e,n){return 1&t|e<<1&2|n<<2&4}function i(t,e,n,r){const i=Math.max(e,n,r);let s=0,a=t.low,o=0,u=0,c=0;for(let h=0;h<i;++h){if(h<e){o|=(a>>>s&1)<<h,31===s?(s=0,a=t.high):++s}if(h<n){u|=(a>>>s&1)<<h,31===s?(s=0,a=t.high):++s}if(h<r){c|=(a>>>s&1)<<h,31===s?(s=0,a=t.high):++s}}return Uint32Array.of(o,u,c)}function s(t,e,n,r,i,s,a){const o=Math.max(e,n,r);let u=0,c=0,h=!1;function l(e){c|=(1&e)<<u,32==++u&&(t.low=c,c=0,u=0,h=!0)}for(let t=0;t<o;++t)t<e&&l(i>>t&1),t<n&&l(s>>t&1),t<r&&l(a>>t&1);return h?t.high=c:(t.high=0,t.low=c),t}function a(t,e){return t<e&&t<(t^e)}function o(t,e,n,r,i,s){let o=n,u=s;return a(o^u,e^i)&&(o=e,u=i),a(o^u,t^r)&&(o=t,u=r),o<u}n.d(e,"c",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s}),n.d(e,"d",function(){return o})},function(t,e,n){"use strict";var r=n(35),i=n(22);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=Object(i.a)("decodeJpeg");var a=n(15);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function o(t,e,n){const i=t.chunkDataSize,o=await Object(a.a)(s,e,[n],new Uint8Array(n),i[0],i[1]*i[2],t.source.spec.numChannels);await Object(r.a)(t,e,o)}n.d(e,"a",function(){return o})},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n(0),s=n(3),a=n(13);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{constructor(t=i.i.create()){this.transform=t,this.changed=new a.a}get value(){return this.transform}reset(){i.i.copy(this.transform,i.c),this.changed.dispatch()}toJSON(){if(i.i.equals(i.c,this.transform))return;const t=this.transform;return[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}restoreState(t){if(null!=t)if(Array.isArray(t)){if(4===t.length){try{for(let e=0;e<4;++e)Object(s.b)(this.transform.subarray(4*e,4*(e+1)),t[e]);i.i.transpose(this.transform,this.transform)}catch(t){this.reset()}return}if(16===t.length){try{Object(s.b)(this.transform,t),i.i.transpose(this.transform,this.transform)}catch(t){this.reset()}return}this.reset()}else if("object"==typeof t){const e=i.k.create(),n=i.n.create(),r=i.n.fromValues(1,1,1);try{Object(s.b)(e,t.rotation),i.k.normalize(e,e)}catch(t){i.k.identity(e)}try{Object(s.b)(n,t.translation)}catch(t){i.n.copy(n,i.h)}try{Object(s.b)(r,t.scale)}catch(t){i.n.copy(r,i.g)}i.i.fromRotationTranslationScale(this.transform,e,n,r),this.changed.dispatch()}else this.reset();else this.reset()}clone(){return new o(i.i.clone(this.transform))}}var u=n(9),c=n(12),h=n(1);n.d(e,"SliceView",function(){return m}),n.d(e,"SliceViewChunk",function(){return b}),n.d(e,"SliceViewChunkSource",function(){return y}),n.d(e,"RenderLayer",function(){return _});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var l=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const d=1e9,f=i.n.create(),p=i.n.create();const g=Object(c.c)(Object(r.withChunkManager)(class extends u.h{constructor(t,e){super(),this.initializeSharedObject(t,e.id)}}));let m=class extends g{constructor(t,e){super(t,e),this.handleLayerChanged=(()=>{this.hasValidViewport&&this.chunkManager.scheduleUpdateChunkPriorities()}),this.invalidateVisibleSources=(()=>{this.visibleSourcesStale=!0,this.hasValidViewport&&this.chunkManager.scheduleUpdateChunkPriorities()}),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>{this.updateVisibleChunks()}))}onViewportChanged(){this.chunkManager.scheduleUpdateChunkPriorities()}updateVisibleChunks(){const t=this.centerDataPosition;let e=this.chunkManager;const n=this.visibility.value;if(n===Number.NEGATIVE_INFINITY)return;const r=Object(c.b)(n);let s=Object(c.a)(n);s+=-1e12;const a=p;this.computeVisibleChunks(e=>(e.globalToLocalSpatial(a,t),this.visibleChunkLayouts.get(e)),function(t,n,o,u){i.n.multiply(f,o,t.size);let c=-i.n.distance(a,f);for(let t of u){let i=n.get(t),a=t.getChunk(o);e.requestChunk(a,r,s+c+d*i)}})}removeVisibleLayer(t){this.visibleLayers.delete(t),t.layerChanged.remove(this.handleLayerChanged),t.transform.changed.remove(this.invalidateVisibleSources),t.renderScaleTarget.changed.remove(this.invalidateVisibleSources),this.invalidateVisibleSources()}addVisibleLayer(t){this.visibleLayers.set(t,[]),t.layerChanged.add(this.handleLayerChanged),t.transform.changed.add(this.invalidateVisibleSources),t.renderScaleTarget.changed.add(this.invalidateVisibleSources),this.invalidateVisibleSources()}disposed(){for(let t of this.visibleLayers.keys())this.removeVisibleLayer(t);super.disposed()}};m=l([Object(h.g)(u.f)],m),Object(h.f)(u.g,function(t){let e=this.get(t.id);t.width&&e.setViewportSize(t.width,t.height),t.viewportToData&&e.setViewportToDataMatrix(t.viewportToData)}),Object(h.f)(u.b,function(t){let e=this.get(t.id),n=this.get(t.layerId);e.addVisibleLayer(n)}),Object(h.f)(u.c,function(t){let e=this.get(t.id),n=this.get(t.layerId);e.removeVisibleLayer(n)});class b extends r.Chunk{constructor(){super(),this.source=null,this.chunkGridPosition=i.n.create()}initializeVolumeChunk(t,e){super.initialize(t),i.n.copy(this.chunkGridPosition,e)}serialize(t,e){super.serialize(t,e),t.chunkGridPosition=this.chunkGridPosition}downloadSucceeded(){super.downloadSucceeded()}freeSystemMemory(){}toString(){return this.source.toString()+":"+Object(i.o)(this.chunkGridPosition)}}class y extends r.ChunkSource{constructor(t,e){super(t,e)}getChunk(t){let e=Object(i.o)(t),n=this.chunks.get(e);return void 0===n&&((n=this.getNewChunk_(this.chunkConstructor)).initializeVolumeChunk(e,t),this.addChunk(n)),n}}let _=class extends h.c{constructor(t,e){super(t,e),this.layerChanged=new a.a,this.transform=new o,this.transformedSourcesGeneration=-1,this.renderScaleTarget=t.get(e.renderScaleTarget);let n=this.sources=new Array;for(let r of e.sources){let e=new Array;n.push(e);for(let n of r){let r=t.get(n);this.registerDisposer(r.addRef()),e.push(r)}}i.i.copy(this.transform.transform,e.transform),this.transform.changed.add(this.layerChanged.dispatch)}};_=l([Object(h.g)(u.d)],_),Object(h.f)(u.e,function(t){const e=this.get(t.id),n=t.value,r=e.transform.transform;i.i.equals(n,r)||(i.i.copy(r,n),e.transform.changed.dispatch())})},function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"d",function(){return i}),n.d(e,"a",function(){return s}),n.d(e,"c",function(){return a}),n.d(e,"e",function(){return o});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const r="mesh/MeshLayer",i="mesh/MultiscaleMeshLayer",s="mesh/FragmentSource",a="mesh/MultiscaleFragmentSource";var o;!function(t){t[t.float32=0]="float32",t[t.uint10=1]="uint10",t[t.uint16=2]="uint16"}(o||(o={}))},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(22);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=Object(r.a)("decodeGzip")},function(t,e,n){"use strict";var r=n(5),i=n(10),s=n(37),a=n(21);var o=n(4),u=n(12),c=n(1);n.d(e,"a",function(){return l}),n.d(e,"b",function(){return f});class h extends r.Chunk{constructor(){super(),this.objectId=new o.a,this.vertexPositions=null,this.vertexAttributes=null,this.indices=null}initializeSkeletonChunk(t,e){super.initialize(t),this.objectId.assign(e)}freeSystemMemory(){this.vertexPositions=this.indices=null}getVertexAttributeBytes(){let t=this.vertexPositions.byteLength;const{vertexAttributes:e}=this;return null!=e&&e.forEach(e=>{t+=e.byteLength}),t}serialize(t,e){super.serialize(t,e);const n=this.vertexPositions,r=this.indices;t.numVertices=n.length/3,t.indices=r,e.push(r.buffer);const{vertexAttributes:i}=this;if(null!=i&&i.length>0){const r=new Uint8Array(this.getVertexAttributeBytes());r.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength));let s=t.vertexAttributeOffsets=new Uint32Array(i.length+1);s[0]=0;let a=n.byteLength;i.forEach((t,e)=>{s[e+1]=a,r.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a),a+=t.byteLength}),e.push(r.buffer),t.vertexAttributes=r}else t.vertexAttributes=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),t.vertexAttributeOffsets=Uint32Array.of(0),n.buffer!==e[0]&&e.push(n.buffer);this.vertexPositions=this.indices=this.vertexAttributes=null}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=this.indices.byteLength+this.getVertexAttributeBytes(),super.downloadSucceeded()}}class l extends r.ChunkSource{getChunk(t){const e=Object(a.b)(t);let n=this.chunks.get(e);return void 0===n&&((n=this.getNewChunk_(h)).initializeSkeletonChunk(e,t),this.addChunk(n)),n}}let d=class extends s.a{constructor(t,e){super(t,e),this.source=this.registerDisposer(t.getRef(e.source)),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>{this.updateChunkPriorities()}))}updateChunkPriorities(){const t=this.visibility.value;if(t===Number.NEGATIVE_INFINITY)return;const e=Object(u.b)(t),n=Object(u.a)(t),{source:r,chunkManager:i}=this;Object(a.a)(this,t=>{const s=r.getChunk(t);i.requestChunk(s,e,n+60)})}};function f(t,e,n,r,s,a,o){const u=Object(i.i)(2,e,n,r,s,a,o);t.vertexPositions=u.vertexPositions,t.indices=u.indices}d=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(c.g)("skeleton/SkeletonLayer")],d)},function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)i(n,r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var s=0;s<r;s++)t[i+s]=e[n+s]},flattenChunks:function(t){var e,n,r,i,s,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)s=t[e],a.set(s,i),i+=s.length;return a}},a={arraySet:function(t,e,n,r,i){for(var s=0;s<r;s++)t[i+s]=e[n+s]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(r)},function(t,e,n){"use strict";var r=n(5),i=n(2),s=n(11),a=n(6),o=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const u=Symbol("objectId");let c=0;n.d(e,"a",function(){return l});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class h extends r.Chunk{constructor(){super(...arguments),this.backendOnly=!0}initialize(t){super.initialize(t),this.requesters=new Set}downloadSucceeded(){super.downloadSucceeded();let{requesters:t,data:e}=this;this.requesters=void 0;for(let n of t)n.resolve(e)}downloadFailed(t){super.downloadFailed(t);let{requesters:e}=this;this.requesters=void 0;for(let n of e)n.reject(t)}freeSystemMemory(){this.data=void 0}}class l extends r.ChunkSourceBase{constructor(t,e){super(t),this.registerDisposer(t);const{encodeKey:n=o.e}=e;this.downloadFunction=e.download,this.encodeKeyFunction=n;const{sourceQueueLevel:r=0}=e;this.sourceQueueLevel=r,this.registerDisposer(this.chunkManager.recomputeChunkPrioritiesLate.add(()=>{this.updateChunkPriorities()}))}updateChunkPriorities(){let{chunkManager:t}=this;for(let e of this.chunks.values()){let{requesters:n}=e;if(void 0!==n)for(let r of n){const{priorityTier:n,priority:s}=r.getPriority();n!==i.f.RECENT&&t.requestChunk(e,n,s)}}}async download(t,e){const{size:n,data:r}=await this.downloadFunction(t.decodedKey,e);t.systemMemoryBytes=n,t.data=r}getData(t,e,n){const r=this.encodeKeyFunction(t);let a=this.chunks.get(r);return void 0===a&&((a=this.getNewChunk_(h)).decodedKey=t,a.initialize(r),this.addChunk(a)),Object(s.d)(n,(t,n,r)=>{switch(a.state){case i.g.FAILED:return void n(a.error);case i.g.SYSTEM_MEMORY_WORKER:return void t(a.data)}const o={resolve:t,reject:n,getPriority:e};a.requesters.add(o),r.add(()=>{let{requesters:t}=a;void 0!==t&&(t.delete(o),this.chunkManager.scheduleUpdateChunkPriorities()),n(s.a)}),this.chunkManager.scheduleUpdateChunkPriorities()})}static get(t,e,n){return t.memoize.get(`getFileSource:${e}`,()=>new l(t.addRef(),n))}static getData(t,e,n,r,i,s){const a=l.get(t,e,n),o=a.getData(r,i,s);return a.dispose(),o}static getUrl(t,e,n,r,i){return l.getData(t,`${function(t){if(t instanceof Object){let e=t[u];return void 0===e&&(e=t[u]=c++),`o${e}`}return""+JSON.stringify(t)}(e)}`,{download:(t,n)=>Object(a.b)(t,{},a.d,n).then(t=>e(t,n))},n,r,i)}}},function(t,e,n){"use strict";var r=r||{};r.NIFTI1=r.NIFTI1||n(50),r.NIFTI2=r.NIFTI2||n(72),r.Utils=r.Utils||n(44);var i=i||n(73);r.isNIFTI1=function(t){var e,n,i,s;return!(t.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE)&&((e=new DataView(t))&&(n=e.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION)),i=e.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+1),s=e.getUint8(r.NIFTI1.MAGIC_NUMBER_LOCATION+2),!(n!==r.NIFTI1.MAGIC_NUMBER[0]||i!==r.NIFTI1.MAGIC_NUMBER[1]||s!==r.NIFTI1.MAGIC_NUMBER[2]))},r.isNIFTI2=function(t){var e,n,i,s;return!(t.byteLength<r.NIFTI1.STANDARD_HEADER_SIZE)&&(n=(e=new DataView(t)).getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION),i=e.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+1),s=e.getUint8(r.NIFTI2.MAGIC_NUMBER_LOCATION+2),!(n!==r.NIFTI2.MAGIC_NUMBER[0]||i!==r.NIFTI2.MAGIC_NUMBER[1]||s!==r.NIFTI2.MAGIC_NUMBER[2]))},r.isNIFTI=function(t){return r.isNIFTI1(t)||r.isNIFTI2(t)},r.isCompressed=function(t){var e,n,i;if(t){if(n=(e=new DataView(t)).getUint8(0),i=e.getUint8(1),n===r.Utils.GUNZIP_MAGIC_COOKIE1)return!0;if(i===r.Utils.GUNZIP_MAGIC_COOKIE2)return!0}return!1},r.decompress=function(t){return i.inflate(t).buffer},r.readHeader=function(t){var e=null;return r.isCompressed(t)&&(t=r.decompress(t)),r.isNIFTI1(t)?e=new r.NIFTI1:r.isNIFTI2(t)&&(e=new r.NIFTI2),e?e.readHeader(t):console.error("That file does not appear to be NIFTI!"),e},r.hasExtension=function(t){return 0!=t.extensionFlag[0]},r.readImage=function(t,e){var n=t.vox_offset,r=1,i=1;t.dims[4]&&(r=t.dims[4]),t.dims[5]&&(i=t.dims[5]);var s=t.dims[1]*t.dims[2]*t.dims[3]*r*i*(t.numBitsPerVoxel/8);return e.slice(n,n+s)},r.readExtension=function(t,e){var n=t.getExtensionLocation(),r=t.extensionSize;return e.slice(n,n+r)},r.readExtensionData=function(t,e){var n=t.getExtensionLocation(),r=t.extensionSize;return e.slice(n+8,n+r-8)},"undefined"!==typeof t&&t.exports&&(t.exports=r)},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function r(t,e,n){t.data=new Uint32Array(n)}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n(2),s=n(18),a=n(23);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function o(t,e,n,r,i,s){let a=0,o=0,u=1,c=1;for(let t=0;t<3;++t){let e=i[t],s=r[t],h=e%s;a+=Math.floor(e/s)*u,u*=Math.ceil(n[t]/s),o+=h*c,c*=s}let h=e+2*a,l=t[h],d=t[h+1],f=16777215&l,p=l>>24&255;if(p>0){f+=s*(t[(e+d&16777215)+Math.floor(o*p/32)]>>o*p%32&(1<<p)-1)}return f}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u(t,e,n,r,i){const s=r[0]*r[1]*r[2]*1;if(s!==t.length)throw new Error(`Output length ${t.length} is not equal to expected length ${s}.`);let a=r[0],u=r[1],c=r[2],h=[0,0,0],l=0;for(let s=0;s<c;++s){h[2]=s;for(let s=0;s<u;++s){h[1]=s;for(let s=0;s<a;++s){h[0]=s;let a=o(e,n,r,i,h,1)+n;t[l++]=e[a]}}}return t}function c(t,e,n,r,i){const s=r[0]*r[1]*r[2]*2;if(s!==t.length)throw new Error(`Output length ${t.length} is not equal to expected length ${s}.`);let a=r[0],u=r[1],c=r[2],h=[0,0,0],l=0;for(let s=0;s<c;++s){h[2]=s;for(let s=0;s<u;++s){h[1]=s;for(let s=0;s<a;++s){h[0]=s;let a=o(e,n,r,i,h,2)+n;t[l++]=e[a],t[l++]=e[a+1]}}}return t}var h=n(16),l=n(11),d=n(8),f=n(0),p=n(1);n.d(e,"VolumeComputationBackend",function(){return g}),n.d(e,"copyBufferOverlap",function(){return b}),n.d(e,"ComputedVolumeChunk",function(){return _}),n.d(e,"ComputedVolumeChunkSource",function(){return w});class g extends p.c{constructor(t,e){super(t,e),this.params=e}createOutputBuffer(){const{outputSpec:t}=this.params;return new ArrayBuffer(Object(f.j)(t.size)*t.numChannels*d.a[t.dataType])}}function m(t,e,n,r){return t%n[0]+e[0]+(Math.floor(t/n[0])%n[1]+e[1])*r[0]+(Math.floor(t/(n[0]*n[1]))%n[2]+e[2])*r[0]*r[1]+Math.floor(t/(n[0]*n[1]*n[2]))*r[0]*r[1]*r[2]}function b(t,e,n,r,i,s,a){let o=a===d.b.UINT64?(t,e)=>{s[2*e]=n[2*t],s[2*e+1]=n[2*t+1]}:(t,e)=>{s[e]=n[t]};const u=f.n.max(f.n.create(),t,r),c=f.n.add(f.n.create(),t,e),h=f.n.add(f.n.create(),r,i),l=f.n.min(f.n.create(),c,h),p=f.n.subtract(f.n.create(),l,u),g=f.n.subtract(f.n.create(),u,t),b=f.n.subtract(f.n.create(),u,r);for(let t=0;t<Object(f.j)(p);++t){o(m(t,g,p,e),m(t,b,p,i))}}function y(t){return t.toLocaleString()}class _ extends h.a{constructor(){super(...arguments),this.computing_=!1,this.initialized_=!1,this.originGridPositions_=new Map,this.isComputational=!0}initializeComputation(t,e){if(!this.source)throw new Error("initializeComputation must be called after source is valid.");if(!this.chunkDataSize)throw new Error("initializeComputation must be called after computeChunkBounds.");this.computationParams_=t,this.cancellationToken_=e,this.computing_=!1,this.inputBuffer_=void 0,this.cancellationToken_.add(()=>{this.fail_(l.a)});const{inputSpec:n,outputSpec:r}=this.computationParams_,i=[2,2,2],s=f.n.multiply(f.n.create(),this.chunkGridPosition,r.size),a=f.n.add(f.n.create(),s,f.n.divide(f.n.create(),r.size,i)),o=this.source.parameters.scaleFactor,u=f.n.divide(f.n.create(),a,o),c=n.size;return this.inputLower_=f.n.subtract(f.n.create(),u,f.n.divide(f.n.create(),c,i)),this.inputBuffer_=new ArrayBuffer(this.systemMemoryBytes),this.setupSourceChunks_(),this.initialized_=!0,new Promise((t,e)=>{this.resolve_=t,this.reject_=e})}initializeVolumeChunk(t,e){super.initializeVolumeChunk(t,e);const{inputSpec:n}=this.source.computation.params,r=n.size,i=Object(f.j)(r)*n.numChannels,s=n.dataType;this.systemMemoryBytes=i*d.a[s]}stateChanged(t){const e=t;switch(e.state){case i.g.SYSTEM_MEMORY_WORKER:this.copyOriginChunk_(e);break;case i.g.FAILED:case i.g.EXPIRED:this.fail_(new Error("Data source chunk has expired."));break;case i.g.SYSTEM_MEMORY:case i.g.GPU_MEMORY:{const t=y(e.chunkGridPosition),n=e.chunkDataSize,r=this.source.originSource,i=f.n.multiply(f.n.create(),e.chunkGridPosition,r.spec.chunkDataSize);this.source.requestChunkData(this,e).then(e=>{const a=this.originGridPositions_.get(t),o=r.getChunk(a);o.unregisterListener(this),this.originGridPositions_.delete(t);const u=this.computationParams_.inputSpec,c=Object(s.c)(this.inputBuffer_,u.dataType),h=r.spec.numChannels,l=this.maybeDecodeBuffer_(e,u.dataType,o.chunkDataSize,h);b(i,n,l,this.inputLower_,u.size,c,u.dataType),setTimeout(()=>this.checkDone_(),0)}).catch(t=>{console.log(this.key,"unable to retrieve frontend data for",e.key),this.fail_(t)});break}}}getOverlappingOriginGridPositions(){return this.originGridPositions_.values()}dispose(){super.dispose(),this.cleanup_()}cleanup_(){if(this.initialized_&&this.source){for(const t of this.originGridPositions_.values())this.source.originSource.getChunk(t).unregisterListener(this),this.source.cancelChunkDataRequest(y(t),this.key);this.originGridPositions_.clear(),this.source.unregisterChunk(this)}}fail_(t){this.cleanup_(),this.reject_(t)}maybeDecodeBuffer_(t,e,n,r){const i=this.source.originSource;if(!i.spec.compressedSegmentationBlockSize)return t;const s=i.spec.compressedSegmentationBlockSize,a=[n[0],n[1],n[2],r];if(e===d.b.UINT32){const e=new Uint32Array(Object(f.j)(n)*r);return function(t,e,n,r,i){const s=r[0]*r[1]*r[2]*1,a=s*r[3];if(a!==t.length)throw new Error(`Output length ${t.length} is not equal to expected length ${a}.`);const o=r[3];for(let a=0;a<o;++a)u(t.subarray(s*a,s*(a+1)),e,n+e[a],r,i)}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,t,0,a,s),e}if(e===d.b.UINT64){const e=new Uint32Array(Object(f.j)(n)*r*2);return function(t,e,n,r,i){const s=r[0]*r[1]*r[2]*2,a=s*r[3];if(a!==t.length)throw new Error(`Output length ${t.length} is not equal to expected length ${a}.`);const o=r[3];for(let a=0;a<o;++a)c(t.subarray(s*a,s*(a+1)),e,n+e[a],r,i)}(e,t,0,a,s),e}throw new Error("Compression is unsupported for datatypes other than UINT32 and UINT64")}copyOriginChunk_(t){const e=this.computationParams_.inputSpec,n=y(t.chunkGridPosition);this.originGridPositions_.delete(n);const r=t.chunkDataSize,i=e.numChannels,a=f.n.multiply(f.n.create(),t.chunkGridPosition,this.source.originSource.spec.chunkDataSize);let o=Object(s.c)(this.inputBuffer_,e.dataType);b(a,r,this.maybeDecodeBuffer_(t.data,e.dataType,r,i),this.inputLower_,e.size,o,e.dataType),t.unregisterListener(this),setTimeout(()=>this.checkDone_(),0)}performComputation_(){if(this.cancellationToken_.isCanceled)return Promise.reject(l.a);const t=this.source.computation,{outputSpec:e}=this.computationParams_,n=e.size,r=e.dataType;return t.compute(this.inputBuffer_,this.cancellationToken_,this).then(t=>{if(this.inputBuffer_=void 0,f.n.equals(n,this.chunkDataSize))return Object(a.a)(this,this.cancellationToken_,t);const i=Object(s.c)(t,r),o=new ArrayBuffer(Object(f.j)(this.chunkDataSize)*e.numChannels*d.a[r]),u=Object(s.c)(o,r),c=f.n.multiply(f.n.create(),this.chunkGridPosition,n);return b(c,n,i,c,this.chunkDataSize,u,r),Object(a.a)(this,this.cancellationToken_,o)})}checkDone_(){this.computing_||0===this.originGridPositions_.size&&(this.computing_=!0,this.cleanup_(),this.performComputation_().then(()=>{this.resolve_&&this.resolve_()}).catch(t=>{this.reject_(t)}))}setupSourceChunks_(){const t=this.source.originSource,e=t.spec.chunkDataSize,n=this.computationParams_.inputSpec,r=this.inputLower_,i=f.n.floor(f.n.create(),f.n.divide(f.n.create(),r,e)),s=f.n.subtract(f.n.create(),n.size,[1,1,1]),a=f.n.add(f.n.create(),r,s);f.n.max(i,i,[0,0,0]),f.n.min(a,a,t.spec.upperVoxelBound);const o=f.n.floor(f.n.create(),f.n.divide(f.n.create(),a,e)),u=f.n.create();for(let t=i[2];t<=o[2];++t)for(let e=i[1];e<=o[1];++e)for(let n=i[0];n<=o[0];++n){u.set([n,e,t]);const r=y(u);this.originGridPositions_.set(r,f.n.copy(f.n.create(),u))}for(const e of this.originGridPositions_.values()){const n=t.getChunk(e);n.registerListener(this),this.stateChanged(n)}}}let w=class extends(Object(r.WithParameters)(h.b,s.b)){constructor(t,e){super(t,e),this.pendingComputations_=new Map,this.frontendRequestPromises_=new Map,this.originSource=this.rpc.getRef(this.parameters.sourceRef),this.computation=this.rpc.getRef(this.parameters.computationRef),this.registerDisposer(this.chunkManager),this.registerDisposer(this.chunkManager.recomputeChunkPrioritiesLate.add(()=>{this.updateChunkPriorities()}))}updateChunkPriorities(){for(const t of this.pendingComputations_.values())if(t.priorityTier!==i.f.RECENT)for(const e of t.getOverlappingOriginGridPositions()){const n=this.originSource.getChunk(e);this.chunkManager.requestChunk(n,t.priorityTier,t.priority,!1)}}unregisterChunk(t){const e=t.key;this.pendingComputations_.delete(e)}requestChunkData(t,e){return new Promise((n,r)=>{const i=y(e.chunkGridPosition),s=t.key;this.frontendRequestPromises_.has(i)?this.frontendRequestPromises_.get(i).set(s,{resolve:n,reject:r}):(this.frontendRequestPromises_.set(i,new Map([[s,{resolve:n,reject:r}]])),this.chunkManager.queueManager.retrieveChunkData(e).then(t=>{const e=this.frontendRequestPromises_.get(i);if(e){for(const n of e.values())n.resolve(t);this.frontendRequestPromises_.delete(i)}}).catch(t=>{const e=this.frontendRequestPromises_.get(i);if(e){for(const n of e.values())n.reject(t);this.frontendRequestPromises_.delete(i)}}))})}cancelChunkDataRequest(t,e){if(this.frontendRequestPromises_.has(t)){const n=this.frontendRequestPromises_.get(t);n.delete(e),0===n.size&&this.frontendRequestPromises_.delete(t)}}download(t,e){const n=t;this.computeChunkBounds(n),this.pendingComputations_.set(t.key,n);const r=n.initializeComputation(this.computation.params,e);return this.chunkManager.scheduleUpdateChunkPriorities(),r}};(w=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(p.g)()],w)).prototype.chunkConstructor=_},function(t,e,n){"use strict";var r=n(22);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=Object(r.a)("encodeCompressedSegmentationUint32"),s=Object(r.a)("encodeCompressedSegmentationUint64");var a=n(15),o=n(9);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function u(t,e,n){const{spec:r}=t.source;if(void 0!==r.compressedSegmentationBlockSize){const{dataType:u}=r,c=t.chunkDataSize,h=[c[0],c[1],c[2],r.numChannels];switch(u){case o.a.UINT32:t.data=await Object(a.a)(i,e,[n.buffer],n,h,r.compressedSegmentationBlockSize);break;case o.a.UINT64:t.data=await Object(a.a)(s,e,[n.buffer],n,h,r.compressedSegmentationBlockSize);break;default:throw new Error(`Unsupported data type for compressed segmentation: ${o.a[u]}`)}}else t.data=n}n.d(e,"a",function(){return u})},function(t,e,n){"use strict";n.d(e,"a",function(){return s});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const r=3432918353,i=461845907;function s(t,e){return e>>>=0,t>>>=0,e=((e=Math.imul(e,r)>>>0)<<15|e>>>17)>>>0,t=5*(t=((t=(t^(e=Math.imul(e,i)>>>0))>>>0)<<13|t>>>19)>>>0)+3864292196>>>0}},function(t,e,n){"use strict";var r=n(4);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=Symbol("disjoint_sets:rank"),s=Symbol("disjoint_sets:parent"),a=Symbol("disjoint_sets:next"),o=Symbol("disjoint_sets:prev");function u(t){let e=t,n=t[s];for(;n!==t;)n=(t=n)[s];for(t=e[s];n!==t;)e[s]=n,t=(e=t)[s];return n}function*c(t){let e=t;do{yield e,e=e[a]}while(e!==t)}const h=Symbol("disjoint_sets:min");class l{constructor(){this.map=new Map,this.generation=0}get(t){let e=t.toString(),n=this.map.get(e);return void 0===n?t:u(n)[h]}isMinElement(t){let e=this.get(t);return e===t||r.a.equal(e,t)}makeSet(t){let e=t.toString(),{map:n}=this,r=n.get(e);return void 0===r?(r=t.clone(),(c=r)[s]=c,c[i]=0,c[a]=c[o]=c,r[h]=r,n.set(e,r),r):u(r);var c}link(t,e){if((t=this.makeSet(t))===(e=this.makeSet(e)))return!1;this.generation++;let n=function(t,e){let n=t[i],r=e[i];return n>r?(e[s]=t,t):(t[s]=e,n===r&&(e[i]=r+1),e)}(t,e);!function(t,e){let n=t[o],r=e[o];e[o]=n,n[a]=e,t[o]=r,r[a]=t}(t,e);let u=t[h],c=e[h];return n[h]=r.a.less(u,c)?u:c,!0}*setElements(t){let e=t.toString(),n=this.map.get(e);void 0===n?yield t:yield*c(n)}clear(){let{map:t}=this;return 0!==t.size&&(++this.generation,t.clear(),!0)}get size(){return this.map.size}*mappings(t=new Array(2)){for(let e of this.map.values())t[0]=e,t[1]=u(e)[h],yield t}[Symbol.iterator](){return this.mappings()}toJSON(){let t=new Array;for(let n of this.map.values())if((e=n)[s]===e){let e=new Array;for(let t of c(n))e.push(t);e.sort(r.a.compare),t.push(e)}var e;return t.sort((t,e)=>r.a.compare(t[0],e[0])),t.map(t=>t.map(t=>t.toString()))}}var d=n(3),f=n(13),p=n(1);let g=class extends p.c{constructor(){super(...arguments),this.disjointSets=new l,this.changed=new f.a}static makeWithCounterpart(t){let e=new this;return e.initializeCounterpart(t),e}disposed(){this.disjointSets=void 0,this.changed=void 0,super.disposed()}link(t,e){if(this.disjointSets.link(t,e)){let{rpc:n}=this;n&&n.invoke("DisjointUint64Sets.add",{id:this.rpcId,al:t.low,ah:t.high,bl:e.low,bh:e.high}),this.changed.dispatch()}}get(t){return this.disjointSets.get(t)}clear(){if(this.disjointSets.clear()){let{rpc:t}=this;t&&t.invoke("DisjointUint64Sets.clear",{id:this.rpcId}),this.changed.dispatch()}}setElements(t){return this.disjointSets.setElements(t)}get size(){return this.disjointSets.size}toJSON(){return this.disjointSets.toJSON()}restoreState(t){if(this.clear(),void 0!==t){let e=[new r.a,new r.a];Object(d.a)(t,t=>{Object(d.a)(t,(t,n)=>{e[n%2].parseString(String(t),10),0!==n&&this.link(e[0],e[1])})})}}};g=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(p.g)("DisjointUint64Sets")],g);const m=new r.a,b=new r.a;Object(p.f)("DisjointUint64Sets.add",function(t){let e=this.get(t.id);m.low=t.al,m.high=t.ah,b.low=t.bl,b.high=t.bh,e.disjointSets.link(m,b)&&e.changed.dispatch()}),Object(p.f)("DisjointUint64Sets.clear",function(t){let e=this.get(t.id);e.disjointSets.clear()&&e.changed.dispatch()});var y=n(36),_=n(39);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const w=3,v=.9,I=!1;let k=0,S=0,T=0,M=0;class E{constructor(t=E.generateHashSeeds(w)){this.hashSeeds=t,this.loadFactor=v,this.size=0,this.emptyLow=4294967295,this.emptyHigh=4294967295,this.maxRehashAttempts=5,this.maxAttempts=5,this.generation=0,this.mungedEmptyKey=-1;let e=8;for(;e<2*t.length;)e*=2;this.allocate(e)}updateHashFunctions(t){this.hashSeeds=E.generateHashSeeds(t),this.mungedEmptyKey=-1}tableWithMungedEmptyKey(t){const e=this.hashSeeds.length,n=new Array(e);for(let t=0;t<e;++t)n[t]=this.getHash(t,this.emptyLow,this.emptyHigh);let{mungedEmptyKey:r}=this;if(-1===r)t:for(;;){r=16777216*Math.random()>>>0;for(let t=0;t<e;++t){let i=this.getHash(t,r,r);for(let t=0;t<e;++t)if(n[t]===i)continue t}this.mungedEmptyKey=r;break}let{table:i,emptyLow:s,emptyHigh:a}=this;for(let t=0;t<e;++t){let e=n[t];i[e]===s&&i[e+1]===a&&(i[e]=r,i[e+1]=r)}try{t(i)}finally{for(let t=0;t<e;++t){let e=n[t];i[e]===r&&i[e+1]===r&&(i[e]=s,i[e+1]=a)}}}static generateHashSeeds(t=w){return Object(_.b)(new Uint32Array(t))}getHash(t,e,n){let r=this.hashSeeds[t];return r=Object(y.a)(r,e),r=Object(y.a)(r,n),this.entryStride*(r&this.tableSize-1)}*keys(t=new r.a){let{emptyLow:e,emptyHigh:n,entryStride:i}=this,{table:s}=this;for(let r=0,a=s.length;r<a;r+=i){let i=s[r],a=s[r+1];i===e&&a===n||(t.low=i,t.high=a,yield t)}}indexOfPair(t,e){let{table:n,emptyLow:r,emptyHigh:i}=this;if(t===r&&e===i)return-1;for(let r=0,i=this.hashSeeds.length;r<i;++r){let i=this.getHash(r,t,e);if(n[i]===t&&n[i+1]===e)return i}return-1}indexOf(t){return this.indexOfPair(t.low,t.high)}chooseAnotherEmptyKey(){let t,e,{emptyLow:n,emptyHigh:r,table:i,entryStride:s}=this;for(;t=4294967296*Math.random()>>>0,e=4294967296*Math.random()>>>0,t===n&&e===r||this.hasPair(t,e););this.emptyLow=t,this.emptyHigh=e;for(let a=0,o=i.length;a<o;a+=s)i[a]===n&&i[a+1]===r&&(i[a]=t,i[a+1]=e)}has(t){return-1!==this.indexOf(t)}hasPair(t,e){return-1!==this.indexOfPair(t,e)}delete(t){let e=this.indexOf(t);if(-1!==e){let{table:t}=this;return t[e]=this.emptyLow,t[e+1]=this.emptyHigh,++this.generation,this.size--,!0}return!1}clearTable(){let{table:t,entryStride:e,emptyLow:n,emptyHigh:r}=this,i=t.length;for(let s=0;s<i;s+=e)t[s]=n,t[s+1]=r}clear(){return 0!==this.size&&(this.size=0,++this.generation,this.clearTable(),!0)}swapPending(t,e){let n=k,r=S;this.storePending(t,e),t[e]=n,t[e+1]=r}storePending(t,e){k=t[e],S=t[e+1]}backupPending(){T=k,M=S}restorePending(){k=T,S=M}tryToInsert(){I&&console.log(`tryToInsert: ${k}, ${S}`);let t=0,{emptyLow:e,emptyHigh:n,maxAttempts:r,table:i}=this,s=this.hashSeeds.length,a=Math.floor(Math.random()*s);for(;;){let o=this.getHash(a,k,S);if(this.swapPending(i,o),k===e&&S===n)return!0;if(++t===r)break;a=(a+Math.floor(Math.random()*(s-1))+1)%s}return!1}allocate(t){this.tableSize=t;let{entryStride:e}=this;this.table=new Uint32Array(t*e),this.maxAttempts=t,this.clearTable(),this.capacity=t*this.loadFactor,this.mungedEmptyKey=-1}rehash(t,e){I&&console.log("rehash begin"),this.allocate(e),this.updateHashFunctions(this.hashSeeds.length);let{emptyLow:n,emptyHigh:r,entryStride:i}=this;for(let e=0,s=t.length;e<s;e+=i){let i=t[e],s=t[e+1];if((i!==n||s!==r)&&(this.storePending(t,e),!this.tryToInsert()))return I&&console.log("rehash failed"),!1}return I&&console.log("rehash end"),!0}grow(t){I&&console.log(`grow: ${t}`);let e=this.table,{tableSize:n}=this;for(;n<t;)n*=2;for(;;){for(let t=0;t<this.maxRehashAttempts;++t)if(this.rehash(e,n))return void(I&&console.log("grow end"));n*=2}}insertInternal(){for(++this.generation,k===this.emptyLow&&S===this.emptyHigh&&this.chooseAnotherEmptyKey(),++this.size>this.capacity&&(this.backupPending(),this.grow(2*this.tableSize),this.restorePending());!this.tryToInsert();)this.backupPending(),this.grow(this.tableSize),this.restorePending()}}class O extends E{add(t){let{low:e,high:n}=t;return!this.hasPair(e,n)&&(I&&console.log(`add: ${e},${n}`),k=e,S=n,this.insertInternal(),!0)}[Symbol.iterator](){return this.keys()}}O.prototype.entryStride=2;let x=0,C=0,N=0,A=0;
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var j;(class extends E{set(t,e){let{low:n,high:r}=t;return!this.hasPair(n,r)&&(I&&console.log(`add: ${n},${r} -> ${e.low},${e.high}`),k=n,S=r,x=e.low,C=e.high,this.insertInternal(),!0)}get(t,e){let n=this.indexOf(t);if(-1===n)return!1;let{table:r}=this;return e.low=r[n+2],e.high=r[n+3],!0}swapPending(t,e){let n=x,r=C;super.swapPending(t,e),t[e+2]=n,t[e+3]=r}storePending(t,e){super.storePending(t,e),x=t[e+2],C=t[e+3]}backupPending(){super.backupPending(),N=x,A=C}restorePending(){super.restorePending(),x=N,C=A}[Symbol.iterator](){return this.entries()}*entries(t=[new r.a,new r.a]){let{emptyLow:e,emptyHigh:n,entryStride:i}=this,{table:s}=this,[a,o]=t;for(let r=0,u=s.length;r<u;r+=i){let i=s[r],u=s[r+1];i===e&&u===n||(a.low=i,a.high=u,o.low=s[r+2],o.high=s[r+3],yield t)}}}).prototype.entryStride=4;let P=j=class extends p.c{constructor(){super(...arguments),this.hashTable=new O,this.changed=new f.b}static makeWithCounterpart(t){let e=new j;return e.initializeCounterpart(t),e}disposed(){super.disposed(),this.hashTable=void 0,this.changed=void 0}add_(t){return this.hashTable.add(t)}add(t){if(this.add_(t)){let{rpc:e}=this;e&&e.invoke("Uint64Set.add",{id:this.rpcId,value:t}),this.changed.dispatch(t,!0)}}has(t){return this.hashTable.has(t)}[Symbol.iterator](){return this.hashTable.keys()}delete_(t){return this.hashTable.delete(t)}delete(t){if(this.delete_(t)){let{rpc:e}=this;e&&e.invoke("Uint64Set.delete",{id:this.rpcId,value:t}),this.changed.dispatch(t,!1)}}get size(){return this.hashTable.size}clear(){if(this.hashTable.clear()){let{rpc:t}=this;t&&t.invoke("Uint64Set.clear",{id:this.rpcId}),this.changed.dispatch(null,!1)}}toJSON(){let t=new Array;for(let e of this)t.push(e.toString());return t.sort(),t}};P=j=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(p.g)("Uint64Set")],P),Object(p.f)("Uint64Set.add",function(t){let e=this.get(t.id);e.add_(t.value)&&e.changed.dispatch()}),Object(p.f)("Uint64Set.delete",function(t){let e=this.get(t.id);e.delete_(t.value)&&e.changed.dispatch()}),Object(p.f)("Uint64Set.clear",function(t){let e=this.get(t.id);e.hashTable.clear()&&e.changed.dispatch()});var U=n(5),D=n(12);n.d(e,"a",function(){return F});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const R=Object(D.c)(Object(U.withChunkManager)(p.c));class F extends R{constructor(t,e){super(t,e),this.visibleSegments=t.get(e.visibleSegments),this.segmentEquivalences=t.get(e.segmentEquivalences),this.objectToDataTransform=t.get(e.objectToDataTransform),this.renderScaleTarget=t.get(e.renderScaleTarget);const n=()=>{this.chunkManager.scheduleUpdateChunkPriorities()};this.registerDisposer(this.visibleSegments.changed.add(n)),this.registerDisposer(this.segmentEquivalences.changed.add(n)),this.registerDisposer(this.objectToDataTransform.changed.add(n)),this.registerDisposer(this.renderScaleTarget.changed.add(n))}}},function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n(17),i=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class s{constructor(){this.map=new Map}get(t,e){let{map:n}=this,r=n.get(t);return void 0===r?((r=e()).registerDisposer(()=>{n.delete(t)}),n.set(t,r)):r.addRef(),r}}class a extends s{get(t,e){return"string"!=typeof t&&(t=Object(i.e)(t)),super.get(t,e)}getUncounted(t,e){return this.get(t,()=>new r.b(e())).value}}},function(t,e,n){"use strict";
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function r(t=128){const e=Math.ceil(t/32),n=new Uint32Array(e);crypto.getRandomValues(n);let r="";for(let t=0;t<e;++t)r+=("00000000"+n[t].toString(16)).slice(-8);return r}function i(t){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(let t=0,n=e.length;t<n;t+=65536)crypto.getRandomValues(e.subarray(t,Math.min(n,t+65536)));return t}n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i})},function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n(11),i=n(6);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function s(t,e,n,s,a,o,u=r.e){let c;t:for(;;){c=await t.get(c,u);e:for(;;)try{return await Object(i.b)(e,a(c.credentials,n),s,u)}catch(t){if(t instanceof i.a){if("refresh"===o(t))continue t;continue e}throw t}}}},function(t,e,n){"use strict";var r=n(11);n(17),n(38);function i(t){let e,n,i;return(s,a)=>void 0===n||void 0!==e&&void 0!==s&&e.generation===s.generation?(e=void 0,i=new r.c,n=t(s,i).then(t=>(e=t,i=void 0,t),t=>{throw i.isCanceled&&(i=void 0,n=void 0),t})):(void 0===e&&i.addConsumer(a),n)}var s=n(1);n.d(e,"a",function(){return o});let a=class extends s.c{constructor(){super(...arguments),this.get=i((t,e)=>this.rpc.promiseInvoke("CredentialsProvider.get",{providerId:this.rpcId,invalidCredentials:t},e))}};function o(){return function(t){return class extends t{constructor(...t){super(...t);const e=t[1];this.credentialsProvider=this.rpc.getRef(e.credentialsProvider)}}}}a=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(s.g)("CredentialsProvider")],a)},function(t,e,n){"use strict";n.r(e);var r=n(19),i=n(9);class s extends i.i{}var a=n(5),o=n(2),u=n(46),c=n(21),h=n(26),l=n(20),d=n(0),f=n(12),p=n(1);n.d(e,"AnnotationMetadataChunk",function(){return b}),n.d(e,"AnnotationGeometryData",function(){return y}),n.d(e,"AnnotationGeometryChunk",function(){return w}),n.d(e,"AnnotationSubsetGeometryChunk",function(){return v}),n.d(e,"AnnotationSource",function(){return T});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var g=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const m=200;class b extends a.Chunk{freeSystemMemory(){this.annotation=void 0}serialize(t,e){super.serialize(t,e),t.annotation=this.annotation}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=0,super.downloadSucceeded()}}class y{serialize(t,e){t.data=this.data,t.typeToOffset=this.typeToOffset,t.typeToIds=this.typeToIds,t.segmentList=this.segmentList,t.segmentListIndex=this.segmentListIndex,e.push(this.data.buffer,this.segmentList.buffer,this.segmentListIndex.buffer)}get numBytes(){return this.data.byteLength}}function _(t){return class extends t{serialize(t,e){super.serialize(t,e),this.data.serialize(t,e),this.data=void 0}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=this.data.numBytes,super.downloadSucceeded()}freeSystemMemory(){this.data=void 0}}}class w extends(_(h.SliceViewChunk)){}class v extends(_(a.Chunk)){}let I=class extends a.ChunkSource{constructor(){super(...arguments),this.parent=void 0}getChunk(t){const{chunks:e}=this;let n=e.get(t);return void 0===n&&((n=this.getNewChunk_(b)).initialize(t),this.addChunk(n)),n}download(t,e){return this.parent.downloadMetadata(t,e)}};I=g([Object(p.g)("annotation.MetadataChunkSource")],I);let k=class extends h.SliceViewChunkSource{constructor(t,e){super(t,e),this.parent=void 0,this.spec=new s(e.spec)}download(t,e){return this.parent.downloadGeometry(t,e)}};(k=g([Object(p.g)("annotation.GeometryChunkSource")],k)).prototype.chunkConstructor=w;let S=class extends a.ChunkSource{constructor(t,e){super(t,e),this.parent=void 0}getChunk(t){const e=Object(c.b)(t),{chunks:n}=this;let r=n.get(e);return void 0===r&&((r=this.getNewChunk_(v)).initialize(e),r.objectId=t.clone(),this.addChunk(r)),r}download(t,e){return this.parent.downloadSegmentFilteredGeometry(t,e)}};S=g([Object(p.g)("annotation.SubsetGeometryChunkSource")],S);class T extends p.c{constructor(t,e){super(t,e),this.references=new Set;const n=this.chunkManager=t.get(e.chunkManager),r=this.metadataChunkSource=this.registerDisposer(t.getRef(e.metadataChunkSource));this.sources=e.sources.map(e=>e.map(e=>{const n=this.registerDisposer(t.getRef(e));return n.parent=this,n})),this.segmentFilteredSource=this.registerDisposer(t.getRef(e.segmentFilteredSource)),this.segmentFilteredSource.parent=this,r.parent=this,this.registerDisposer(n.recomputeChunkPriorities.add(()=>this.recomputeChunkPriorities()))}recomputeChunkPriorities(){const{chunkManager:t,metadataChunkSource:e}=this;for(const n of this.references)t.requestChunk(e.getChunk(n),o.f.VISIBLE,m)}add(t){throw new Error("Not implemented")}delete(t){throw new Error("Not implemented")}update(t,e){throw new Error("Not implemented")}}Object(p.f)("annotation.reference.add",function(t){const e=this.get(t.id);e.references.add(t.annotation),e.chunkManager.scheduleUpdateChunkPriorities()}),Object(p.f)("annotation.reference.delete",function(t){const e=this.get(t.id);e.references.delete(t.annotation),e.chunkManager.scheduleUpdateChunkPriorities()}),Object(p.f)("annotation.commit",function(t){const e=this.get(t.id),n=t.annotationId,i=Object(r.c)(t.newAnnotation);let s;(s=void 0===n?e.add(i).then(t=>Object.assign({},i,{id:t})):null===i?e.delete(n).then(()=>null):e.update(n,i).then(()=>i)).then(t=>{e.wasDisposed||this.invoke("annotation.commit",{id:e.rpcId,annotationId:n||i.id,newAnnotation:t})},t=>{e.wasDisposed||this.invoke("annotation.commit",{id:e.rpcId,annotationId:n,error:t.message})})});let M=class extends u.PerspectiveViewRenderLayer{constructor(t,e){super(t,e),this.source=t.get(e.source),this.filterBySegmentation=t.get(e.filterBySegmentation),this.viewStates.changed.add(()=>this.source.chunkManager.scheduleUpdateChunkPriorities()),this.filterBySegmentation.changed.add(()=>this.source.chunkManager.scheduleUpdateChunkPriorities()),this.registerDisposer(this.source.chunkManager.recomputeChunkPriorities.add(()=>this.recomputeChunkPriorities()))}recomputeChunkPriorities(){const{source:t}=this;if(!this.filterBySegmentation.value)for(const e of this.viewStates){const n=e.visibility.value;if(n===Number.NEGATIVE_INFINITY)continue;const r=Object(f.b)(n),i=Object(f.a)(n);for(const e of t.sources)for(const n of e){const e=n.getChunk(d.h);t.chunkManager.requestChunk(e,r,i)}}}};M=g([Object(p.g)("annotation/PerspectiveRenderLayer")],M);let E=class extends(Object(f.c)(Object(a.withChunkManager)(p.c))){constructor(t,e){super(t,e),this.segmentationState=new l.b(void 0),this.source=t.get(e.source),this.segmentationState.value=this.getSegmentationState(e.segmentationState);const n=()=>this.chunkManager.scheduleUpdateChunkPriorities();this.registerDisposer(Object(l.c)(this.segmentationState,(t,e)=>{null!=e&&(t.registerDisposer(e.visibleSegments.changed.add(n)),t.registerDisposer(e.segmentEquivalences.changed.add(n)))})),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>this.recomputeChunkPriorities()))}recomputeChunkPriorities(){const t=this.segmentationState.value;if(null==t)return;const e=this.visibility.value;if(e===Number.NEGATIVE_INFINITY)return;const n=Object(f.b)(e),r=Object(f.a)(e),{chunkManager:i}=this,s=this.source.segmentFilteredSource;Object(c.a)(t,t=>{const e=s.getChunk(t);i.requestChunk(e,n,r+60)})}getSegmentationState(t){return null==t?t:{visibleSegments:this.rpc.get(t.visibleSegments),segmentEquivalences:this.rpc.get(t.segmentEquivalences)}}};E=g([Object(p.g)("annotation/RenderLayer")],E),Object(p.f)("annotation/RenderLayer.updateSegmentation",function(t){const e=this.get(t.id);e.segmentationState.value=e.getSegmentationState(t.segmentationState)})},function(t,e,n){"use strict";var r=n(5),i=n(2),s=n(10);class a{}class o extends a{}o.RPC_ID="single_mesh/SingleMeshSource";var u=n(3),c=n(12),h=n(1);n.d(e,"a",function(){return g}),n.d(e,"b",function(){return m});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var l=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};class d extends r.Chunk{constructor(){super(),this.data=null}freeSystemMemory(){this.data=null}serialize(t,e){super.serialize(t,e);let{vertexPositions:n,indices:r,vertexNormals:i,vertexAttributes:s}=this.data;t.vertexPositions=n,t.indices=r,t.vertexNormals=i,t.vertexAttributes=s;const a=new Set;a.add(n.buffer),a.add(r.buffer),a.add(i.buffer);for(const t of s)a.add(t.buffer);e.push(...a),this.data=null}downloadSucceeded(){let{vertexPositions:t,indices:e,vertexNormals:n,vertexAttributes:r}=this.data,i=this.gpuMemoryBytes=t.byteLength+e.byteLength+n.byteLength;for(const t of r)i+=t.byteLength;this.systemMemoryBytes=this.gpuMemoryBytes=i,super.downloadSucceeded()}}const f=new Map,p=new Map;function g(t,e){f.set(t,e)}function m(t,e){p.set(t,e)}const b=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/;function y(t,e){let n=e.match(b);if(null===n||void 0===n[1])throw new Error('Data source URL must have the form "<protocol>://<path>".');let r=n[1],i=t.get(r);if(void 0===i)throw new Error(`Unsupported data source: ${JSON.stringify(r)}.`);return[i,n[2],r]}function _(t,e,n,r){let[i,s]=y(f,e);return i.getMesh(t,s,n,r)}function w(t,e,n,r){let[i,s]=y(p,e);return i.getMeshVertexAttributes(t,s,n,r)}function v(t,e,n,r){let i=[_(t,e.meshSourceUrl,n,r)];for(let s of e.attributeSourceUrls)i.push(w(t,s,n,r));return Promise.all(i).then(t=>{let n=t[0],r={info:{numVertices:n.info.numVertices,numTriangles:n.info.numTriangles,vertexAttributes:[]},vertexPositions:n.vertexPositions,indices:n.indices,vertexNormals:n.vertexNormals,vertexAttributes:[]};function i(t,e,n){let[i,s]=function(t){let e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let r of t)e=Math.min(e,r),n=Math.max(n,r);return[e,n]}(e);r.info.vertexAttributes.push({name:t.name,source:n,numComponents:t.numComponents,dataType:t.dataType,min:i,max:s}),r.vertexAttributes.push(e)}function s(t,e,n){const r=t.length;for(let s=0;s<r;++s)i(t[s],e[s],n)}return s(n.info.vertexAttributes,n.vertexAttributes),e.attributeSourceUrls.forEach((e,r)=>{let i=t[r+1];if(i.numVertices!==n.info.numVertices)throw new Error(`Vertex attribute source ${JSON.stringify(e)} specifies attributes for `+`${i.numVertices} vertices, but mesh has ${n.info.numVertices} vertices.`);s(i.attributeInfo,i.attributes,e)}),r})}let I=class extends(Object(r.WithParameters)(r.ChunkSource,o)){getChunk(){let t=this.chunks.get("");return void 0===t&&((t=this.getNewChunk_(d)).initialize(""),this.addChunk(t)),t}download(t,e){return v(this.chunkManager,this.parameters,()=>({priorityTier:t.priorityTier,priority:t.priority}),e).then(e=>{if(Object(u.e)(e.info)!==Object(u.e)(this.parameters.info))throw new Error("Mesh info has changed.");void 0===e.vertexNormals&&(e.vertexNormals=Object(s.f)(e.vertexPositions,e.indices)),t.data=e})}};I=l([Object(h.g)()],I);const k=Object(c.c)(Object(r.withChunkManager)(h.c));let S=class extends k{constructor(t,e){super(t,e),this.source=this.registerDisposer(t.getRef(e.source)),this.registerDisposer(this.chunkManager.recomputeChunkPriorities.add(()=>{this.updateChunkPriorities()}))}updateChunkPriorities(){const t=this.visibility.value;if(t===Number.NEGATIVE_INFINITY)return;const e=Object(c.b)(t),n=Object(c.a)(t),{source:r,chunkManager:i}=this,s=r.getChunk();i.requestChunk(s,e,n+50)}};S=l([Object(h.g)("single_mesh/SingleMeshLayer")],S);Object(h.e)("single_mesh/getSingleMeshInfo",function(t,e){let n=this.getRef(t.chunkManager);try{return v(n,t.parameters,()=>({priorityTier:i.f.VISIBLE,priority:1e3}),e).then(t=>({value:t.info}))}finally{n.dispose()}})},function(t,e,n){"use strict";var r=r||{};r.Utils=r.Utils||{},r.Utils.crcTable=null,r.Utils.GUNZIP_MAGIC_COOKIE1=31,r.Utils.GUNZIP_MAGIC_COOKIE2=139,r.Utils.getStringAt=function(t,e,n){var r,i,s="";for(r=e;r<n;r+=1)0!==(i=t.getUint8(r))&&(s+=String.fromCharCode(i));return s},r.Utils.getByteAt=function(t,e){return t.getInt8(e)},r.Utils.getShortAt=function(t,e,n){return t.getInt16(e,n)},r.Utils.getIntAt=function(t,e,n){return t.getInt32(e,n)},r.Utils.getFloatAt=function(t,e,n){return t.getFloat32(e,n)},r.Utils.getDoubleAt=function(t,e,n){return t.getFloat64(e,n)},r.Utils.getLongAt=function(t,e,n){var i,s=[],a=0;for(i=0;i<8;i+=1)s[i]=r.Utils.getByteAt(t,e+i,n);for(i=s.length-1;i>=0;i--)a=256*a+s[i];return a},r.Utils.toArrayBuffer=function(t){var e,n,r;for(e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r+=1)n[r]=t[r];return e},r.Utils.isString=function(t){return"string"==typeof t||t instanceof String},r.Utils.formatNumber=function(t,e){var n=0;return n=r.Utils.isString(t)?Number(t):t,n=e?n.toPrecision(5):n.toPrecision(7),parseFloat(n)},r.Utils.makeCRCTable=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e},r.Utils.crc32=function(t){for(var e=r.Utils.crcTable||(r.Utils.crcTable=r.Utils.makeCRCTable()),n=-1,i=0;i<t.byteLength;i++)n=n>>>8^e[255&(n^t.getUint8(i))];return(-1^n)>>>0},"undefined"!==typeof t&&t.exports&&(t.exports=r.Utils)},function(t,e,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e,n){"use strict";n.r(e);var r=n(20),i=n(0),s=n(1);n.d(e,"PerspectiveViewState",function(){return a}),n.d(e,"PerspectiveViewRenderLayer",function(){return o});let a=class extends s.c{constructor(...t){super(...t),this.viewport=new r.b({width:0,height:0,projectionMat:i.i.create(),viewMat:i.i.create(),viewProjectionMat:i.i.create()});const e=t[0],n=t[1];this.visibility=e.get(n.visibility)}};a=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(s.g)("perspective_view/PerspectiveView")],a);class o extends s.c{constructor(){super(...arguments),this.viewStates=new r.a}}Object(s.f)("perspective_view/updateViewport",function(t){this.get(t.view).viewport.value=t.viewport}),Object(s.f)("perspective_view/addLayer",function(t){const e=this.get(t.view);this.get(t.layer).viewStates.add(e)}),Object(s.f)("perspective_view/removeLayer",function(t){const e=this.get(t.view);this.get(t.layer).viewStates.delete(e)})},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){var r=n(64),i="object"==typeof self&&self&&self.Object===Object&&self,s=r||i||Function("return this")();t.exports=s},function(t,e,n){var r=n(48).Symbol;t.exports=r},function(t,e,n){"use strict";var r=r||{};r.Utils=r.Utils||n(44),r.NIFTI1=r.NIFTI1||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.isHDR=!1,this.extensionFlag=[0,0,0,0],this.extensionSize=0,this.extensionCode=0},r.NIFTI1.TYPE_NONE=0,r.NIFTI1.TYPE_BINARY=1,r.NIFTI1.TYPE_UINT8=2,r.NIFTI1.TYPE_INT16=4,r.NIFTI1.TYPE_INT32=8,r.NIFTI1.TYPE_FLOAT32=16,r.NIFTI1.TYPE_COMPLEX64=32,r.NIFTI1.TYPE_FLOAT64=64,r.NIFTI1.TYPE_RGB24=128,r.NIFTI1.TYPE_INT8=256,r.NIFTI1.TYPE_UINT16=512,r.NIFTI1.TYPE_UINT32=768,r.NIFTI1.TYPE_INT64=1024,r.NIFTI1.TYPE_UINT64=1280,r.NIFTI1.TYPE_FLOAT128=1536,r.NIFTI1.TYPE_COMPLEX128=1792,r.NIFTI1.TYPE_COMPLEX256=2048,r.NIFTI1.XFORM_UNKNOWN=0,r.NIFTI1.XFORM_SCANNER_ANAT=1,r.NIFTI1.XFORM_ALIGNED_ANAT=2,r.NIFTI1.XFORM_TALAIRACH=3,r.NIFTI1.XFORM_MNI_152=4,r.NIFTI1.SPATIAL_UNITS_MASK=7,r.NIFTI1.TEMPORAL_UNITS_MASK=56,r.NIFTI1.UNITS_UNKNOWN=0,r.NIFTI1.UNITS_METER=1,r.NIFTI1.UNITS_MM=2,r.NIFTI1.UNITS_MICRON=3,r.NIFTI1.UNITS_SEC=8,r.NIFTI1.UNITS_MSEC=16,r.NIFTI1.UNITS_USEC=24,r.NIFTI1.UNITS_HZ=32,r.NIFTI1.UNITS_PPM=40,r.NIFTI1.UNITS_RADS=48,r.NIFTI1.MAGIC_COOKIE=348,r.NIFTI1.STANDARD_HEADER_SIZE=348,r.NIFTI1.MAGIC_NUMBER_LOCATION=344,r.NIFTI1.MAGIC_NUMBER=[110,43,49],r.NIFTI1.MAGIC_NUMBER2=[110,105,49],r.NIFTI1.EXTENSION_HEADER_SIZE=8,r.NIFTI1.prototype.readHeader=function(t){var e,n,i,s,a=new DataView(t),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI1.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI1.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.dim_info=r.Utils.getByteAt(a,39),e=0;e<8;e+=1)s=40+2*e,this.dims[e]=r.Utils.getShortAt(a,s,this.littleEndian);for(this.intent_p1=r.Utils.getFloatAt(a,56,this.littleEndian),this.intent_p2=r.Utils.getFloatAt(a,60,this.littleEndian),this.intent_p3=r.Utils.getFloatAt(a,64,this.littleEndian),this.intent_code=r.Utils.getShortAt(a,68,this.littleEndian),this.datatypeCode=r.Utils.getShortAt(a,70,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,72,this.littleEndian),this.slice_start=r.Utils.getShortAt(a,74,this.littleEndian),e=0;e<8;e+=1)s=76+4*e,this.pixDims[e]=r.Utils.getFloatAt(a,s,this.littleEndian);for(this.vox_offset=r.Utils.getFloatAt(a,108,this.littleEndian),this.scl_slope=r.Utils.getFloatAt(a,112,this.littleEndian),this.scl_inter=r.Utils.getFloatAt(a,116,this.littleEndian),this.slice_end=r.Utils.getShortAt(a,120,this.littleEndian),this.slice_code=r.Utils.getByteAt(a,122),this.xyzt_units=r.Utils.getByteAt(a,123),this.cal_max=r.Utils.getFloatAt(a,124,this.littleEndian),this.cal_min=r.Utils.getFloatAt(a,128,this.littleEndian),this.slice_duration=r.Utils.getFloatAt(a,132,this.littleEndian),this.toffset=r.Utils.getFloatAt(a,136,this.littleEndian),this.description=r.Utils.getStringAt(a,148,228),this.aux_file=r.Utils.getStringAt(a,228,252),this.qform_code=r.Utils.getShortAt(a,252,this.littleEndian),this.sform_code=r.Utils.getShortAt(a,254,this.littleEndian),this.quatern_b=r.Utils.getFloatAt(a,256,this.littleEndian),this.quatern_c=r.Utils.getFloatAt(a,260,this.littleEndian),this.quatern_d=r.Utils.getFloatAt(a,264,this.littleEndian),this.qoffset_x=r.Utils.getFloatAt(a,268,this.littleEndian),this.qoffset_y=r.Utils.getFloatAt(a,272,this.littleEndian),this.qoffset_z=r.Utils.getFloatAt(a,276,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)s=280+4*(4*n+i),this.affine[n][i]=r.Utils.getFloatAt(a,s,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.intent_name=r.Utils.getStringAt(a,328,344),this.magic=r.Utils.getStringAt(a,344,348),this.isHDR=this.magic===r.NIFTI1.MAGIC_NUMBER2,a.byteLength>r.NIFTI1.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,348),this.extensionFlag[1]=r.Utils.getByteAt(a,349),this.extensionFlag[2]=r.Utils.getByteAt(a,350),this.extensionFlag[3]=r.Utils.getByteAt(a,351),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI1.prototype.toFormattedString=function(){var t=r.Utils.formatNumber,e="";return e+="Dim Info = "+this.dim_info+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Intent Code = "+this.intent_code+"\n",e+="Datatype = "+this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel = "+this.numBitsPerVoxel+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Slice End = "+this.slice_end+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+='Intent Name: "'+this.intent_name+'"\n',this.extensionFlag[0]&&(e+="Extension: Size = "+this.extensionSize+"  Code = "+this.extensionCode+"\n"),e},r.NIFTI1.prototype.getDatatypeCodeString=function(t){return t===r.NIFTI1.TYPE_UINT8?"1-Byte Unsigned Integer":t===r.NIFTI1.TYPE_INT16?"2-Byte Signed Integer":t===r.NIFTI1.TYPE_INT32?"4-Byte Signed Integer":t===r.NIFTI1.TYPE_FLOAT32?"4-Byte Float":t===r.NIFTI1.TYPE_FLOAT64?"8-Byte Float":t===r.NIFTI1.TYPE_RGB24?"RGB":t===r.NIFTI1.TYPE_INT8?"1-Byte Signed Integer":t===r.NIFTI1.TYPE_UINT16?"2-Byte Unsigned Integer":t===r.NIFTI1.TYPE_UINT32?"4-Byte Unsigned Integer":t===r.NIFTI1.TYPE_INT64?"8-Byte Signed Integer":t===r.NIFTI1.TYPE_UINT64?"8-Byte Unsigned Integer":"Unknown"},r.NIFTI1.prototype.getTransformCodeString=function(t){return t===r.NIFTI1.XFORM_SCANNER_ANAT?"Scanner":t===r.NIFTI1.XFORM_ALIGNED_ANAT?"Aligned":t===r.NIFTI1.XFORM_TALAIRACH?"Talairach":t===r.NIFTI1.XFORM_MNI_152?"MNI":"Unknown"},r.NIFTI1.prototype.getUnitsCodeString=function(t){return t===r.NIFTI1.UNITS_METER?"Meters":t===r.NIFTI1.UNITS_MM?"Millimeters":t===r.NIFTI1.UNITS_MICRON?"Microns":t===r.NIFTI1.UNITS_SEC?"Seconds":t===r.NIFTI1.UNITS_MSEC?"Milliseconds":t===r.NIFTI1.UNITS_USEC?"Microseconds":t===r.NIFTI1.UNITS_HZ?"Hz":t===r.NIFTI1.UNITS_PPM?"PPM":t===r.NIFTI1.UNITS_RADS?"Rads":"Unknown"},r.NIFTI1.prototype.getQformMat=function(){return this.convertNiftiQFormToNiftiSForm(this.quatern_b,this.quatern_c,this.quatern_d,this.qoffset_x,this.qoffset_y,this.qoffset_z,this.pixDims[1],this.pixDims[2],this.pixDims[3],this.pixDims[0])},r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm=function(t,e,n,r,i,s,a,o,u,c){var h,l,d,f,p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],g=t,m=e,b=n;return p[3][0]=p[3][1]=p[3][2]=0,p[3][3]=1,(h=1-(g*g+m*m+b*b))<1e-7?(g*=h=1/Math.sqrt(g*g+m*m+b*b),m*=h,b*=h,h=0):h=Math.sqrt(h),l=a>0?a:1,d=o>0?o:1,f=u>0?u:1,c<0&&(f=-f),p[0][0]=(h*h+g*g-m*m-b*b)*l,p[0][1]=2*(g*m-h*b)*d,p[0][2]=2*(g*b+h*m)*f,p[1][0]=2*(g*m+h*b)*l,p[1][1]=(h*h+m*m-g*g-b*b)*d,p[1][2]=2*(m*b-h*g)*f,p[2][0]=2*(g*b-h*m)*l,p[2][1]=2*(m*b+h*g)*d,p[2][2]=(h*h+b*b-m*m-g*g)*f,p[0][3]=r,p[1][3]=i,p[2][3]=s,p},r.NIFTI1.prototype.convertNiftiSFormToNEMA=function(t){var e,n,r,i,s,a,o,u,c,h,l,d,f,p,g,m,b,y,_,w,v,I,k,S,T,M,E,O,x,C,N,A,j;if(p=0,M=[[0,0,0],[0,0,0],[0,0,0]],E=[[0,0,0],[0,0,0],[0,0,0]],e=t[0][0],n=t[0][1],r=t[0][2],i=t[1][0],s=t[1][1],a=t[1][2],o=t[2][0],u=t[2][1],c=t[2][2],0===(h=Math.sqrt(e*e+i*i+o*o)))return null;if(e/=h,i/=h,o/=h,0===(h=Math.sqrt(n*n+s*s+u*u)))return null;if(h=e*(n/=h)+i*(s/=h)+o*(u/=h),Math.abs(h)>1e-4){if(n-=h*e,s-=h*i,u-=h*o,0===(h=Math.sqrt(n*n+s*s+u*u)))return null;n/=h,s/=h,u/=h}if(0===(h=Math.sqrt(r*r+a*a+c*c))?(r=i*u-o*s,a=o*n-u*e,c=e*s-i*n):(r/=h,a/=h,c/=h),h=e*r+i*a+o*c,Math.abs(h)>1e-4){if(r-=h*e,a-=h*i,c-=h*o,0===(h=Math.sqrt(r*r+a*a+c*c)))return null;r/=h,a/=h,c/=h}if(h=n*r+s*a+u*c,Math.abs(h)>1e-4){if(r-=h*n,a-=h*s,c-=h*u,0===(h=Math.sqrt(r*r+a*a+c*c)))return null;r/=h,a/=h,c/=h}if(M[0][0]=e,M[0][1]=n,M[0][2]=r,M[1][0]=i,M[1][1]=s,M[1][2]=a,M[2][0]=o,M[2][1]=u,M[2][2]=c,0===(l=this.nifti_mat33_determ(M)))return null;for(T=-666,y=v=I=k=1,_=2,w=3,d=1;d<=3;d+=1)for(f=1;f<=3;f+=1)if(d!==f)for(p=1;p<=3;p+=1)if(d!==p&&f!==p)for(E[0][0]=E[0][1]=E[0][2]=E[1][0]=E[1][1]=E[1][2]=E[2][0]=E[2][1]=E[2][2]=0,g=-1;g<=1;g+=2)for(m=-1;m<=1;m+=2)for(b=-1;b<=1;b+=2)E[0][d-1]=g,E[1][f-1]=m,E[2][p-1]=b,this.nifti_mat33_determ(E)*l>0&&(h=(S=this.nifti_mat33_mul(E,M))[0][0]+S[1][1]+S[2][2])>T&&(T=h,y=d,_=f,w=p,v=g,I=m,k=b);switch(O=x=C=N=A=j=0,y*v){case 1:O="X",N="+";break;case-1:O="X",N="-";break;case 2:O="Y",N="+";break;case-2:O="Y",N="-";break;case 3:O="Z",N="+";break;case-3:O="Z",N="-"}switch(_*I){case 1:x="X",A="+";break;case-1:x="X",A="-";break;case 2:x="Y",A="+";break;case-2:x="Y",A="-";break;case 3:x="Z",A="+";break;case-3:x="Z",A="-"}switch(w*k){case 1:C="X",j="+";break;case-1:C="X",j="-";break;case 2:C="Y",j="+";break;case-2:C="Y",j="-";break;case 3:C="Z",j="+";break;case-3:C="Z",j="-"}return O+x+C+N+A+j},r.NIFTI1.prototype.nifti_mat33_mul=function(t,e){var n,r,i=[[0,0,0],[0,0,0],[0,0,0]];for(n=0;n<3;n+=1)for(r=0;r<3;r+=1)i[n][r]=t[n][0]*e[0][r]+t[n][1]*e[1][r]+t[n][2]*e[2][r];return i},r.NIFTI1.prototype.nifti_mat33_determ=function(t){var e,n,r,i,s,a,o,u,c;return e=t[0][0],n=t[0][1],r=t[0][2],i=t[1][0],s=t[1][1],a=t[1][2],o=t[2][0],u=t[2][1],e*s*(c=t[2][2])-e*u*a-i*n*c+i*u*r+o*n*a-o*s*r},r.NIFTI1.prototype.getExtensionLocation=function(){return r.NIFTI1.MAGIC_COOKIE+4},r.NIFTI1.prototype.getExtensionSize=function(t){return r.Utils.getIntAt(t,this.getExtensionLocation(),this.littleEndian)},r.NIFTI1.prototype.getExtensionCode=function(t){return r.Utils.getIntAt(t,this.getExtensionLocation()+4,this.littleEndian)},"undefined"!==typeof t&&t.exports&&(t.exports=r.NIFTI1)},function(t,e,n){"use strict";t.exports=function(t,e,n,r){for(var i=65535&t|0,s=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{s=s+(i=i+e[r++]|0)|0}while(--a);i%=65521,s%=65521}return i|s<<16|0}},function(t,e,n){"use strict";var r=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();t.exports=function(t,e,n,i){var s=r,a=i+n;t^=-1;for(var o=i;o<a;o++)t=t>>>8^s[255&(t^e[o])];return-1^t}},function(t,e,n){"use strict";var r=n(30),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var a=new r.Buf8(256),o=0;o<256;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function u(t,e){if(e<65534&&(t.subarray&&s||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,e.string2buf=function(t){var e,n,i,s,a,o=t.length,u=0;for(s=0;s<o;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),u+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(u),a=0,s=0;a<u;s++)55296==(64512&(n=t.charCodeAt(s)))&&s+1<o&&56320==(64512&(i=t.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(i-56320),s++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},e.buf2binstring=function(t){return u(t,t.length)},e.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},e.buf2string=function(t,e){var n,r,i,s,o=e||t.length,c=new Array(2*o);for(r=0,n=0;n<o;)if((i=t[n++])<128)c[r++]=i;else if((s=a[i])>4)c[r++]=65533,n+=s-1;else{for(i&=2===s?31:3===s?15:7;s>1&&n<o;)i=i<<6|63&t[n++],s--;s>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return u(c,r)},e.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+a[t[n]]>e?n:e}},function(t,e,n){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,n){var r=n(47),i=n(63),s=n(66),a="Expected a function",o=Math.max,u=Math.min;t.exports=function(t,e,n){var c,h,l,d,f,p,g=0,m=!1,b=!1,y=!0;if("function"!=typeof t)throw new TypeError(a);function _(e){var n=c,r=h;return c=h=void 0,g=e,d=t.apply(r,n)}function w(t){var n=t-p;return void 0===p||n>=e||n<0||b&&t-g>=l}function v(){var t=i();if(w(t))return I(t);f=setTimeout(v,function(t){var n=e-(t-p);return b?u(n,l-(t-g)):n}(t))}function I(t){return f=void 0,y&&c?_(t):(c=h=void 0,d)}function k(){var t=i(),n=w(t);if(c=arguments,h=this,p=t,n){if(void 0===f)return function(t){return g=t,f=setTimeout(v,e),m?_(t):d}(p);if(b)return f=setTimeout(v,e),_(p)}return void 0===f&&(f=setTimeout(v,e)),d}return e=s(e)||0,r(n)&&(m=!!n.leading,l=(b="maxWait"in n)?o(s(n.maxWait)||0,e):l,y="trailing"in n?!!n.trailing:y),k.cancel=function(){void 0!==f&&clearTimeout(f),g=0,c=p=h=f=void 0},k.flush=function(){return void 0===f?d:I(i())},k}},,,,,function(t,e,n){n(62),n(5),n(26),n(46),n(42),n(85),n(82),n(86),n(83),n(84),n(87),n(88),n(34),n(89),n(90),n(91),t.exports=n(92)},function(t,e,n){"use strict";n.r(e),n.d(e,"rpc",function(){return r});var r=new(n(1).a)(self);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */self.rpc=r},function(t,e,n){var r=n(48);t.exports=function(){return r.Date.now()}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(65))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(47),i=n(67),s=NaN,a=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(i(t))return s;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=u.test(t);return n||c.test(t)?h(t.slice(2),n?2:8):o.test(t)?s:+t}},function(t,e,n){var r=n(68),i=n(71),s="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||i(t)&&r(t)==s}},function(t,e,n){var r=n(49),i=n(69),s=n(70),a="[object Null]",o="[object Undefined]",u=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?o:a:u&&u in Object(t)?i(t):s(t)}},function(t,e,n){var r=n(49),i=Object.prototype,s=i.hasOwnProperty,a=i.toString,o=r?r.toStringTag:void 0;t.exports=function(t){var e=s.call(t,o),n=t[o];try{t[o]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[o]=n:delete t[o]),i}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){"use strict";var r=r||{};r.Utils=r.Utils||n(44),r.NIFTI1=r.NIFTI1||n(50),r.NIFTI2=r.NIFTI2||function(){this.littleEndian=!1,this.dim_info=0,this.dims=[],this.intent_p1=0,this.intent_p2=0,this.intent_p3=0,this.intent_code=0,this.datatypeCode=0,this.numBitsPerVoxel=0,this.slice_start=0,this.slice_end=0,this.slice_code=0,this.pixDims=[],this.vox_offset=0,this.scl_slope=1,this.scl_inter=0,this.xyzt_units=0,this.cal_max=0,this.cal_min=0,this.slice_duration=0,this.toffset=0,this.description="",this.aux_file="",this.intent_name="",this.qform_code=0,this.sform_code=0,this.quatern_b=0,this.quatern_c=0,this.quatern_d=0,this.qoffset_x=0,this.qoffset_y=0,this.qoffset_z=0,this.affine=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.magic=0,this.extensionFlag=[0,0,0,0]},r.NIFTI2.MAGIC_COOKIE=540,r.NIFTI2.MAGIC_NUMBER_LOCATION=4,r.NIFTI2.MAGIC_NUMBER=[110,43,50,0,13,10,26,10],r.NIFTI2.prototype.readHeader=function(t){var e,n,i,s,a=new DataView(t),o=r.Utils.getIntAt(a,0,this.littleEndian);if(o!==r.NIFTI2.MAGIC_COOKIE&&(this.littleEndian=!0,o=r.Utils.getIntAt(a,0,this.littleEndian)),o!==r.NIFTI2.MAGIC_COOKIE)throw new Error("This does not appear to be a NIFTI file!");for(this.datatypeCode=r.Utils.getShortAt(a,12,this.littleEndian),this.numBitsPerVoxel=r.Utils.getShortAt(a,14,this.littleEndian),e=0;e<8;e+=1)s=16+8*e,this.dims[e]=r.Utils.getLongAt(a,s,this.littleEndian);for(this.intent_p1=r.Utils.getDoubleAt(a,80,this.littleEndian),this.intent_p2=r.Utils.getDoubleAt(a,88,this.littleEndian),this.intent_p3=r.Utils.getDoubleAt(a,96,this.littleEndian),e=0;e<8;e+=1)s=104+8*e,this.pixDims[e]=r.Utils.getDoubleAt(a,s,this.littleEndian);for(this.vox_offset=r.Utils.getLongAt(a,168,this.littleEndian),this.scl_slope=r.Utils.getDoubleAt(a,176,this.littleEndian),this.scl_inter=r.Utils.getDoubleAt(a,184,this.littleEndian),this.cal_max=r.Utils.getDoubleAt(a,192,this.littleEndian),this.cal_min=r.Utils.getDoubleAt(a,200,this.littleEndian),this.slice_duration=r.Utils.getDoubleAt(a,208,this.littleEndian),this.toffset=r.Utils.getDoubleAt(a,216,this.littleEndian),this.slice_start=r.Utils.getLongAt(a,224,this.littleEndian),this.slice_end=r.Utils.getLongAt(a,232,this.littleEndian),this.description=r.Utils.getStringAt(a,240,320),this.aux_file=r.Utils.getStringAt(a,320,344),this.qform_code=r.Utils.getIntAt(a,344,this.littleEndian),this.sform_code=r.Utils.getIntAt(a,348,this.littleEndian),this.quatern_b=r.Utils.getDoubleAt(a,352,this.littleEndian),this.quatern_c=r.Utils.getDoubleAt(a,360,this.littleEndian),this.quatern_d=r.Utils.getDoubleAt(a,368,this.littleEndian),this.qoffset_x=r.Utils.getDoubleAt(a,376,this.littleEndian),this.qoffset_y=r.Utils.getDoubleAt(a,384,this.littleEndian),this.qoffset_z=r.Utils.getDoubleAt(a,392,this.littleEndian),n=0;n<3;n+=1)for(i=0;i<4;i+=1)s=400+8*(4*n+i),this.affine[n][i]=r.Utils.getDoubleAt(a,s,this.littleEndian);this.affine[3][0]=0,this.affine[3][1]=0,this.affine[3][2]=0,this.affine[3][3]=1,this.slice_code=r.Utils.getIntAt(a,496,this.littleEndian),this.xyzt_units=r.Utils.getIntAt(a,500,this.littleEndian),this.intent_code=r.Utils.getIntAt(a,504,this.littleEndian),this.intent_name=r.Utils.getStringAt(a,508,524),this.dim_info=r.Utils.getByteAt(a,524),a.byteLength>r.NIFTI2.MAGIC_COOKIE&&(this.extensionFlag[0]=r.Utils.getByteAt(a,540),this.extensionFlag[1]=r.Utils.getByteAt(a,541),this.extensionFlag[2]=r.Utils.getByteAt(a,542),this.extensionFlag[3]=r.Utils.getByteAt(a,543),this.extensionFlag[0]&&(this.extensionSize=this.getExtensionSize(a),this.extensionCode=this.getExtensionCode(a)))},r.NIFTI2.prototype.toFormattedString=function(){var t=r.Utils.formatNumber,e="";return e+="Datatype = "+ +this.datatypeCode+" ("+this.getDatatypeCodeString(this.datatypeCode)+")\n",e+="Bits Per Voxel =  = "+this.numBitsPerVoxel+"\n",e+="Image Dimensions (1-8): "+this.dims[0]+", "+this.dims[1]+", "+this.dims[2]+", "+this.dims[3]+", "+this.dims[4]+", "+this.dims[5]+", "+this.dims[6]+", "+this.dims[7]+"\n",e+="Intent Parameters (1-3): "+this.intent_p1+", "+this.intent_p2+", "+this.intent_p3+"\n",e+="Voxel Dimensions (1-8): "+t(this.pixDims[0])+", "+t(this.pixDims[1])+", "+t(this.pixDims[2])+", "+t(this.pixDims[3])+", "+t(this.pixDims[4])+", "+t(this.pixDims[5])+", "+t(this.pixDims[6])+", "+t(this.pixDims[7])+"\n",e+="Image Offset = "+this.vox_offset+"\n",e+="Data Scale:  Slope = "+t(this.scl_slope)+"  Intercept = "+t(this.scl_inter)+"\n",e+="Display Range:  Max = "+t(this.cal_max)+"  Min = "+t(this.cal_min)+"\n",e+="Slice Duration = "+this.slice_duration+"\n",e+="Time Axis Shift = "+this.toffset+"\n",e+="Slice Start = "+this.slice_start+"\n",e+="Slice End = "+this.slice_end+"\n",e+='Description: "'+this.description+'"\n',e+='Auxiliary File: "'+this.aux_file+'"\n',e+="Q-Form Code = "+this.qform_code+" ("+this.getTransformCodeString(this.qform_code)+")\n",e+="S-Form Code = "+this.sform_code+" ("+this.getTransformCodeString(this.sform_code)+")\n",e+="Quaternion Parameters:  b = "+t(this.quatern_b)+"  c = "+t(this.quatern_c)+"  d = "+t(this.quatern_d)+"\n",e+="Quaternion Offsets:  x = "+this.qoffset_x+"  y = "+this.qoffset_y+"  z = "+this.qoffset_z+"\n",e+="S-Form Parameters X: "+t(this.affine[0][0])+", "+t(this.affine[0][1])+", "+t(this.affine[0][2])+", "+t(this.affine[0][3])+"\n",e+="S-Form Parameters Y: "+t(this.affine[1][0])+", "+t(this.affine[1][1])+", "+t(this.affine[1][2])+", "+t(this.affine[1][3])+"\n",e+="S-Form Parameters Z: "+t(this.affine[2][0])+", "+t(this.affine[2][1])+", "+t(this.affine[2][2])+", "+t(this.affine[2][3])+"\n",e+="Slice Code = "+this.slice_code+"\n",e+="Units Code = "+this.xyzt_units+" ("+this.getUnitsCodeString(r.NIFTI1.SPATIAL_UNITS_MASK&this.xyzt_units)+", "+this.getUnitsCodeString(r.NIFTI1.TEMPORAL_UNITS_MASK&this.xyzt_units)+")\n",e+="Intent Code = "+this.intent_code+"\n",e+='Intent Name: "'+this.intent_name+'"\n',e+="Dim Info = "+this.dim_info+"\n"},r.NIFTI2.prototype.getExtensionLocation=function(){return r.NIFTI2.MAGIC_COOKIE+4},r.NIFTI2.prototype.getExtensionSize=r.NIFTI1.prototype.getExtensionSize,r.NIFTI2.prototype.getExtensionCode=r.NIFTI1.prototype.getExtensionCode,r.NIFTI2.prototype.getDatatypeCodeString=r.NIFTI1.prototype.getDatatypeCodeString,r.NIFTI2.prototype.getTransformCodeString=r.NIFTI1.prototype.getTransformCodeString,r.NIFTI2.prototype.getUnitsCodeString=r.NIFTI1.prototype.getUnitsCodeString,r.NIFTI2.prototype.getQformMat=r.NIFTI1.prototype.getQformMat,r.NIFTI2.prototype.convertNiftiQFormToNiftiSForm=r.NIFTI1.prototype.convertNiftiQFormToNiftiSForm,r.NIFTI2.prototype.convertNiftiSFormToNEMA=r.NIFTI1.prototype.convertNiftiSFormToNEMA,r.NIFTI2.prototype.nifti_mat33_mul=r.NIFTI1.prototype.nifti_mat33_mul,r.NIFTI2.prototype.nifti_mat33_determ=r.NIFTI1.prototype.nifti_mat33_determ,"undefined"!==typeof t&&t.exports&&(t.exports=r.NIFTI2)},function(t,e,n){"use strict";var r={};(0,n(30).assign)(r,n(74),n(77),n(55)),t.exports=r},function(t,e,n){"use strict";var r=n(75),i=n(30),s=n(53),a=n(45),o=n(54),u=Object.prototype.toString,c=0,h=-1,l=0,d=8;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({level:h,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==c)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var p;if(p="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,p))!==c)throw new Error(a[n]);this._dict_set=!0}}function p(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}f.prototype.push=function(t,e){var n,a,o=this.strm,h=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=s.string2buf(t):"[object ArrayBuffer]"===u.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new i.Buf8(h),o.next_out=0,o.avail_out=h),1!==(n=r.deflate(o,a))&&n!==c)return this.onEnd(n),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(i.shrinkBuf(o.output,o.next_out))):this.onData(i.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c):2!==a||(this.onEnd(c),o.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=f,e.deflate=p,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},function(t,e,n){"use strict";var r,i=n(30),s=n(76),a=n(51),o=n(52),u=n(45),c=0,h=1,l=3,d=4,f=5,p=0,g=1,m=-2,b=-3,y=-5,_=-1,w=1,v=2,I=3,k=4,S=0,T=2,M=8,E=9,O=15,x=8,C=286,N=30,A=19,j=2*C+1,P=15,U=3,D=258,R=D+U+1,F=32,z=42,L=69,B=73,$=91,V=103,G=113,q=666,Y=1,Z=2,K=3,H=4,W=3;function J(t,e){return t.msg=u[e],e}function Q(t){return(t<<1)-(t>4?9:0)}function X(t){for(var e=t.length;--e>=0;)t[e]=0}function tt(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function et(t,e){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,tt(t.strm)}function nt(t,e){t.pending_buf[t.pending++]=e}function rt(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function it(t,e){var n,r,i=t.max_chain_length,s=t.strstart,a=t.prev_length,o=t.nice_match,u=t.strstart>t.w_size-R?t.strstart-(t.w_size-R):0,c=t.window,h=t.w_mask,l=t.prev,d=t.strstart+D,f=c[s+a-1],p=c[s+a];t.prev_length>=t.good_match&&(i>>=2),o>t.lookahead&&(o=t.lookahead);do{if(c[(n=e)+a]===p&&c[n+a-1]===f&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<d);if(r=D-(d-s),s=d-D,r>a){if(t.match_start=e,a=r,r>=o)break;f=c[s+a-1],p=c[s+a]}}}while((e=l[e&h])>u&&0!=--i);return a<=t.lookahead?a:t.lookahead}function st(t){var e,n,r,s,u,c,h,l,d,f,p=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=p+(p-R)){i.arraySet(t.window,t.window,p,p,0),t.match_start-=p,t.strstart-=p,t.block_start-=p,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=p?r-p:0}while(--n);e=n=p;do{r=t.prev[--e],t.prev[e]=r>=p?r-p:0}while(--n);s+=p}if(0===t.strm.avail_in)break;if(c=t.strm,h=t.window,l=t.strstart+t.lookahead,d=s,f=void 0,(f=c.avail_in)>d&&(f=d),n=0===f?0:(c.avail_in-=f,i.arraySet(h,c.input,c.next_in,f,l),1===c.state.wrap?c.adler=a(c.adler,h,f,l):2===c.state.wrap&&(c.adler=o(c.adler,h,f,l)),c.next_in+=f,c.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=U)for(u=t.strstart-t.insert,t.ins_h=t.window[u],t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+U-1])&t.hash_mask,t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++,t.insert--,!(t.lookahead+t.insert<U)););}while(t.lookahead<R&&0!==t.strm.avail_in)}function at(t,e){for(var n,r;;){if(t.lookahead<R){if(st(t),t.lookahead<R&&e===c)return Y;if(0===t.lookahead)break}if(n=0,t.lookahead>=U&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+U-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-R&&(t.match_length=it(t,n)),t.match_length>=U)if(r=s._tr_tally(t,t.strstart-t.match_start,t.match_length-U),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=U){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+U-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(et(t,!1),0===t.strm.avail_out))return Y}return t.insert=t.strstart<U-1?t.strstart:U-1,e===d?(et(t,!0),0===t.strm.avail_out?K:H):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Y:Z}function ot(t,e){for(var n,r,i;;){if(t.lookahead<R){if(st(t),t.lookahead<R&&e===c)return Y;if(0===t.lookahead)break}if(n=0,t.lookahead>=U&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+U-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=U-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-R&&(t.match_length=it(t,n),t.match_length<=5&&(t.strategy===w||t.match_length===U&&t.strstart-t.match_start>4096)&&(t.match_length=U-1)),t.prev_length>=U&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-U,r=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-U),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+U-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=U-1,t.strstart++,r&&(et(t,!1),0===t.strm.avail_out))return Y}else if(t.match_available){if((r=s._tr_tally(t,0,t.window[t.strstart-1]))&&et(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Y}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<U-1?t.strstart:U-1,e===d?(et(t,!0),0===t.strm.avail_out?K:H):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Y:Z}function ut(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*j),this.dyn_dtree=new i.Buf16(2*(2*N+1)),this.bl_tree=new i.Buf16(2*(2*A+1)),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(P+1),this.heap=new i.Buf16(2*C+1),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*C+1),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ht(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=T,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?z:G,t.adler=2===e.wrap?0:1,e.last_flush=c,s._tr_init(e),p):J(t,m)}function lt(t){var e,n=ht(t);return n===p&&((e=t.state).window_size=2*e.w_size,X(e.head),e.max_lazy_match=r[e.level].max_lazy,e.good_match=r[e.level].good_length,e.nice_match=r[e.level].nice_length,e.max_chain_length=r[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=U-1,e.match_available=0,e.ins_h=0),n}function dt(t,e,n,r,s,a){if(!t)return m;var o=1;if(e===_&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>E||n!==M||r<8||r>15||e<0||e>9||a<0||a>k)return J(t,m);8===r&&(r=9);var u=new ct;return t.state=u,u.strm=t,u.wrap=o,u.gzhead=null,u.w_bits=r,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+U-1)/U),u.window=new i.Buf8(2*u.w_size),u.head=new i.Buf16(u.hash_size),u.prev=new i.Buf16(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new i.Buf8(u.pending_buf_size),u.d_buf=1*u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=e,u.strategy=a,u.method=n,lt(t)}r=[new ut(0,0,0,0,function(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(st(t),0===t.lookahead&&e===c)return Y;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,et(t,!1),0===t.strm.avail_out))return Y;if(t.strstart-t.block_start>=t.w_size-R&&(et(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?K:H):(t.strstart>t.block_start&&(et(t,!1),t.strm.avail_out),Y)}),new ut(4,4,8,4,at),new ut(4,5,16,8,at),new ut(4,6,32,32,at),new ut(4,4,16,16,ot),new ut(8,16,32,32,ot),new ut(8,16,128,128,ot),new ut(8,32,128,256,ot),new ut(32,128,258,1024,ot),new ut(32,258,258,4096,ot)],e.deflateInit=function(t,e){return dt(t,e,M,O,x,S)},e.deflateInit2=dt,e.deflateReset=lt,e.deflateResetKeep=ht,e.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,p):m},e.deflate=function(t,e){var n,i,a,u;if(!t||!t.state||e>f||e<0)return t?J(t,m):m;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===q&&e!==d)return J(t,0===t.avail_out?y:m);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===z)if(2===i.wrap)t.adler=0,nt(i,31),nt(i,139),nt(i,8),i.gzhead?(nt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),nt(i,255&i.gzhead.time),nt(i,i.gzhead.time>>8&255),nt(i,i.gzhead.time>>16&255),nt(i,i.gzhead.time>>24&255),nt(i,9===i.level?2:i.strategy>=v||i.level<2?4:0),nt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(nt(i,255&i.gzhead.extra.length),nt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=o(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=L):(nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,0),nt(i,9===i.level?2:i.strategy>=v||i.level<2?4:0),nt(i,W),i.status=G);else{var b=M+(i.w_bits-8<<4)<<8;b|=(i.strategy>=v||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(b|=F),b+=31-b%31,i.status=G,rt(i,b),0!==i.strstart&&(rt(i,t.adler>>>16),rt(i,65535&t.adler)),t.adler=1}if(i.status===L)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending!==i.pending_buf_size));)nt(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=B)}else i.status=B;if(i.status===B)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,nt(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.gzindex=0,i.status=$)}else i.status=$;if(i.status===$)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),tt(t),a=i.pending,i.pending===i.pending_buf_size)){u=1;break}u=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,nt(i,u)}while(0!==u);i.gzhead.hcrc&&i.pending>a&&(t.adler=o(t.adler,i.pending_buf,i.pending-a,a)),0===u&&(i.status=V)}else i.status=V;if(i.status===V&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&tt(t),i.pending+2<=i.pending_buf_size&&(nt(i,255&t.adler),nt(i,t.adler>>8&255),t.adler=0,i.status=G)):i.status=G),0!==i.pending){if(tt(t),0===t.avail_out)return i.last_flush=-1,p}else if(0===t.avail_in&&Q(e)<=Q(n)&&e!==d)return J(t,y);if(i.status===q&&0!==t.avail_in)return J(t,y);if(0!==t.avail_in||0!==i.lookahead||e!==c&&i.status!==q){var _=i.strategy===v?function(t,e){for(var n;;){if(0===t.lookahead&&(st(t),0===t.lookahead)){if(e===c)return Y;break}if(t.match_length=0,n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(et(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?K:H):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Y:Z}(i,e):i.strategy===I?function(t,e){for(var n,r,i,a,o=t.window;;){if(t.lookahead<=D){if(st(t),t.lookahead<=D&&e===c)return Y;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=U&&t.strstart>0&&(r=o[i=t.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=t.strstart+D;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);t.match_length=D-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=U?(n=s._tr_tally(t,1,t.match_length-U),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(et(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===d?(et(t,!0),0===t.strm.avail_out?K:H):t.last_lit&&(et(t,!1),0===t.strm.avail_out)?Y:Z}(i,e):r[i.level].func(i,e);if(_!==K&&_!==H||(i.status=q),_===Y||_===K)return 0===t.avail_out&&(i.last_flush=-1),p;if(_===Z&&(e===h?s._tr_align(i):e!==f&&(s._tr_stored_block(i,0,0,!1),e===l&&(X(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),tt(t),0===t.avail_out))return i.last_flush=-1,p}return e!==d?p:i.wrap<=0?g:(2===i.wrap?(nt(i,255&t.adler),nt(i,t.adler>>8&255),nt(i,t.adler>>16&255),nt(i,t.adler>>24&255),nt(i,255&t.total_in),nt(i,t.total_in>>8&255),nt(i,t.total_in>>16&255),nt(i,t.total_in>>24&255)):(rt(i,t.adler>>>16),rt(i,65535&t.adler)),tt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?p:g)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==z&&e!==L&&e!==B&&e!==$&&e!==V&&e!==G&&e!==q?J(t,m):(t.state=null,e===G?J(t,b):p):m},e.deflateSetDictionary=function(t,e){var n,r,s,o,u,c,h,l,d=e.length;if(!t||!t.state)return m;if(2===(o=(n=t.state).wrap)||1===o&&n.status!==z||n.lookahead)return m;for(1===o&&(t.adler=a(t.adler,e,d,0)),n.wrap=0,d>=n.w_size&&(0===o&&(X(n.head),n.strstart=0,n.block_start=0,n.insert=0),l=new i.Buf8(n.w_size),i.arraySet(l,e,d-n.w_size,n.w_size,0),e=l,d=n.w_size),u=t.avail_in,c=t.next_in,h=t.input,t.avail_in=d,t.next_in=0,t.input=e,st(n);n.lookahead>=U;){r=n.strstart,s=n.lookahead-(U-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+U-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--s);n.strstart=r,n.lookahead=U-1,st(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=U-1,n.match_available=0,t.next_in=c,t.input=h,t.avail_in=u,n.wrap=o,p},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,n){"use strict";var r=n(30),i=4,s=0,a=1,o=2;function u(t){for(var e=t.length;--e>=0;)t[e]=0}var c=0,h=1,l=2,d=29,f=256,p=f+1+d,g=30,m=19,b=2*p+1,y=15,_=16,w=7,v=256,I=16,k=17,S=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=new Array(2*(p+2));u(x);var C=new Array(2*g);u(C);var N=new Array(512);u(N);var A=new Array(256);u(A);var j=new Array(d);u(j);var P,U,D,R=new Array(g);function F(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function L(t){return t<256?N[t]:N[256+(t>>>7)]}function B(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function $(t,e,n){t.bi_valid>_-n?(t.bi_buf|=e<<t.bi_valid&65535,B(t,t.bi_buf),t.bi_buf=e>>_-t.bi_valid,t.bi_valid+=n-_):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function V(t,e,n){$(t,n[2*e],n[2*e+1])}function G(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function q(t,e,n){var r,i,s=new Array(y+1),a=0;for(r=1;r<=y;r++)s[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var o=t[2*i+1];0!==o&&(t[2*i]=G(s[o]++,o))}}function Y(t){var e;for(e=0;e<p;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*v]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Z(t){t.bi_valid>8?B(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function K(t,e,n,r){var i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]}function H(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&K(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!K(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function W(t,e,n){var r,i,s,a,o=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],i=t.pending_buf[t.l_buf+o],o++,0===r?V(t,i,e):(V(t,(s=A[i])+f+1,e),0!==(a=T[s])&&$(t,i-=j[s],a),V(t,s=L(--r),n),0!==(a=M[s])&&$(t,r-=R[s],a))}while(o<t.last_lit);V(t,v,e)}function J(t,e){var n,r,i,s=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,u=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=b,n=0;n<u;n++)0!==s[2*n]?(t.heap[++t.heap_len]=c=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)s[2*(i=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[i]=0,t.opt_len--,o&&(t.static_len-=a[2*i+1]);for(e.max_code=c,n=t.heap_len>>1;n>=1;n--)H(t,s,n);i=u;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H(t,s,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,s[2*i]=s[2*n]+s[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,s[2*n+1]=s[2*r+1]=i,t.heap[1]=i++,H(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var n,r,i,s,a,o,u=e.dyn_tree,c=e.max_code,h=e.stat_desc.static_tree,l=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(s=0;s<=y;s++)t.bl_count[s]=0;for(u[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<b;n++)(s=u[2*u[2*(r=t.heap[n])+1]+1]+1)>p&&(s=p,g++),u[2*r+1]=s,r>c||(t.bl_count[s]++,a=0,r>=f&&(a=d[r-f]),o=u[2*r],t.opt_len+=o*(s+a),l&&(t.static_len+=o*(h[2*r+1]+a)));if(0!==g){do{for(s=p-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[p]--,g-=2}while(g>0);for(s=p;0!==s;s--)for(r=t.bl_count[s];0!==r;)(i=t.heap[--n])>c||(u[2*i+1]!==s&&(t.opt_len+=(s-u[2*i+1])*u[2*i],u[2*i+1]=s),r--)}}(t,e),q(s,c,t.bl_count)}function Q(t,e,n){var r,i,s=-1,a=e[1],o=0,u=7,c=4;for(0===a&&(u=138,c=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++o<u&&i===a||(o<c?t.bl_tree[2*i]+=o:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[2*I]++):o<=10?t.bl_tree[2*k]++:t.bl_tree[2*S]++,o=0,s=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))}function X(t,e,n){var r,i,s=-1,a=e[1],o=0,u=7,c=4;for(0===a&&(u=138,c=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++o<u&&i===a)){if(o<c)do{V(t,i,t.bl_tree)}while(0!=--o);else 0!==i?(i!==s&&(V(t,i,t.bl_tree),o--),V(t,I,t.bl_tree),$(t,o-3,2)):o<=10?(V(t,k,t.bl_tree),$(t,o-3,3)):(V(t,S,t.bl_tree),$(t,o-11,7));o=0,s=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}}u(R);var tt=!1;function et(t,e,n,i){$(t,(c<<1)+(i?1:0),3),function(t,e,n,i){Z(t),i&&(B(t,n),B(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}e._tr_init=function(t){tt||(function(){var t,e,n,r,i,s=new Array(y+1);for(n=0,r=0;r<d-1;r++)for(j[r]=n,t=0;t<1<<T[r];t++)A[n++]=r;for(A[n-1]=r,i=0,r=0;r<16;r++)for(R[r]=i,t=0;t<1<<M[r];t++)N[i++]=r;for(i>>=7;r<g;r++)for(R[r]=i<<7,t=0;t<1<<M[r]-7;t++)N[256+i++]=r;for(e=0;e<=y;e++)s[e]=0;for(t=0;t<=143;)x[2*t+1]=8,t++,s[8]++;for(;t<=255;)x[2*t+1]=9,t++,s[9]++;for(;t<=279;)x[2*t+1]=7,t++,s[7]++;for(;t<=287;)x[2*t+1]=8,t++,s[8]++;for(q(x,p+1,s),t=0;t<g;t++)C[2*t+1]=5,C[2*t]=G(t,5);P=new F(x,T,f+1,p,y),U=new F(C,M,0,g,y),D=new F(new Array(0),E,0,m,w)}(),tt=!0),t.l_desc=new z(t.dyn_ltree,P),t.d_desc=new z(t.dyn_dtree,U),t.bl_desc=new z(t.bl_tree,D),t.bi_buf=0,t.bi_valid=0,Y(t)},e._tr_stored_block=et,e._tr_flush_block=function(t,e,n,r){var u,c,d=0;t.level>0?(t.strm.data_type===o&&(t.strm.data_type=function(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return a;return s}(t)),J(t,t.l_desc),J(t,t.d_desc),d=function(t){var e;for(Q(t,t.dyn_ltree,t.l_desc.max_code),Q(t,t.dyn_dtree,t.d_desc.max_code),J(t,t.bl_desc),e=m-1;e>=3&&0===t.bl_tree[2*O[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),u=t.opt_len+3+7>>>3,(c=t.static_len+3+7>>>3)<=u&&(u=c)):u=c=n+5,n+4<=u&&-1!==e?et(t,e,n,r):t.strategy===i||c===u?($(t,(h<<1)+(r?1:0),3),W(t,x,C)):($(t,(l<<1)+(r?1:0),3),function(t,e,n,r){var i;for($(t,e-257,5),$(t,n-1,5),$(t,r-4,4),i=0;i<r;i++)$(t,t.bl_tree[2*O[i]+1],3);X(t,t.dyn_ltree,e-1),X(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,d+1),W(t,t.dyn_ltree,t.dyn_dtree)),Y(t),r&&Z(t)},e._tr_tally=function(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(A[n]+f+1)]++,t.dyn_dtree[2*L(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){$(t,h<<1,3),V(t,v,x),function(t){16===t.bi_valid?(B(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,n){"use strict";var r=n(78),i=n(30),s=n(53),a=n(55),o=n(45),u=n(54),c=n(81),h=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(o[n]);if(this.header=new c,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=s.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(o[n])}function d(t,e){var n=new l(e);if(n.push(t,!0),n.err)throw n.msg||o[n.err];return n.result}l.prototype.push=function(t,e){var n,o,u,c,l,d=this.strm,f=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===h.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(f),d.next_out=0,d.avail_out=f),(n=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(n=r.inflateSetDictionary(this.strm,p)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==a.Z_STREAM_END&&(0!==d.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=s.utf8border(d.output,d.next_out),c=d.next_out-u,l=s.buf2string(d.output,u),d.next_out=c,d.avail_out=f-c,c&&i.arraySet(d.output,d.output,u,c,0),this.onData(l)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((d.avail_in>0||0===d.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=l,e.inflate=d,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},e.ungzip=d},function(t,e,n){"use strict";var r=n(30),i=n(51),s=n(52),a=n(79),o=n(80),u=0,c=1,h=2,l=4,d=5,f=6,p=0,g=1,m=2,b=-2,y=-3,_=-4,w=-5,v=8,I=1,k=2,S=3,T=4,M=5,E=6,O=7,x=8,C=9,N=10,A=11,j=12,P=13,U=14,D=15,R=16,F=17,z=18,L=19,B=20,$=21,V=22,G=23,q=24,Y=25,Z=26,K=27,H=28,W=29,J=30,Q=31,X=32,tt=852,et=592,nt=15;function rt(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function it(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function st(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=I,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,p):b}function at(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,st(t)):b}function ot(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?b:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,at(t))):b}function ut(t,e){var n,r;return t?(r=new it,t.state=r,r.window=null,(n=ot(t,e))!==p&&(t.state=null),n):b}var ct,ht,lt=!0;function dt(t){if(lt){var e;for(ct=new r.Buf32(512),ht=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(c,t.lens,0,288,ct,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(h,t.lens,0,32,ht,0,t.work,{bits:5}),lt=!1}t.lencode=ct,t.lenbits=9,t.distcode=ht,t.distbits=5}function ft(t,e,n,i){var s,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>i&&(s=i),r.arraySet(a.window,e,n-i,s,a.wnext),(i-=s)?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}e.inflateReset=at,e.inflateReset2=ot,e.inflateResetKeep=st,e.inflateInit=function(t){return ut(t,nt)},e.inflateInit2=ut,e.inflate=function(t,e){var n,tt,et,nt,it,st,at,ot,ut,ct,ht,lt,pt,gt,mt,bt,yt,_t,wt,vt,It,kt,St,Tt,Mt=0,Et=new r.Buf8(4),Ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return b;(n=t.state).mode===j&&(n.mode=P),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,st=t.avail_in,ot=n.hold,ut=n.bits,ct=st,ht=at,kt=p;t:for(;;)switch(n.mode){case I:if(0===n.wrap){n.mode=P;break}for(;ut<16;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(2&n.wrap&&35615===ot){n.check=0,Et[0]=255&ot,Et[1]=ot>>>8&255,n.check=s(n.check,Et,2,0),ot=0,ut=0,n.mode=k;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ot)<<8)+(ot>>8))%31){t.msg="incorrect header check",n.mode=J;break}if((15&ot)!==v){t.msg="unknown compression method",n.mode=J;break}if(ut-=4,It=8+(15&(ot>>>=4)),0===n.wbits)n.wbits=It;else if(It>n.wbits){t.msg="invalid window size",n.mode=J;break}n.dmax=1<<It,t.adler=n.check=1,n.mode=512&ot?N:j,ot=0,ut=0;break;case k:for(;ut<16;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(n.flags=ot,(255&n.flags)!==v){t.msg="unknown compression method",n.mode=J;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=J;break}n.head&&(n.head.text=ot>>8&1),512&n.flags&&(Et[0]=255&ot,Et[1]=ot>>>8&255,n.check=s(n.check,Et,2,0)),ot=0,ut=0,n.mode=S;case S:for(;ut<32;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.head&&(n.head.time=ot),512&n.flags&&(Et[0]=255&ot,Et[1]=ot>>>8&255,Et[2]=ot>>>16&255,Et[3]=ot>>>24&255,n.check=s(n.check,Et,4,0)),ot=0,ut=0,n.mode=T;case T:for(;ut<16;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.head&&(n.head.xflags=255&ot,n.head.os=ot>>8),512&n.flags&&(Et[0]=255&ot,Et[1]=ot>>>8&255,n.check=s(n.check,Et,2,0)),ot=0,ut=0,n.mode=M;case M:if(1024&n.flags){for(;ut<16;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.length=ot,n.head&&(n.head.extra_len=ot),512&n.flags&&(Et[0]=255&ot,Et[1]=ot>>>8&255,n.check=s(n.check,Et,2,0)),ot=0,ut=0}else n.head&&(n.head.extra=null);n.mode=E;case E:if(1024&n.flags&&((lt=n.length)>st&&(lt=st),lt&&(n.head&&(It=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,lt,It)),512&n.flags&&(n.check=s(n.check,tt,lt,nt)),st-=lt,nt+=lt,n.length-=lt),n.length))break t;n.length=0,n.mode=O;case O:if(2048&n.flags){if(0===st)break t;lt=0;do{It=tt[nt+lt++],n.head&&It&&n.length<65536&&(n.head.name+=String.fromCharCode(It))}while(It&&lt<st);if(512&n.flags&&(n.check=s(n.check,tt,lt,nt)),st-=lt,nt+=lt,It)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=x;case x:if(4096&n.flags){if(0===st)break t;lt=0;do{It=tt[nt+lt++],n.head&&It&&n.length<65536&&(n.head.comment+=String.fromCharCode(It))}while(It&&lt<st);if(512&n.flags&&(n.check=s(n.check,tt,lt,nt)),st-=lt,nt+=lt,It)break t}else n.head&&(n.head.comment=null);n.mode=C;case C:if(512&n.flags){for(;ut<16;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(ot!==(65535&n.check)){t.msg="header crc mismatch",n.mode=J;break}ot=0,ut=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=j;break;case N:for(;ut<32;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}t.adler=n.check=rt(ot),ot=0,ut=0,n.mode=A;case A:if(0===n.havedict)return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=st,n.hold=ot,n.bits=ut,m;t.adler=n.check=1,n.mode=j;case j:if(e===d||e===f)break t;case P:if(n.last){ot>>>=7&ut,ut-=7&ut,n.mode=K;break}for(;ut<3;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}switch(n.last=1&ot,ut-=1,3&(ot>>>=1)){case 0:n.mode=U;break;case 1:if(dt(n),n.mode=B,e===f){ot>>>=2,ut-=2;break t}break;case 2:n.mode=F;break;case 3:t.msg="invalid block type",n.mode=J}ot>>>=2,ut-=2;break;case U:for(ot>>>=7&ut,ut-=7&ut;ut<32;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if((65535&ot)!=(ot>>>16^65535)){t.msg="invalid stored block lengths",n.mode=J;break}if(n.length=65535&ot,ot=0,ut=0,n.mode=D,e===f)break t;case D:n.mode=R;case R:if(lt=n.length){if(lt>st&&(lt=st),lt>at&&(lt=at),0===lt)break t;r.arraySet(et,tt,nt,lt,it),st-=lt,nt+=lt,at-=lt,it+=lt,n.length-=lt;break}n.mode=j;break;case F:for(;ut<14;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(n.nlen=257+(31&ot),ot>>>=5,ut-=5,n.ndist=1+(31&ot),ot>>>=5,ut-=5,n.ncode=4+(15&ot),ot>>>=4,ut-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=J;break}n.have=0,n.mode=z;case z:for(;n.have<n.ncode;){for(;ut<3;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.lens[Ot[n.have++]]=7&ot,ot>>>=3,ut-=3}for(;n.have<19;)n.lens[Ot[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,St={bits:n.lenbits},kt=o(u,n.lens,0,19,n.lencode,0,n.work,St),n.lenbits=St.bits,kt){t.msg="invalid code lengths set",n.mode=J;break}n.have=0,n.mode=L;case L:for(;n.have<n.nlen+n.ndist;){for(;bt=(Mt=n.lencode[ot&(1<<n.lenbits)-1])>>>16&255,yt=65535&Mt,!((mt=Mt>>>24)<=ut);){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(yt<16)ot>>>=mt,ut-=mt,n.lens[n.have++]=yt;else{if(16===yt){for(Tt=mt+2;ut<Tt;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(ot>>>=mt,ut-=mt,0===n.have){t.msg="invalid bit length repeat",n.mode=J;break}It=n.lens[n.have-1],lt=3+(3&ot),ot>>>=2,ut-=2}else if(17===yt){for(Tt=mt+3;ut<Tt;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}ut-=mt,It=0,lt=3+(7&(ot>>>=mt)),ot>>>=3,ut-=3}else{for(Tt=mt+7;ut<Tt;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}ut-=mt,It=0,lt=11+(127&(ot>>>=mt)),ot>>>=7,ut-=7}if(n.have+lt>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=J;break}for(;lt--;)n.lens[n.have++]=It}}if(n.mode===J)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=J;break}if(n.lenbits=9,St={bits:n.lenbits},kt=o(c,n.lens,0,n.nlen,n.lencode,0,n.work,St),n.lenbits=St.bits,kt){t.msg="invalid literal/lengths set",n.mode=J;break}if(n.distbits=6,n.distcode=n.distdyn,St={bits:n.distbits},kt=o(h,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,St),n.distbits=St.bits,kt){t.msg="invalid distances set",n.mode=J;break}if(n.mode=B,e===f)break t;case B:n.mode=$;case $:if(st>=6&&at>=258){t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=st,n.hold=ot,n.bits=ut,a(t,ht),it=t.next_out,et=t.output,at=t.avail_out,nt=t.next_in,tt=t.input,st=t.avail_in,ot=n.hold,ut=n.bits,n.mode===j&&(n.back=-1);break}for(n.back=0;bt=(Mt=n.lencode[ot&(1<<n.lenbits)-1])>>>16&255,yt=65535&Mt,!((mt=Mt>>>24)<=ut);){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(bt&&0==(240&bt)){for(_t=mt,wt=bt,vt=yt;bt=(Mt=n.lencode[vt+((ot&(1<<_t+wt)-1)>>_t)])>>>16&255,yt=65535&Mt,!(_t+(mt=Mt>>>24)<=ut);){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}ot>>>=_t,ut-=_t,n.back+=_t}if(ot>>>=mt,ut-=mt,n.back+=mt,n.length=yt,0===bt){n.mode=Z;break}if(32&bt){n.back=-1,n.mode=j;break}if(64&bt){t.msg="invalid literal/length code",n.mode=J;break}n.extra=15&bt,n.mode=V;case V:if(n.extra){for(Tt=n.extra;ut<Tt;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.length+=ot&(1<<n.extra)-1,ot>>>=n.extra,ut-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=G;case G:for(;bt=(Mt=n.distcode[ot&(1<<n.distbits)-1])>>>16&255,yt=65535&Mt,!((mt=Mt>>>24)<=ut);){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(0==(240&bt)){for(_t=mt,wt=bt,vt=yt;bt=(Mt=n.distcode[vt+((ot&(1<<_t+wt)-1)>>_t)])>>>16&255,yt=65535&Mt,!(_t+(mt=Mt>>>24)<=ut);){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}ot>>>=_t,ut-=_t,n.back+=_t}if(ot>>>=mt,ut-=mt,n.back+=mt,64&bt){t.msg="invalid distance code",n.mode=J;break}n.offset=yt,n.extra=15&bt,n.mode=q;case q:if(n.extra){for(Tt=n.extra;ut<Tt;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}n.offset+=ot&(1<<n.extra)-1,ot>>>=n.extra,ut-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=J;break}n.mode=Y;case Y:if(0===at)break t;if(lt=ht-at,n.offset>lt){if((lt=n.offset-lt)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=J;break}lt>n.wnext?(lt-=n.wnext,pt=n.wsize-lt):pt=n.wnext-lt,lt>n.length&&(lt=n.length),gt=n.window}else gt=et,pt=it-n.offset,lt=n.length;lt>at&&(lt=at),at-=lt,n.length-=lt;do{et[it++]=gt[pt++]}while(--lt);0===n.length&&(n.mode=$);break;case Z:if(0===at)break t;et[it++]=n.length,at--,n.mode=$;break;case K:if(n.wrap){for(;ut<32;){if(0===st)break t;st--,ot|=tt[nt++]<<ut,ut+=8}if(ht-=at,t.total_out+=ht,n.total+=ht,ht&&(t.adler=n.check=n.flags?s(n.check,et,ht,it-ht):i(n.check,et,ht,it-ht)),ht=at,(n.flags?ot:rt(ot))!==n.check){t.msg="incorrect data check",n.mode=J;break}ot=0,ut=0}n.mode=H;case H:if(n.wrap&&n.flags){for(;ut<32;){if(0===st)break t;st--,ot+=tt[nt++]<<ut,ut+=8}if(ot!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=J;break}ot=0,ut=0}n.mode=W;case W:kt=g;break t;case J:kt=y;break t;case Q:return _;case X:default:return b}return t.next_out=it,t.avail_out=at,t.next_in=nt,t.avail_in=st,n.hold=ot,n.bits=ut,(n.wsize||ht!==t.avail_out&&n.mode<J&&(n.mode<K||e!==l))&&ft(t,t.output,t.next_out,ht-t.avail_out)?(n.mode=Q,_):(ct-=t.avail_in,ht-=t.avail_out,t.total_in+=ct,t.total_out+=ht,n.total+=ht,n.wrap&&ht&&(t.adler=n.check=n.flags?s(n.check,et,ht,t.next_out-ht):i(n.check,et,ht,t.next_out-ht)),t.data_type=n.bits+(n.last?64:0)+(n.mode===j?128:0)+(n.mode===B||n.mode===D?256:0),(0===ct&&0===ht||e===l)&&kt===p&&(kt=w),kt)},e.inflateEnd=function(t){if(!t||!t.state)return b;var e=t.state;return e.window&&(e.window=null),t.state=null,p},e.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?b:(n.head=e,e.done=!1,p):b},e.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==A?b:n.mode===A&&i(1,e,r,0)!==n.check?y:ft(t,e,r,r)?(n.mode=Q,_):(n.havedict=1,p):b},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,n){"use strict";t.exports=function(t,e){var n,r,i,s,a,o,u,c,h,l,d,f,p,g,m,b,y,_,w,v,I,k,S,T,M;n=t.state,r=t.next_in,T=t.input,i=r+(t.avail_in-5),s=t.next_out,M=t.output,a=s-(e-t.avail_out),o=s+(t.avail_out-257),u=n.dmax,c=n.wsize,h=n.whave,l=n.wnext,d=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;t:do{p<15&&(f+=T[r++]<<p,p+=8,f+=T[r++]<<p,p+=8),_=g[f&b];e:for(;;){if(f>>>=w=_>>>24,p-=w,0===(w=_>>>16&255))M[s++]=65535&_;else{if(!(16&w)){if(0==(64&w)){_=g[(65535&_)+(f&(1<<w)-1)];continue e}if(32&w){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}v=65535&_,(w&=15)&&(p<w&&(f+=T[r++]<<p,p+=8),v+=f&(1<<w)-1,f>>>=w,p-=w),p<15&&(f+=T[r++]<<p,p+=8,f+=T[r++]<<p,p+=8),_=m[f&y];n:for(;;){if(f>>>=w=_>>>24,p-=w,!(16&(w=_>>>16&255))){if(0==(64&w)){_=m[(65535&_)+(f&(1<<w)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(I=65535&_,p<(w&=15)&&(f+=T[r++]<<p,(p+=8)<w&&(f+=T[r++]<<p,p+=8)),(I+=f&(1<<w)-1)>u){t.msg="invalid distance too far back",n.mode=30;break t}if(f>>>=w,p-=w,I>(w=s-a)){if((w=I-w)>h&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(k=0,S=d,0===l){if(k+=c-w,w<v){v-=w;do{M[s++]=d[k++]}while(--w);k=s-I,S=M}}else if(l<w){if(k+=c+l-w,(w-=l)<v){v-=w;do{M[s++]=d[k++]}while(--w);if(k=0,l<v){v-=w=l;do{M[s++]=d[k++]}while(--w);k=s-I,S=M}}}else if(k+=l-w,w<v){v-=w;do{M[s++]=d[k++]}while(--w);k=s-I,S=M}for(;v>2;)M[s++]=S[k++],M[s++]=S[k++],M[s++]=S[k++],v-=3;v&&(M[s++]=S[k++],v>1&&(M[s++]=S[k++]))}else{k=s-I;do{M[s++]=M[k++],M[s++]=M[k++],M[s++]=M[k++],v-=3}while(v>2);v&&(M[s++]=M[k++],v>1&&(M[s++]=M[k++]))}break}}break}}while(r<i&&s<o);r-=v=p>>3,f&=(1<<(p-=v<<3))-1,t.next_in=r,t.next_out=s,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=s<o?o-s+257:257-(s-o),n.hold=f,n.bits=p}},function(t,e,n){"use strict";var r=n(30),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,n,u,c,h,l,d){var f,p,g,m,b,y,_,w,v,I=d.bits,k=0,S=0,T=0,M=0,E=0,O=0,x=0,C=0,N=0,A=0,j=null,P=0,U=new r.Buf16(16),D=new r.Buf16(16),R=null,F=0;for(k=0;k<=15;k++)U[k]=0;for(S=0;S<u;S++)U[e[n+S]]++;for(E=I,M=15;M>=1&&0===U[M];M--);if(E>M&&(E=M),0===M)return c[h++]=20971520,c[h++]=20971520,d.bits=1,0;for(T=1;T<M&&0===U[T];T++);for(E<T&&(E=T),C=1,k=1;k<=15;k++)if(C<<=1,(C-=U[k])<0)return-1;if(C>0&&(0===t||1!==M))return-1;for(D[1]=0,k=1;k<15;k++)D[k+1]=D[k]+U[k];for(S=0;S<u;S++)0!==e[n+S]&&(l[D[e[n+S]]++]=S);if(0===t?(j=R=l,y=19):1===t?(j=i,P-=257,R=s,F-=257,y=256):(j=a,R=o,y=-1),A=0,S=0,k=T,b=h,O=E,x=0,g=-1,m=(N=1<<E)-1,1===t&&N>852||2===t&&N>592)return 1;for(;;){_=k-x,l[S]<y?(w=0,v=l[S]):l[S]>y?(w=R[F+l[S]],v=j[P+l[S]]):(w=96,v=0),f=1<<k-x,T=p=1<<O;do{c[b+(A>>x)+(p-=f)]=_<<24|w<<16|v|0}while(0!==p);for(f=1<<k-1;A&f;)f>>=1;if(0!==f?(A&=f-1,A+=f):A=0,S++,0==--U[k]){if(k===M)break;k=e[n+l[S]]}if(k>E&&(A&m)!==g){for(0===x&&(x=E),b+=T,C=1<<(O=k-x);O+x<M&&!((C-=U[O+x])<=0);)O++,C<<=1;if(N+=1<<O,1===t&&N>852||2===t&&N>592)return 1;c[g=A&m]=E<<24|O<<16|b-h|0}}return 0!==A&&(c[b+A]=k-x<<24|64<<16|0),d.bits=E,0}},function(t,e,n){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n(41),s=n(40),a=n(11);
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class o{}class u extends o{static stringify(t){return`boss:volume:${t.baseUrl}/${t.collection}/${t.experiment}/${t.channel}/${t.resolution}/${t.encoding}`}}u.RPC_ID="boss/VolumeChunkSource";class c{static stringify(t){return`boss:mesh:${t.baseUrl}`}}c.RPC_ID="boss/MeshChunkSource";var h=n(10),l=n(28),d=n(15),f=n(35),p=n(9),g=n(0),m=n(8),b=n(7),y=n(3);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _=new Map;_.set("|u1",{arrayConstructor:Uint8Array,fixEndianness:()=>{},javascriptElementsPerArrayElement:1,elementBytes:1,dataType:m.b.UINT8}),_.set("|i1",{arrayConstructor:Uint8Array,fixEndianness:()=>{},javascriptElementsPerArrayElement:1,elementBytes:1,dataType:m.b.UINT8});for(let[t,e]of[["<",b.b.LITTLE],[">",b.b.BIG]]){for(let n of["u","i"])_.set(`${t}${n}2`,{arrayConstructor:Uint16Array,elementBytes:2,fixEndianness:t=>{Object(b.c)(t,e)},javascriptElementsPerArrayElement:1,dataType:m.b.UINT16}),_.set(`${t}${n}4`,{arrayConstructor:Uint32Array,elementBytes:4,fixEndianness:t=>{Object(b.d)(t,e)},javascriptElementsPerArrayElement:1,dataType:m.b.UINT32}),_.set(`${t}${n}8`,{arrayConstructor:Uint32Array,elementBytes:8,fixEndianness:t=>{Object(b.d)(t,e)},javascriptElementsPerArrayElement:2,dataType:m.b.UINT64});_.set(`${t}f4`,{arrayConstructor:Float32Array,elementBytes:4,fixEndianness:t=>{Object(b.d)(t,e)},javascriptElementsPerArrayElement:1,dataType:m.b.FLOAT32})}class w{constructor(t,e,n,r){this.data=t,this.shape=e,this.dataType=n,this.fortranOrder=r}}var v=n(25),I=n(16),k=n(6),S=n(1);n.d(e,"BossVolumeChunkSource",function(){return x}),n.d(e,"BossMeshSource",function(){return C});
/**
 * @license
 * Copyright 2017 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var T=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};let M=new Map;M.set("npz",
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(t,e,n){let r=function(t){if(147!==t[0]||78!==t[1]||85!==t[2]||77!==t[3]||80!==t[4]||89!==t[5])throw new Error("Data does not match npy format.");const e=t[6],n=t[7];if(1!==e||0!==n)throw new Error(`Unsupported npy version ${e}.${n}`);const r=new DataView(t.buffer,t.byteOffset,t.byteLength).getUint16(8,!0),i=new TextDecoder("utf-8").decode(t.subarray(10,r+10));let s;const a=r+10;try{s=Object(y.d)(i)}catch(t){throw new Error(`Failed to parse npy header: ${t}`)}const o=s.descr;let u=s.shape,c=1;if(!Array.isArray(u))throw new Error("Invalid shape ${JSON.stringify(shape)}");for(let t of u){if("number"!=typeof t)throw new Error("Invalid shape ${JSON.stringify(shape)}");c*=t}const h=_.get(o);if(void 0===h)throw new Error(`Unsupported numpy data type ${JSON.stringify(o)}`);let{arrayConstructor:l,javascriptElementsPerArrayElement:d}=h;const f=d*c;if(l.BYTES_PER_ELEMENT*f+a!==t.byteLength)throw new Error("Expected length does not match length of data");const p=new l(t.buffer,t.byteOffset+a,f);return h.fixEndianness(p),new w(p,u,h,!0===s.fortran_order)}(await Object(d.a)(l.a,e,[n],new Uint8Array(n))),i=t.chunkDataSize,s=t.source,{shape:a}=r;if(3!==a.length||a[0]!==i[2]||a[1]!==i[1]||a[2]!==i[0])throw new Error(`Shape ${JSON.stringify(a)} does not match chunkDataSize ${Object(g.o)(i)}`);let o=r.dataType.dataType,{spec:u}=s;if(o!==u.dataType)throw new Error(`Data type ${p.a[o]} does not match expected data type ${p.a[u.dataType]}`);await Object(f.a)(t,e,r.data)}),M.set("jpeg",v.a);let E=new Map;function O(t,e){return Object(r.WithParameters)(Object(i.a)()(t),e)}E.set("npz","application/npygz"),E.set("jpeg","image/jpeg");let x=class extends(O(I.b,u)){constructor(){super(...arguments),this.chunkDecoder=M.get(this.parameters.encoding)}async download(t,e){let{parameters:n}=this,r=`${n.baseUrl}/latest/cutout/${n.collection}/${n.experiment}/${n.channel}/${n.resolution}`;{let e=this.computeChunkBounds(t),n=t.chunkDataSize;for(let t=0;t<3;++t)r+=`/${e[t]}:${e[t]+n[t]}`}r+="/",void 0!==n.window&&(r+=`?window=${n.window[0]},${n.window[1]}`);const i=await function(t,e,n,r,i=a.e){return Object(s.a)(t,e,n,r,t=>{const e=new Headers(n.headers);return e.set("Authorization",`Bearer ${t}`),Object.assign({},n,{headers:e})},t=>{const{status:e}=t;if(403===e||401===e)return"refresh";if(504===e)return"retry";throw t},i)}(this.credentialsProvider,r,{headers:{Accept:E.get(n.encoding)}},k.d,e);await this.chunkDecoder(t,e,i)}};x=T([Object(S.g)()],x);let C=class extends(O(h.a,c)){download(t,e){const{parameters:n}=this;return Object(k.b)(`${n.baseUrl}${t.objectId}`,{},k.d,e).then(e=>(function(t,e){return Object(h.g)(t,e,"fragments")})(t,e))}downloadFragment(t,e){const{parameters:n}=this;return Object(k.b)(`${n.baseUrl}${t.fragmentId}`,{},k.d,e).then(e=>(function(t,e){let n=new DataView(e).getUint32(0,!0);Object(h.c)(t,Object(h.h)(e,b.b.LITTLE,4,n))})(t,e))}};C=T([Object(S.g)()],C)},function(t,e,n){"use strict";n.r(e);var r=n(5);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i{}class s extends i{}class a extends s{}a.RPC_ID="render/TileChunkSource";class o extends s{}o.RPC_ID="render/PointMatchSource";var u,c=n(25),h=n(26),l=n(9);!function(t){t[t.LINE=0]="LINE",t[t.POINT=1]="POINT"}(u||(u={}));class d extends l.i{constructor(t){super(t)}static make(t){return new d(Object.assign({},t,{transform:Object(l.k)(t.transform,t.vectorGraphicsSourceOptions)}))}static fromObject(t){return new d(t)}toObject(){return super.toObject()}}class f extends h.SliceViewChunkSource{constructor(t,e){super(t,e),this.spec=d.fromObject(e.spec)}}f.prototype.chunkConstructor=
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class extends h.SliceViewChunk{constructor(){super(),this.source=null,this.vertexPositions=null,this.vertexNormals=null}initializeVolumeChunk(t,e){super.initializeVolumeChunk(t,e);let n=0;this.vertexPositions&&(n+=this.vertexPositions.buffer.byteLength),this.vertexNormals&&(n+=this.vertexNormals.buffer.byteLength),this.systemMemoryBytes=n,this.gpuMemoryBytes=n,this.vertexPositions=null}serialize(t,e){super.serialize(t,e);let{vertexPositions:n,vertexNormals:r}=this;t.vertexPositions=n;let i=n.buffer;if(e.push(i),r){t.vertexNormals=r;let n=r.buffer;e.push(n)}this.vertexPositions=null,this.vertexNormals=null}downloadSucceeded(){this.systemMemoryBytes=this.gpuMemoryBytes=this.vertexPositions.byteLength,super.downloadSucceeded()}freeSystemMemory(){this.vertexPositions=null,this.vertexNormals=null}};var p=n(16);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g{constructor(t=16){this.length=0,this.data=new Float32Array(t)}resize(t){let{data:e}=this;if(t>e.length){let n=new Float32Array(Math.max(t,2*e.length));n.set(e.subarray(0,this.length)),this.data=n}this.length=t}get view(){let{data:t}=this;return new Float32Array(t.buffer,t.byteOffset,this.length)}shrinkToFit(){this.data=new Float32Array(this.view)}clear(){this.length=0}appendArray(t){let{length:e}=this;this.resize(e+t.length),this.data.set(t,e)}eraseRange(t,e){this.data.copyWithin(t,e,this.length),this.length-=e-t}}var m=n(0),b=n(6),y=n(3),_=n(1);n.d(e,"TileChunkSource",function(){return I}),n.d(e,"PointMatchSource",function(){return M});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var w=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const v=new Map;v.set("jpg",c.a);let I=class extends(Object(r.WithParameters)(p.b,a)){constructor(){super(...arguments),this.chunkDecoder=v.get(this.parameters.encoding),this.queryString=(()=>{let{parameters:t}=this,e=[];return void 0!==t.channel&&e.push("channels="+t.channel),void 0!==t.minIntensity&&e.push(`minIntensity=${JSON.stringify(t.minIntensity)}`),void 0!==t.maxIntensity&&e.push(`maxIntensity=${JSON.stringify(t.maxIntensity)}`),void 0!==t.maxTileSpecsToRender&&e.push(`maxTileSpecsToRender=${JSON.stringify(t.maxTileSpecsToRender)}`),void 0!==t.filter&&e.push(`filter=${JSON.stringify(t.filter)}`),e.join("&")})()}async download(t,e){let{parameters:n}=this,{chunkGridPosition:r}=t,i=1/Math.pow(2,n.level);t.chunkDataSize=this.spec.chunkDataSize;let s=t.chunkDataSize[0]*Math.pow(2,n.level),a=t.chunkDataSize[1]*Math.pow(2,n.level),o=m.n.create();o[0]=r[0]*s,o[1]=r[1]*a,o[2]=r[2];let u=`/render-ws/v1/owner/${n.owner}/project/${n.project}/stack/${n.stack}/z/${o[2]}/box/${o[0]},${o[1]},${s},${a},${i}/jpeg-image`;const c=await Object(b.b)(`${n.baseUrl}${u}?${this.queryString}`,{},b.d,e);await this.chunkDecoder(t,e,c)}};function k(t,e,n){return{tileId:t,local:[e,n]}}function S(t,e,n,r){let i=new Array;return Object(y.a)(e,t=>{let e=Object(y.l)(t.pId),n=Object(y.l)(t.qId),r=Object(y.i)(t.matches),s=r.p,a=r.q;for(let t=0;t<s[0].length;t++)i.push(k(e,s[0][t],s[1][t])),i.push(k(n,a[0][t],a[1][t]))}),function(t,e,n){const r=`${e.baseUrl}/render-ws/v1/owner/${e.owner}/project/${e.project}/`+`stack/${e.stack}/local-to-world-coordinates`;return Object(b.b)(r,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}},b.e,n)}(i,n,r).then(e=>{let n=new g;for(let t=0;t<e.length;t++){let r=Object(y.i)(e[t]),i=Object(y.g)(r.world);n.appendArray(i)}t.vertexPositions=n.view})}function T(t,e,n,r){return Object(b.b)(`${n.baseUrl}${e}`,{},b.e,r).then(e=>(function(t,e,n,r){let i;if(1===e.length)i=`/render-ws/v1/owner/${n.owner}/matchCollection/`+`${n.matchCollection}/group/${e[0]}/matchesWith/${e[0]}`;else{if(2!==e.length)throw new Error(`Invalid section Id vector of length: ${JSON.stringify(e.length)}`);i=`/render-ws/v1/owner/${n.owner}/matchCollection/`+`${n.matchCollection}/group/${e[0]}/matchesWith/${e[1]}`}return Object(b.b)(`${n.baseUrl}${i}`,{},b.e,r).then(e=>S(t,e,n,r))})(t,function(t){let e=[];return Object(y.a)(t,t=>{Object(y.i)(t),e.push(Object(y.l)(t.sectionId))}),e}(e),n,r))}I=w([Object(_.g)()],I);let M=class extends(Object(r.WithParameters)(f,o)){download(t,e){let{parameters:n}=this,{chunkGridPosition:r}=t;return T(t,`/render-ws/v1/owner/${n.owner}/project/${n.project}/`+`stack/${n.stack}/sectionData?minZ=${r[2]}&`+`maxZ=${r[2]+n.zoffset}`,n,e)}};M=w([Object(_.g)()],M)},function(t,e,n){"use strict";n.r(e);var r,i,s,a=n(28),o=n(15),u=n(5),c=n(31);!function(t){t[t.RAW=0]="RAW",t[t.JPEG=1]="JPEG",t[t.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"}(r||(r={}));class h{}h.RPC_ID="precomputed/VolumeChunkSource";class l{}l.RPC_ID="precomputed/MeshSource",function(t){t[t.RAW=0]="RAW",t[t.GZIP=1]="GZIP"}(i||(i={})),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.MURMURHASH3_X86_128=1]="MURMURHASH3_X86_128"}(s||(s={}));class d{}d.RPC_ID="precomputed/MultiscaleMeshSource";class f{}f.RPC_ID="precomputed/SkeletonSource";var p=n(10),g=n(29),m=n(8),b=n(7);var y=n(33),_=n(25),w=n(23),v=n(16),I=n(6);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const k=-1!==navigator.userAgent.indexOf("Chrome")?"no-store":"default";function S(t,e,n,r){return Object(I.b)(t,{headers:Object(I.c)(e,n),cache:k},I.d,r)}var T=n(0);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M(t){return t^=t>>>16,t=Math.imul(t,2246822507),t^=t>>>13,t=Math.imul(t,3266489909),t^=t>>>16}function E(t,e){return t<<e|t>>>32-e}var O=n(3),x=n(4),C=n(24),N=n(1);n.d(e,"PrecomputedVolumeChunkSource",function(){return R}),n.d(e,"decodeManifestChunk",function(){return F}),n.d(e,"decodeFragmentChunk",function(){return z}),n.d(e,"PrecomputedMeshSource",function(){return L}),n.d(e,"PrecomputedMultiscaleMeshSource",function(){return B}),n.d(e,"PrecomputedSkeletonSource",function(){return $});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var A=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const j=new Map([[s.MURMURHASH3_X86_128,t=>{!function(t,e,n,r){let i=e,s=e,a=e,o=e;const u=2869860233;let c=Math.imul(r,u);c=E(c,16),s^=c=Math.imul(c,951274213);let h=Math.imul(n,597399067);h=E(h,15),i^=h=Math.imul(h,u),s=(s^=8)+(i=(i=(i=(i^=8)+s>>>0)+(a^=8)>>>0)+(o^=8)>>>0)>>>0,a=a+i>>>0,o=o+i>>>0,i=M(i),s=(s=M(s))+(i=(i=(i=i+s>>>0)+(a=M(a))>>>0)+(o=M(o))>>>0)>>>0,t.low=i,t.high=s}(t,0,t.low,t.high)}],[s.IDENTITY,t=>{}]]);function P(t,e){const{url:n,sharding:r}=e;if(void 0===r)return;const s=c.a.get(t,Object(O.e)({type:"precomputed:shardedDataSource",url:n,sharding:r}),{download:async function(t,e){const s=x.a.lowMask(new x.a,r.minishardBits);x.a.and(s,s,t);const u=x.a.lowMask(new x.a,r.shardBits),c=new x.a;x.a.rshift(c,t,r.minishardBits),x.a.and(u,u,c);const h=`${n}/${u.toString(16).padStart(Math.ceil(r.shardBits/4),"0")}`,l=h+".index",d=x.a.lshift(new x.a,s,4),f=x.a.addUint32(new x.a,d,16),p=await S(l,d,f,e);if(16!==p.byteLength)throw new Error("Failed to retrieve minishard offset");const g=new DataView(p),m=new x.a(g.getUint32(0,!0),g.getUint32(4,!0)),y=new x.a(g.getUint32(8,!0),g.getUint32(12,!0));if(x.a.equal(m,y))throw new Error("Object not found");const _=h+".data";let w=await S(_,m,y,e);if(r.minishardIndexEncoding===i.GZIP&&(w=(await Object(o.a)(a.a,e,[w],new Uint8Array(w))).buffer),w.byteLength%24!=0)throw new Error(`Invalid minishard index length: ${w.byteLength}`);const v=new Uint32Array(w);Object(b.d)(v,b.b.LITTLE);const I=v.byteLength/24;let k=0,T=0,M=0,E=0;for(let t=0;t<I;++t){let e=k+v[2*t],n=T+v[2*t+1];e>=4294967296&&(e-=4294967296,n+=1),k=v[2*t]=e,T=v[2*t+1]=n;let r=M+v[2*(I+t)],i=E+v[2*(I+t)+1];r>=4294967296&&(r-=4294967296,i+=1),v[2*(I+t)]=r,v[2*(I+t)+1]=i;let s=r+v[2*(2*I+t)],a=i+v[2*(2*I+t)+1];s>=4294967296&&(s-=4294967296,a+=1),M=s,E=a,v[2*(2*I+t)]=s,v[2*(2*I+t)+1]=a}return{data:{data:v,shardUrl:_},size:v.byteLength}},encodeKey:t=>t.toString(),sourceQueueLevel:1});return s.sharding=r,s}async function U(t,e,n,r){const{sharding:s}=t,u=j.get(s.hash),c=x.a.rshift(new x.a,n,s.preshiftBits);u(c);const h=x.a.lowMask(new x.a,s.minishardBits+s.shardBits);x.a.and(h,h,c);const l=await t.getData(h,()=>({priorityTier:e.priorityTier,priority:e.priority}),r),{startOffset:d,endOffset:f}=function(t,e){const n=t.data,r=n.length/6,i=e.low,s=e.high;for(let t=0;t<r;++t)if(n[2*t]===i&&n[2*t+1]===s)return{startOffset:new x.a(n[2*(r+t)],n[2*(r+t)+1]),endOffset:new x.a(n[2*(2*r+t)],n[2*(2*r+t)+1])};throw new Error(`Object not found in minishard: ${e}`)}(l,n);let p=await S(l.shardUrl,d,f,r);return t.sharding.dataEncoding===i.GZIP&&(p=(await Object(o.a)(a.a,r,[p],new Uint8Array(p))).buffer),{data:p,shardInfo:{shardUrl:l.shardUrl,offset:d}}}const D=new Map;D.set(r.RAW,w.a),D.set(r.JPEG,_.a),D.set(r.COMPRESSED_SEGMENTATION,y.a);let R=class extends(Object(u.WithParameters)(v.b,h)){constructor(){super(...arguments),this.chunkDecoder=D.get(this.parameters.encoding),this.minishardIndexSource=P(this.chunkManager,this.parameters),this.gridShape=(()=>{const t=new Uint32Array(3),{upperVoxelBound:e,chunkDataSize:n}=this.spec;for(let r=0;r<3;++r)t[r]=Math.ceil(e[r]/n[r]);return t})()}async download(t,e){const{parameters:n}=this,{minishardIndexSource:r}=this;let i;if(void 0===r){let r;{let e=this.computeChunkBounds(t),i=t.chunkDataSize;r=`${n.url}/${e[0]}-${e[0]+i[0]}_`+`${e[1]}-${e[1]+i[1]}_`+`${e[2]}-${e[2]+i[2]}`}i=await Object(I.b)(r,{},I.d,e)}else{this.computeChunkBounds(t);const{gridShape:n}=this,{chunkGridPosition:s}=t,a=Math.ceil(Math.log2(n[0])),o=Math.ceil(Math.log2(n[1])),u=Math.ceil(Math.log2(n[2])),c=Object(C.b)(new x.a,a,o,u,s[0],s[1],s[2]);i=(await U(r,t,c,e)).data}await this.chunkDecoder(t,e,i)}};function F(t,e){return Object(p.g)(t,e,"fragments")}function z(t,e){let n=new DataView(e).getUint32(0,!0);Object(p.c)(t,Object(p.h)(e,b.b.LITTLE,4,n))}R=A([Object(N.g)()],R);let L=class extends(Object(u.WithParameters)(p.a,l)){download(t,e){const{parameters:n}=this;return Object(I.b)(`${n.url}/${t.objectId}:${n.lod}`,{},I.e,e).then(e=>F(t,e))}downloadFragment(t,e){const{parameters:n}=this;return Object(I.b)(`${n.url}/${t.fragmentId}`,{},I.d,e).then(e=>z(t,e))}};L=A([Object(N.g)()],L);let B=class extends(Object(u.WithParameters)(p.b,d)){constructor(){super(...arguments),this.minishardIndexSource=P(this.chunkManager,{url:this.parameters.url,sharding:this.parameters.metadata.sharding})}async download(t,e){const{parameters:n,minishardIndexSource:r}=this;let i;void 0===r?i=await Object(I.b)(`${n.url}/${t.objectId}.index`,{},I.d,e):({data:i,shardInfo:t.shardInfo}=await U(r,t,t.objectId,e)),await function(t,e){if(e.byteLength<28||e.byteLength%4!=0)throw new Error(`Invalid index file size: ${e.byteLength}`);const n=new DataView(e);let r=0;const i=T.n.fromValues(n.getFloat32(r,!0),n.getFloat32(r+4,!0),n.getFloat32(r+8,!0));r+=12;const s=T.n.fromValues(n.getFloat32(r,!0),n.getFloat32(r+4,!0),n.getFloat32(r+8,!0));r+=12;const a=n.getUint32(r,!0);if(r+=4,e.byteLength<r+20*a)throw new Error(`Invalid index file size for ${a} lods: ${e.byteLength}`);const o=new Float32Array(e,r,a);r+=4*a,Object(b.d)(o,b.b.LITTLE);const u=new Float32Array(e,r,3*a);Object(b.d)(u,b.b.LITTLE),r+=12*a;const c=new Uint32Array(e,r,a);r+=4*a,Object(b.d)(c,b.b.LITTLE);const h=c.reduce((t,e)=>t+e);if(e.byteLength!==r+16*h)throw new Error(`Invalid index file size for ${a} lods and `+`${h} total fragments: ${e.byteLength}`);const l=new Uint32Array(e,r);Object(b.d)(l,b.b.LITTLE);const d=T.n.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),f=T.n.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);let g=Math.max(1,o.length);{let t=0;for(let e=0;e<a;++e){const n=c[e];for(let r=0;r<3;++r){let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;const a=t+n*r;for(let t=0;t<n;++t){const e=l[a+t];i=Math.max(i,e),s=Math.min(s,e)}if(0!=n){for(;i>>>g-e-1!=s>>>g-e-1;)++g;0===e&&(f[r]=Math.min(f[r],(1<<e)*s),d[r]=Math.max(d[r],(1<<e)*(i+1)))}}t+=4*n}}let m=0;{let t=0,e=0;for(let n=0;n<a;++n){const r=c[n];m+=t*(n-e),e=n,t=r,m+=r}m+=(g-1-e)*t}const y=new Uint32Array(5*m),_=new Float64Array(m+1);let w;{let e=0,n=0,r=0,i=0;for(let t=0;t<a;++t){const s=c[t];for(let t=0;t<s;++t){for(let e=0;e<3;++e)y[5*(n+t)+e]=l[i+t+e*s];const e=l[i+t+3*s];r+=e,_[n+t+1]=r,0===e&&(y[5*(n+t)+4]=2147483648)}for(i+=4*s,0!==t&&Object(p.e)(y,e,n,n+s),e=n,n+=s;t+1<g&&(t+1>=o.length||0===o[t+1]);){const i=Object(p.j)(y,e,n);_.fill(r,n+1,i+1),e=n,n=i,++t}}w=y.slice(0,5*n),t.offsets=_.slice(0,n+1)}const v=t.source,{lodScaleMultiplier:I}=v.parameters.metadata,k=new Float32Array(g);k.set(o,0);for(let t=0;t<o.length;++t)k[t]*=I;t.manifest={chunkShape:i,chunkGridSpatialOrigin:s,clipLowerBound:T.n.add(f,s,T.n.multiply(f,f,i)),clipUpperBound:T.n.add(d,s,T.n.multiply(d,d,i)),octree:w,lodScales:k,vertexOffsets:u}}(t,i)}async downloadFragment(t,e){const{parameters:r}=this,i=t.manifestChunk,s=t.chunkIndex,{shardInfo:a,offsets:o}=i,u=o[s],c=o[s+1];let h,l,d;if(void 0!==a){h=a.shardUrl;const t=o[o.length-1];let e=a.offset.low-t+u,n=a.offset.high,r=e+c-u,i=n;for(;e<0;)e+=4294967296,n-=1;for(;r<0;)r+=4294967296,i-=1;for(;r>4294967296;)r-=4294967296,i+=1;l=new x.a(e,n),d=new x.a(r,i)}else h=`${r.url}/${i.objectId}`,l=u,d=c;const f=await S(h,l,d,e);await async function(t,e){const{lod:r}=t,i=t.manifestChunk.source,s=await n.e(1).then(n.bind(null,94)),a=await s.decodeDracoPartitioned(new Uint8Array(e),i.parameters.metadata.vertexQuantizationBits,0!==r);Object(p.d)(t,a,i.format.vertexPositionFormat)}(t,f)}};B=A([Object(N.g)()],B);let $=class extends(Object(u.WithParameters)(g.a,f)){constructor(){super(...arguments),this.minishardIndexSource=P(this.chunkManager,{url:this.parameters.url,sharding:this.parameters.metadata.sharding})}async download(t,e){const{minishardIndexSource:n,parameters:r}=this;let i;!
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e,n){let r=new DataView(e),i=r.getUint32(0,!0),s=r.getUint32(4,!0),a=8+4*i*3;Object(g.b)(t,e,b.b.LITTLE,8,i,a,s),a+=4*s*2;let o=[];for(let t of n.values()){const n=m.a[t.dataType]*t.numComponents,r=n*i,s=new Uint8Array(e,a,r);switch(n){case 2:Object(b.c)(s,b.b.LITTLE);break;case 4:case 8:Object(b.d)(s,b.b.LITTLE)}o.push(s),a+=r}t.vertexAttributes=o}(t,i=void 0===n?await Object(I.b)(`${r.url}/${t.objectId}`,{},I.d,e):(await U(n,t,t.objectId,e)).data,r.metadata.vertexAttributes)}};$=A([Object(N.g)()],$)},function(t,e,n){"use strict";n.r(e);var r=n(19),i=n(42),s=n(5),a=n(41),o=n(40),u=n(11),c=n(6);function h(t,e,n,r=u.e){return Object(o.a)(e,`${t.serverUrl}${n.path}`,{method:n.method,body:n.payload},"json"===n.responseType?c.e:c.d,(t,e)=>{const n=new Headers(e.headers);return n.set("Authorization",`${t.tokenType} ${t.accessToken}`),Object.assign({},e,{headers:n})},t=>{const{status:e}=t;if(401===e)return"refresh";if(504===e||503===e)return"retry";throw t},r)}
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var l;!function(t){t[t.RAW=0]="RAW",t[t.JPEG=1]="JPEG",t[t.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"}(l||(l={}));class d{}d.RPC_ID="brainmaps/VolumeChunkSource";class f{}f.RPC_ID="brainmaps/MultiscaleMeshSource";class p{}p.RPC_ID="brainmaps/MeshSource";class g{}g.RPC_ID="brainmaps/SkeletonSource";class m{}m.RPC_ID="brainmaps/Annotation";var b=n(10),y=n(27),_=n(29),w=n(33),v=n(25),I=n(23),k=n(16),S=n(7),T=n(0),M=n(3),E=n(4),O=n(24),x=n(1);n.d(e,"BrainmapsVolumeChunkSource",function(){return U}),n.d(e,"BrainmapsMultiscaleMeshSource",function(){return B}),n.d(e,"BrainmapsMeshSource",function(){return V}),n.d(e,"BrainmapsSkeletonSource",function(){return G}),n.d(e,"BrainmapsAnnotationSource",function(){return nt});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var C=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};const N=new Map([[l.RAW,I.a],[l.JPEG,v.a],[l.COMPRESSED_SEGMENTATION,w.a]]);function A(t,e){t&&(e.change_spec={change_stack_id:t.changeStackId},t.timeStamp&&(e.change_spec.time_stamp=t.timeStamp),t.skipEquivalences&&(e.change_spec.skip_equivalences=t.skipEquivalences))}function j(t,e){return Object(s.WithParameters)(Object(a.a)()(t),e)}const P=new E.a;let U=class extends(j(k.b,d)){constructor(){super(...arguments),this.chunkDecoder=N.get(this.parameters.encoding)}applyEncodingParams(t){let{encoding:e}=this.parameters;switch(e){case l.RAW:t.subvolume_format="RAW";break;case l.JPEG:return t.subvolume_format="SINGLE_IMAGE",void(t.image_format_options={image_format:"JPEG",jpeg_quality:70});case l.COMPRESSED_SEGMENTATION:t.subvolume_format="RAW",t.image_format_options={compressed_segmentation_block_size:Object(T.o)(this.spec.compressedSegmentationBlockSize)};break;default:throw new Error(`Invalid encoding: ${e}`)}}async download(t,e){let n,{parameters:r}=this,i=this.computeChunkBounds(t),s=t.chunkDataSize;n=`/v1/volumes/${r.volumeId}/subvolume:binary`;let a={geometry:{corner:Object(T.o)(i),size:Object(T.o)(s),scale:r.scaleIndex}};this.applyEncodingParams(a),A(r.changeSpec,a);const o=await h(r.instance,this.credentialsProvider,{method:"POST",payload:JSON.stringify(a),path:n,responseType:"arraybuffer"},e);await this.chunkDecoder(t,e,o)}};function D(t,e,n,r){const i=new E.a;if(!i.tryParseString(t,16))throw new Error(`Couldn't parse fragmentId ${t} as hex-encoded Uint64`);return Object(O.a)(i,e,n,r)}U=C([Object(x.g)()],U);const R=100;function F(t,e){let n=t.byteLength,r=0;const i=new DataView(t);for(;r<n;){if(r+32>n)throw new Error("Invalid batch mesh fragment response.");const s=i.getUint32(r,!0),a=i.getUint32(r+4,!0),o=new E.a(s,a).toString()+"\0";r+=8;const u=i.getUint32(r,!0),c=i.getUint32(r+4,!0);if(r+=8,0!==c)throw new Error("Invalid batch mesh fragment response.");if(r+u+8+8>n)throw new Error("Invalid batch mesh fragment response.");const h=o+(new TextDecoder).decode(new Uint8Array(t,r,u));r+=u;const l=i.getUint32(r,!0),d=i.getUint32(r+4,!0);r+=8;const f=i.getUint32(r,!0),p=i.getUint32(r+4,!0);if(r+=8,0!==d||0!==p)throw new Error("Invalid batch mesh fragment response.");const g=r+12*f+12*l;if(g>n)throw new Error("Invalid batch mesh fragment response.");e({fullKey:h,buffer:t,verticesOffset:r,numVertices:l,indicesOffset:r+12*l,numIndices:3*f}),r=g}}function z(t){let e=0,n=0;for(let r of t)e+=r.numVertices,n+=r.numIndices;const r=new Float32Array(3*e),i=new Uint32Array(n);let s=0,a=0;for(const e of t){r.set(new Float32Array(e.buffer,e.verticesOffset,3*e.numVertices),3*s);const{numIndices:t}=e,n=new Uint32Array(e.buffer,e.indicesOffset,t);Object(S.d)(n,S.b.LITTLE);for(let e=0;e<t;++e)i[a++]=n[e]+s;s+=e.numVertices}return Object(S.d)(r,S.b.LITTLE),{vertexPositions:r,indices:i}}function L(t,e,n,r){const i=[];let s=0;for(const t of n){const e=t.indexOf("\0"),n=t.substring(0,e),r=t.substring(e+1);if(void 0!==n&&i.push({object_id:n,fragment_keys:[]}),i[i.length-1].fragment_keys.push(r),++s===R)break}const a={volume_id:e.volumeId,mesh_name:e.meshName,batches:i};return h(e.instance,t,{method:"POST",path:"/v1/objects/meshes:batch",payload:JSON.stringify(a),responseType:"arraybuffer"},r)}let B=class extends(j(b.b,f)){constructor(){super(...arguments),this.listFragmentsParams=(()=>{const{parameters:t}=this,{changeSpec:e}=t;return void 0!==e?`&header.changeStackId=${e.changeStackId}`:""})()}download(t,e){let{parameters:n}=this;const r=`/v1/objects/${n.volumeId}/meshes/`+`${n.info.lods[0].info.name}:listfragments?`+`object_id=${t.objectId}&return_supervoxel_ids=true`+this.listFragmentsParams;return h(n.instance,this.credentialsProvider,{method:"GET",path:r,responseType:"json"},e).then(e=>(function(t,e){Object(M.i)(e);const n=t.source,r=Object(M.j)(e,"fragmentKey",M.m),i=Object(M.j)(e,"supervoxelId",M.m),s=r.length;if(s!==i.length)throw new Error("Expected fragmentKey and supervoxelId arrays to have the same length.");const a=new Map;r.forEach((t,e)=>{let n=a.get(t);void 0===n&&(n=[],a.set(t,n)),n.push(i[e])});const{chunkShape:o}=n.parameters.info,u=n.parameters.info.lods[0].gridShape,c=Math.ceil(Math.log2(u[0])),h=Math.ceil(Math.log2(u[1])),l=Math.ceil(Math.log2(u[2])),d=Array.from(a.entries()).map(([t,e])=>({fragmentId:t,corner:D(t,c,h,l),supervoxelIds:e}));let f,p;d.sort((t,e)=>Object(O.d)(t.corner[0],t.corner[1],t.corner[2],e.corner[0],e.corner[1],e.corner[2])?-1:1);let g,m=0;if(0===s)f=p=T.h,g=Uint32Array.of(0,0,0,0,2147483648);else{const t=T.n.clone(T.f),e=T.n.clone(T.h);for(d.forEach(n=>{const{corner:r}=n;for(let n=0;n<3;++n)t[n]=Math.min(t[n],r[n]),e[n]=Math.max(e[n],r[n])}),m=1;e[0]>>>m-1!=t[0]>>>m-1||e[1]>>>m-1!=t[1]>>>m-1||e[2]>>>m-1!=t[2]>>>m-1;)++m;f=T.n.multiply(t,t,o),p=T.n.add(e,T.n.multiply(e,e,o),o)}const{lods:y}=n.parameters.info,_=new Float32Array(Math.max(y.length,m));for(let t=0;t<y.length;++t)_[t]=y[t].scale;if(0!==s){const t=new Uint32Array(d.length*_.length*5);d.forEach((e,n)=>{t.set(e.corner,5*n),t[5*n]=e.corner[0]});let e=0,n=d.length;for(let r=1;r<_.length;++r){const r=Object(b.j)(t,e,n);e=n,n=r}g=t.slice(0,5*n)}const w={chunkShape:o,chunkGridSpatialOrigin:T.h,clipLowerBound:f,clipUpperBound:p,octree:g,lodScales:_,vertexOffsets:new Float32Array(3*_.length)};t.manifest=w,t.fragmentSupervoxelIds=d})(t,e))}downloadFragment(t,e){const{parameters:n}=this,r=t.manifestChunk,{fragmentSupervoxelIds:i}=r,s=r.manifest,{lod:a}=t,{octree:o}=s,u=i.length,c=t.chunkIndex;let h=c;for(;h>=u;)h=o[5*h+3];let l=c+1;for(;l>u;)l=2147483647&o[5*l-1];const{relativeBlockShape:d,gridShape:f}=n.info.lods[a],p=Math.ceil(Math.log2(f[0])),g=Math.ceil(Math.log2(f[1])),m=Math.ceil(Math.log2(f[2]));let _=new Map;for(let t=h;t<l;++t){const e=Math.floor(o[5*t]/d[0]),n=Math.floor(o[5*t+1]/d[1]),r=Math.floor(o[5*t+2]/d[2]),s=Object(O.b)(P,p,g,m,e,n,r).toString(16).padStart(16,"0"),a=i[t];for(const e of a.supervoxelIds)_.set(e+"\0"+s,t)}let w=Math.max(0,a-1),v=[];const I=Array.from(_);function k(e){if(F(e,t=>{const e=_.get(t.fullKey);if(!_.delete(t.fullKey))throw new Error(`Received unexpected fragment key: ${JSON.stringify(t.fullKey)}.`);t.chunkIndex=e,v.push(t)}),0!==_.size)return M();!function(){v.sort((t,e)=>t.chunkIndex-e.chunkIndex);let e=0;const n=1<<3*(a-w),r=new Uint32Array(n+1);let i=0;for(const t of v){const s=t.chunkIndex,a=Object(O.c)(o[5*s]>>>w,o[5*s+1]>>>w,o[5*s+2]>>>w)&n-1;r.fill(e,i+1,a+1),i=a,e+=t.numIndices}r.fill(e,i+1,n+1),Object(b.d)(t,Object.assign({},z(v),{subChunkOffsets:r}),y.e.float32)}()}I.sort((t,e)=>t[0].localeCompare(e[0])),_=new Map(I);const{credentialsProvider:S}=this,T=n.info.lods[a].info.name;function M(){return L(S,{instance:n.instance,volumeId:n.volumeId,meshName:T},_.keys(),e).then(k)}return M()}};function $(t,e){Object(M.i)(e);const n=Object(M.j)(e,"fragmentKey",M.m),r=Object(M.j)(e,"supervoxelId",M.m);if(n.length!==r.length)throw new Error("Expected fragmentKey and supervoxelId arrays to have the same length.");let i=r.map((t,e)=>t+"\0"+n[e]);t.fragmentIds=function(t){const e=[];let n=0;const r=t.length;for(;n<r;)e.push(JSON.stringify(t.slice(n,n+R))),n+=R;return e}(i)}B=C([Object(x.g)()],B);let V=class extends(j(b.a,p)){constructor(){super(...arguments),this.listFragmentsParams=(()=>{const{parameters:t}=this,{changeSpec:e}=t;return void 0!==e?`&header.changeStackId=${e.changeStackId}`:""})()}download(t,e){let{parameters:n}=this;const r=`/v1/objects/${n.volumeId}/meshes/`+`${n.meshName}:listfragments?`+`object_id=${t.objectId}&return_supervoxel_ids=true`+this.listFragmentsParams;return h(n.instance,this.credentialsProvider,{method:"GET",path:r,responseType:"json"},e).then(e=>$(t,e))}downloadFragment(t,e){let{parameters:n}=this;const r=new Set(JSON.parse(t.fragmentId));let i=[];function s(e){if(F(e,t=>{if(!r.delete(t.fullKey))throw new Error(`Received unexpected fragment key: ${JSON.stringify(t.fullKey)}.`);i.push(t)}),0!==r.size)return o();Object(b.c)(t,z(i))}const{credentialsProvider:a}=this;function o(){return L(a,n,r,e).then(s)}return o()}};V=C([Object(x.g)()],V);let G=class extends(j(_.a,g)){download(t,e){const{parameters:n}=this;let r={object_id:`${t.objectId}`};const i=`/v1/objects/${n.volumeId}`+`/meshes/${n.meshName}`+"/skeleton:binary";return A(n.changeSpec,r),h(n.instance,this.credentialsProvider,{method:"POST",path:i,payload:JSON.stringify(r),responseType:"arraybuffer"},e).then(e=>(function(t,e){let n=new DataView(e),r=n.getUint32(0,!0);if(0!==n.getUint32(4,!0))throw new Error("The number of vertices should not exceed 2^32-1.");let i=n.getUint32(8,!0);if(0!==n.getUint32(12,!0))throw new Error("The number of edges should not exceed 2^32-1.");Object(_.b)(t,e,S.b.LITTLE,16,r,void 0,i)})(t,e))}};G=C([Object(x.g)()],G);const q=["LOCATION","LINE","VOLUME"];function Y(t){const e=t.match(/(-?[0-9]+),(-?[0-9]+),(-?[0-9]+)/);if(null===e)throw new Error(`Error parsing number triplet: ${JSON.stringify(t)}.`);return T.n.fromValues(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}function Z(t){return t.volumeId+":"+t.changestack+":"}function K(t,e){if(!e.startsWith(t))throw new Error(`Received annotation id ${JSON.stringify(e)} does not have expected prefix of ${JSON.stringify(t)}.`);return e.substring(t.length)}function H(t){if(null!=t)return Object(M.a)(t,t=>E.a.parseString(""+t,10))}function W(t,e,n){const i=Object(M.j)(t,"corner",t=>Y(Object(M.l)(t))),s=Object(M.j)(t,"size",t=>Y(Object(M.l)(t))),a=Object(M.j)(t,"payload",M.k),o=Object(M.j)(t,"type",M.l),u=Object(M.j)(t,"id",M.l),c=K(e,u),h=Object(M.j)(t,"objectLabels",H);if(void 0!==n&&c!==n)throw new Error(`Received annotation has unexpected id ${JSON.stringify(u)}.`);switch(o){case"LOCATION":if(T.n.equals(s,T.h))return{type:r.b.POINT,id:c,point:i,description:a,segments:h};{const t=T.n.scale(T.n.create(),s,.5),e=T.n.add(T.n.create(),i,t);return{type:r.b.ELLIPSOID,id:c,center:e,radii:t,description:a,segments:h}}case"LINE":return{type:r.b.LINE,id:c,pointA:i,pointB:T.n.add(T.n.create(),i,s),description:a,segments:h};case"VOLUME":return{type:r.b.AXIS_ALIGNED_BOUNDING_BOX,id:c,pointA:i,pointB:T.n.add(T.n.create(),i,s),description:a,segments:h};default:throw new Error(`Unknown spatial annotation type: ${JSON.stringify(o)}.`)}}function J(t,e){const n=new r.a,s=Z(t.source.parent.parameters);e.forEach((t,e)=>{try{Object(M.i)(t);const r=Object(M.j)(t,"annotations",t=>void 0===t?[]:t);if(!Array.isArray(r))throw new Error(`Expected array, but received ${JSON.stringify(typeof r)}.`);for(const t of r)try{n.add(W(t,s))}catch(t){throw new Error(`Error parsing annotation: ${t.message}`)}}catch(t){throw new Error(`Error parsing ${q[e]} annotations: ${t.message}`)}}),t.data=Object.assign(new i.AnnotationGeometryData,n.serialize())}function Q(t){const e=t.indexOf(".");return t.substring(0,e)}function X(t){return`${Math.round(t[0])},${Math.round(t[1])},${Math.round(t[2])}`}function tt(t,e){return`${t.volumeId}:${t.changestack}:${e}`}function et(t){const e=t.description||"",n=void 0===t.segments?void 0:t.segments.map(t=>t.toString());switch(t.type){case r.b.LINE:case r.b.AXIS_ALIGNED_BOUNDING_BOX:{const{pointA:i,pointB:s}=t,a=T.n.min(T.n.create(),i,s),o=T.n.max(T.n.create(),i,s),u=T.n.subtract(o,o,a);return{type:t.type===r.b.LINE?"LINE":"VOLUME",corner:X(a),size:X(u),object_labels:n,payload:e}}case r.b.POINT:return{type:"LOCATION",corner:X(t.point),size:"0,0,0",object_labels:n,payload:e};case r.b.ELLIPSOID:{const r=T.n.subtract(T.n.create(),t.center,t.radii),i=T.n.scale(T.n.create(),t.radii,2);return{type:"LOCATION",corner:X(r),size:X(i),object_labels:n,payload:e}}}}let nt=class extends(j(i.AnnotationSource,m)){downloadGeometry(t,e){const{parameters:n}=this;return Promise.all(q.map(t=>h(n.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${n.volumeId}/${n.changestack}/spatials:get`,payload:JSON.stringify({type:t,ignore_payload:!0}),responseType:"json"},e))).then(e=>{J(t,e)})}downloadSegmentFilteredGeometry(t,e){const{parameters:n}=this;return Promise.all(q.map(r=>h(n.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${n.volumeId}/${n.changestack}/spatials:get`,payload:JSON.stringify({type:r,object_labels:[t.objectId.toString()],ignore_payload:!0}),responseType:"json"},e))).then(e=>{J(t,e)})}downloadMetadata(t,e){const{parameters:n}=this,r=t.key;return h(n.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${n.volumeId}/${n.changestack}/spatials:get`,payload:JSON.stringify({type:Q(r),id:tt(n,r)}),responseType:"json"},e).then(e=>{t.annotation=function(t,e,n){return Object(M.i)(t),W(Object(M.j)(t,"annotations",t=>Object(M.c)([void 0],t,M.i))[0],e,n)}(e,Z(n),r)},()=>{t.annotation=null})}add(t){const{parameters:e}=this,n=et(t);return h(e.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${e.volumeId}/${e.changestack}/spatials:push`,payload:JSON.stringify({annotations:[n]}),responseType:"json"}).then(t=>{Object(M.i)(t);const e=Object(M.j)(t,"ids",M.m);if(1!==e.length)throw new Error(`Expected list of 1 id, but received ${JSON.stringify(e)}.`);return K(Z(this.parameters),e[0])})}update(t,e){const{parameters:n}=this,r=et(e);return r.id=tt(n,t),h(n.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${n.volumeId}/${n.changestack}/spatials:push`,payload:JSON.stringify({annotations:[r]}),responseType:"json"})}delete(t){const{parameters:e}=this;return h(e.instance,this.credentialsProvider,{method:"POST",path:`/v1/changes/${e.volumeId}/${e.changestack}/spatials:delete`,payload:JSON.stringify({type:Q(t),ids:[tt(e,t)]}),responseType:"json"})}};nt=C([Object(x.g)()],nt)},function(t,e,n){"use strict";n.r(e);var r,i=n(5);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */!function(t){t[t.JPEG=0]="JPEG",t[t.RAW=1]="RAW",t[t.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION",t[t.COMPRESSED_SEGMENTATIONARRAY=3]="COMPRESSED_SEGMENTATIONARRAY"}(r||(r={}));class s{}class a extends s{}a.RPC_ID="dvid/VolumeChunkSource";class o extends s{}o.RPC_ID="dvid/SkeletonSource";class u extends s{}u.RPC_ID="dvid/MeshSource";var c=n(10),h=n(29);function l(t,e){let n=function(t){let e=t.split("\n"),n=new Array,r="-?\\d*(?:\\.\\d+)?",i=new RegExp("^[ \\t]*("+["\\d+","\\d+",r,r,r,r,"-1|\\d+"].join(")[ \\t]+(")+")[ \\t]*$");return e.forEach(function(t){let e=t.match(i);if(e){let t=n[parseInt(e[1],10)-1]=new d;t.type=parseInt(e[2],10),t.x=parseFloat(e[3]),t.y=parseFloat(e[4]),t.z=parseFloat(e[5]),t.radius=parseFloat(e[6]),t.parent=parseInt(e[7],10)-1}}),n}(e);if(n.length<2)throw new Error("ERROR parsing swc file");let r=new Float32Array(3*n.length),i=new Uint32Array(2*(n.length-1));n.forEach(function(t,e){r[3*e]=t.z,r[3*e+1]=t.y,r[3*e+2]=t.x,-1!==t.parent&&(i[2*(e-1)]=e,i[2*e-1]=t.parent)}),t.indices=i,t.vertexPositions=r}class d{}var f=n(33),p=n(25),g=n(16),m=n(7),b=n(6),y=n(1);n.d(e,"DVIDSkeletonSource",function(){return w}),n.d(e,"decodeFragmentChunk",function(){return v}),n.d(e,"DVIDMeshSource",function(){return I}),n.d(e,"DVIDVolumeChunkSource",function(){return k});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var _=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};let w=class extends(Object(i.WithParameters)(h.a,o)){download(t,e){const{parameters:n}=this;let r=`${t.objectId}`;const i=`${n.baseUrl}/api/node/${n.nodeKey}`+`/${n.dataInstanceKey}/key/`+r+"_swc";return Object(b.b)(i,{},b.d,e).then(e=>{let n=new TextDecoder("utf-8");l(t,n.decode(e))})}};function v(t,e){let n=new DataView(e).getUint32(0,!0);Object(c.c)(t,Object(c.h)(e,m.b.LITTLE,4,n))}w=_([Object(y.g)()],w);let I=class extends(Object(i.WithParameters)(c.a,u)){download(t){return t.fragmentIds=[`${t.objectId}`],Promise.resolve(void 0)}downloadFragment(t,e){const{parameters:n}=this,r=`${n.baseUrl}/api/node/${n.nodeKey}/${n.dataInstanceKey}/key/${t.fragmentId}.ngmesh`;return Object(b.b)(r,{},b.d,e).then(e=>v(t,e))}};I=_([Object(y.g)()],I);let k=class extends(Object(i.WithParameters)(g.b,a)){async download(t,e){let n,i=this.parameters;{let e=this.computeChunkBounds(t),r=t.chunkDataSize;n=this.getPath(e,r)}const s=this.getDecoder(i),a=await Object(b.b)(`${i.baseUrl}${n}`,{},b.d,e);await s(t,e,i.encoding===r.JPEG?a.slice(16):a)}getPath(t,e){let n=this.parameters;return n.encoding===r.JPEG?`/api/node/${n.nodeKey}/${n.dataInstanceKey}/subvolblocks/`+`${e[0]}_${e[1]}_${e[2]}/`+`${t[0]}_${t[1]}_${t[2]}`:n.encoding===r.RAW?`/api/node/${n.nodeKey}/${n.dataInstanceKey}/raw/0_1_2/`+`${e[0]}_${e[1]}_${e[2]}/`+`${t[0]}_${t[1]}_${t[2]}/jpeg`:n.encoding===r.COMPRESSED_SEGMENTATIONARRAY?`/api/node/${n.nodeKey}/${n.dataInstanceKey}/raw/0_1_2/`+`${e[0]}_${e[1]}_${e[2]}/`+`${t[0]}_${t[1]}_${t[2]}?compression=googlegzip&scale=${n.dataScale}`:`/api/node/${n.nodeKey}/${n.dataInstanceKey}/raw/0_1_2/`+`${e[0]}_${e[1]}_${e[2]}/`+`${t[0]}_${t[1]}_${t[2]}?compression=googlegzip`}getDecoder(t){return t.encoding===r.JPEG||t.encoding===r.RAW?p.a:f.a}};k=_([Object(y.g)()],k)},function(t,e,n){"use strict";n.r(e);var r=n(28),i=n(15),s=n(5),a=n(2),o=n(31);var u;!function(t){t[t.NONE=0]="NONE",t[t.BINARY=1]="BINARY",t[t.UINT8=2]="UINT8",t[t.INT16=4]="INT16",t[t.INT32=8]="INT32",t[t.FLOAT32=16]="FLOAT32",t[t.COMPLEX64=32]="COMPLEX64",t[t.FLOAT64=64]="FLOAT64",t[t.RGB24=128]="RGB24",t[t.INT8=256]="INT8",t[t.UINT16=512]="UINT16",t[t.UINT32=768]="UINT32",t[t.INT64=1024]="INT64",t[t.UINT64=1280]="UINT64",t[t.FLOAT128=1536]="FLOAT128",t[t.COMPLEX128=1792]="COMPLEX128",t[t.COMPLEX256=2048]="COMPLEX256"}(u||(u={}));class c{}c.RPC_ID="nifti/VolumeChunkSource";var h=n(23),l=n(16),d=n(14),f=n(7),p=n(0),g=n(1),m=n(32);n.d(e,"NiftiFileData",function(){return y}),n.d(e,"NiftiVolumeChunkSource",function(){return S});
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var b=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a};class y{}async function _(t,e){Object(m.isCompressed)(t)&&(t=(await Object(i.a)(r.a,e,[t],new Uint8Array(t))).buffer);let n=new y;n.uncompressedData=t;let s=Object(m.readHeader)(t);if(null===s)throw new Error("Failed to parse NIFTI header.");return n.header=s,{data:n,size:t.byteLength}}function w(t,e,n,r){return o.a.getUrl(t,_,e,n,r)}const v=1e3;function I(t){return p.i.fromValues(t[0][0],t[1][0],t[2][0],t[3][0],t[0][1],t[1][1],t[2][1],t[3][1],t[0][2],t[1][2],t[2][2],t[3][2],t[0][3],t[1][3],t[2][3],t[3][3])}const k=new Map([[u.INT8,{dataType:d.a.UINT8,volumeType:d.c.IMAGE}],[u.UINT8,{dataType:d.a.UINT8,volumeType:d.c.IMAGE}],[u.INT16,{dataType:d.a.UINT16,volumeType:d.c.IMAGE}],[u.UINT16,{dataType:d.a.UINT16,volumeType:d.c.IMAGE}],[u.INT32,{dataType:d.a.UINT32,volumeType:d.c.SEGMENTATION}],[u.UINT32,{dataType:d.a.UINT32,volumeType:d.c.SEGMENTATION}],[u.INT64,{dataType:d.a.UINT64,volumeType:d.c.SEGMENTATION}],[u.UINT64,{dataType:d.a.UINT64,volumeType:d.c.SEGMENTATION}],[u.FLOAT32,{dataType:d.a.FLOAT32,volumeType:d.c.IMAGE}]]);Object(g.e)("nifti/getNiftiVolumeInfo",function(t,e){const n=this.getRef(t.chunkManager),r=function(t,e,n){return w(t,e,()=>({priorityTier:a.f.VISIBLE,priority:v}),n).then(t=>t.header)}(n,t.url,e);return n.dispose(),r.then(t=>{let e=k.get(t.datatypeCode);if(void 0===e)throw new Error("Unsupported data type: "+`${u[t.datatypeCode]||t.datatypeCode}.`);if(1!==t.dims[4])throw new Error("Time series data not supported.");let n=1;switch(t.xyzt_units&m.NIFTI1.SPATIAL_UNITS_MASK){case m.NIFTI1.UNITS_METER:n=1e9;break;case m.NIFTI1.UNITS_MM:n=1e6;break;case m.NIFTI1.UNITS_MICRON:n=1e3}const{quatern_b:r,quatern_c:i,quatern_d:s}=t,a=Math.sqrt(1-r*r-i*i-s*s),o=-1===t.pixDims[0]?-1:1;return{value:{description:t.description,affine:I(t.affine),dataType:e.dataType,numChannels:t.dims[5],volumeType:e.volumeType,voxelSize:p.n.fromValues(n*t.pixDims[1],n*t.pixDims[2],n*t.pixDims[3]),volumeSize:p.n.fromValues(t.dims[1],t.dims[2],t.dims[3]),qoffset:p.n.fromValues(n*t.qoffset_x,n*t.qoffset_y,n*t.qoffset_z),qform_code:t.qform_code,sform_code:t.sform_code,qfac:o,quatern:p.k.fromValues(r,i,s,a)}}})});let S=class extends(Object(s.WithParameters)(l.b,c)){async download(t,e){t.chunkDataSize=this.spec.chunkDataSize;const n=await w(this.chunkManager,this.parameters.url,()=>({priorityTier:t.priorityTier,priority:t.priority}),e),r=Object(m.readImage)(n.header,n.uncompressedData);await Object(h.a)(t,e,r,n.header.littleEndian?f.b.LITTLE:f.b.BIG)}};S=b([Object(g.g)()],S)},function(t,e,n){"use strict";n.r(e);var r,i=n(28),s=n(15),a=n(5);!function(t){t[t.RAW=0]="RAW",t[t.GZIP=1]="GZIP"}(r||(r={}));class o{}o.RPC_ID="n5/VolumeChunkSource";var u=n(23),c=n(16),h=n(7),l=n(0),d=n(6),f=n(1);n.d(e,"PrecomputedVolumeChunkSource",function(){return p});let p=class extends(Object(a.WithParameters)(c.b,o)){async download(t,e){const{parameters:n}=this,{chunkGridPosition:a}=t,o=`${n.url}/${a[0]}/${a[1]}/${a[2]}`,c=await Object(d.b)(o,{},d.d,e);await async function(t,e,n,a){const o=new DataView(n),c=o.getUint16(0,!1);if(0!==c)throw new Error(`Unsupported mode: ${c}.`);const d=o.getUint16(2,!1);if(3!==d)throw new Error("Number of dimensions must be 3.");let f=4;const p=new Uint32Array(d);for(let t=0;t<d;++t)p[t]=o.getUint32(f,!1),f+=4;t.chunkDataSize=l.n.fromValues(p[0],p[1],p[2]);let g=new Uint8Array(n,f);a===r.GZIP&&(g=await Object(s.a)(i.a,e,[g.buffer],g)),await Object(u.a)(t,e,g.buffer,h.b.BIG,g.byteOffset,g.byteLength)}(t,e,c,n.encoding)}};p=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(f.g)()],p)},function(t,e,n){"use strict";n.r(e);var r=n(34),i=n(18);var s=n(8),a=n(0),o=n(1);n.d(e,"ExampleComputation",function(){return u});
/**
 * @license
 * Copyright 2018 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let u=class extends r.VolumeComputationBackend{compute(t){const{inputSpec:e,outputSpec:n}=this.params,o=Object(i.c)(t,e.dataType),u=this.createOutputBuffer(),c=Object(i.c)(u,n.dataType),h=a.n.create();if(h.set([0,0,0]),Object(r.copyBufferOverlap)(h,e.size,o,h,n.size,c,n.dataType),e.dataType===s.b.UINT8)for(let t=0;t<c.length;++t)c[t]=255-c[t];return Promise.resolve(u)}};u=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(o.g)("Computation.ExampleComputation")],u)},function(t,e,n){"use strict";n.r(e);var r=n(34),i=n(18);var s=n(1);n.d(e,"TensorflowComputation",function(){return a});let a=class extends r.VolumeComputationBackend{convertInputBuffer_(t,e){const n=Object(i.c)(t,this.params.inputSpec.dataType);let r;switch(e){case"float32":r=new Float32Array(n.length);break;case"int32":r=new Int32Array(n.length);break;default:throw new Error(`Unsupported dtype: ${e}`)}for(let t=0;t<n.length;++t)r[t]=(n[t]-this.params.mean)/this.params.stdDev;return r}convertOutputBuffer_(t){const e=this.createOutputBuffer();return Object(i.c)(e,this.params.outputSpec.dataType).set(t),e}compute(t,e,n){this.addRef();const r={inputBuffer:this.convertInputBuffer_(t,this.params.inputDType),computationRef:this.rpcId,priority:n.priority};return this.rpc.promiseInvoke("Computation.Tensorflow.Inference",{inferenceRequest:r},e).then(t=>(this.dispose(),this.convertOutputBuffer_(t.outputBuffer))).catch(t=>{throw this.dispose(),t})}};a=function(t,e,n,r){var i,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(s<3?i(a):s>3?i(e,n,a):i(e,n))||a);return s>3&&a&&Object.defineProperty(e,n,a),a}([Object(s.g)("Computation.Tensorflow")],a)},function(t,e,n){"use strict";n.r(e);var r=n(15),i=n(22);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const s=Object(i.a)("parseVTKFromArrayBuffer");var a=n(31),o=n(43),u=n(8);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function c(t,e){return Object(r.a)(s,e,[t],t)}Object(o.a)("vtk",{description:"VTK",getMesh:(t,e,n,r)=>a.a.getUrl(t,c,e,n,r).then(t=>{let e={info:{numTriangles:t.numTriangles,numVertices:t.numVertices,vertexAttributes:[]},indices:t.indices,vertexPositions:t.vertexPositions,vertexAttributes:[]};for(const n of t.vertexAttributes)e.info.vertexAttributes.push({name:n.name,dataType:u.b.FLOAT32,numComponents:n.numComponents}),e.vertexAttributes.push(n.data);return e})})},function(t,e,n){"use strict";n.r(e);var r=n(22);
/**
 * @license
 * Copyright 2019 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i=Object(r.a)("parseCSVFromArrayBuffer");var s=n(15),a=n(31),o=n(43);
/**
 * @license
 * Copyright 2016 Google Inc.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function u(t,e){return Object(s.a)(i,e,[t],t)}Object(o.b)("csv",{description:"Comma separated value text file",getMeshVertexAttributes:(t,e,n,r)=>a.a.getUrl(t,u,e,n,r)})}]);
//# sourceMappingURL=chunk_worker.bundle.js.map